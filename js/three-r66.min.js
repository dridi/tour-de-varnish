var THREE={REVISION:'66'};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};(function(){var a=0;var b=['ms','moz','webkit','o'];for(var c=0;c<b.length&&!self.requestAnimationFrame;++c){self.requestAnimationFrame=self[b[c]+'RequestAnimationFrame'];self.cancelAnimationFrame=self[b[c]+'CancelAnimationFrame']||self[b[c]+'CancelRequestAnimationFrame'];}if(self.requestAnimationFrame===undefined&&self.setTimeout!==undefined)self.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a));var e=self.setTimeout(function(){b(c+d);},d);a=c+d;return e;};if(self.cancelAnimationFrame===undefined&&self.clearTimeout!==undefined)self.cancelAnimationFrame=function(a){self.clearTimeout(a);};}());THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1000;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Color=function(a){if(arguments.length===3)return this.setRGB(arguments[0],arguments[1],arguments[2]);return this.set(a);};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){if(a instanceof THREE.Color)this.copy(a);else if(typeof a==='number')this.setHex(a);else if(typeof a==='string')this.setStyle(a);return this;},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this;},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this;},setHSL:function(a,b,c){if(b===0)this.r=this.g=this.b=c;else{var d=function(a,b,c){if(c<0)c+=1;if(c>1)c-=1;if(c<1/6)return a+(b-a)*6*c;if(c<1/2)return b;if(c<2/3)return a+(b-a)*6*(2/3-c);return a;};var e=c<=0.5?c*(1+b):c+b-(c*b);var f=(2*c)-e;this.r=d(f,e,a+1/3);this.g=d(f,e,a);this.b=d(f,e,a-1/3);}return this;},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)){var b=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);this.r=Math.min(255,parseInt(b[1],10))/255;this.g=Math.min(255,parseInt(b[2],10))/255;this.b=Math.min(255,parseInt(b[3],10))/255;return this;}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)){var b=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a);this.r=Math.min(100,parseInt(b[1],10))/100;this.g=Math.min(100,parseInt(b[2],10))/100;this.b=Math.min(100,parseInt(b[3],10))/100;return this;}if(/^\#([0-9a-f]{6})$/i.test(a)){var b=/^\#([0-9a-f]{6})$/i.exec(a);this.setHex(parseInt(b[1],16));return this;}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){var b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16));return this;}if(/^(\w+)$/i.test(a)){this.setHex(THREE.ColorKeywords[a]);return this;}},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this;},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this;},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this;},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this;},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this;},getHex:function(){return(this.r*255)<<16^(this.g*255)<<8^(this.b*255)<<0;},getHexString:function(){return('000000'+this.getHex().toString(16)).slice(-6);},getHSL:function(a){var b=a||{h:0,s:0,l:0};var c=this.r,d=this.g,e=this.b;var f=Math.max(c,d,e);var g=Math.min(c,d,e);var h,i;var j=(g+f)/2.0;if(g===f){h=0;i=0;}else{var k=f-g;i=j<=0.5?k/(f+g):k/(2-f-g);switch(f){case c:h=(d-e)/k+(d<e?6:0);break;case d:h=(e-c)/k+2;break;case e:h=(c-d)/k+4;break;}h/=6;}b.h=h;b.s=i;b.l=j;return b;},getStyle:function(){return 'rgb('+((this.r*255)|0)+','+((this.g*255)|0)+','+((this.b*255)|0)+')';},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this;},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this;},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this;},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this;},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this;},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this;},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this;},equals:function(a){return(a.r===this.r)&&(a.g===this.g)&&(a.b===this.b);},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this;},toArray:function(){return [this.r,this.g,this.b];},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b);}};THREE.ColorKeywords={"aliceblue":0xF0F8FF,"antiquewhite":0xFAEBD7,"aqua":0x00FFFF,"aquamarine":0x7FFFD4,"azure":0xF0FFFF,"beige":0xF5F5DC,"bisque":0xFFE4C4,"black":0x000000,"blanchedalmond":0xFFEBCD,"blue":0x0000FF,"blueviolet":0x8A2BE2,"brown":0xA52A2A,"burlywood":0xDEB887,"cadetblue":0x5F9EA0,"chartreuse":0x7FFF00,"chocolate":0xD2691E,"coral":0xFF7F50,"cornflowerblue":0x6495ED,"cornsilk":0xFFF8DC,"crimson":0xDC143C,"cyan":0x00FFFF,"darkblue":0x00008B,"darkcyan":0x008B8B,"darkgoldenrod":0xB8860B,"darkgray":0xA9A9A9,"darkgreen":0x006400,"darkgrey":0xA9A9A9,"darkkhaki":0xBDB76B,"darkmagenta":0x8B008B,"darkolivegreen":0x556B2F,"darkorange":0xFF8C00,"darkorchid":0x9932CC,"darkred":0x8B0000,"darksalmon":0xE9967A,"darkseagreen":0x8FBC8F,"darkslateblue":0x483D8B,"darkslategray":0x2F4F4F,"darkslategrey":0x2F4F4F,"darkturquoise":0x00CED1,"darkviolet":0x9400D3,"deeppink":0xFF1493,"deepskyblue":0x00BFFF,"dimgray":0x696969,"dimgrey":0x696969,"dodgerblue":0x1E90FF,"firebrick":0xB22222,"floralwhite":0xFFFAF0,"forestgreen":0x228B22,"fuchsia":0xFF00FF,"gainsboro":0xDCDCDC,"ghostwhite":0xF8F8FF,"gold":0xFFD700,"goldenrod":0xDAA520,"gray":0x808080,"green":0x008000,"greenyellow":0xADFF2F,"grey":0x808080,"honeydew":0xF0FFF0,"hotpink":0xFF69B4,"indianred":0xCD5C5C,"indigo":0x4B0082,"ivory":0xFFFFF0,"khaki":0xF0E68C,"lavender":0xE6E6FA,"lavenderblush":0xFFF0F5,"lawngreen":0x7CFC00,"lemonchiffon":0xFFFACD,"lightblue":0xADD8E6,"lightcoral":0xF08080,"lightcyan":0xE0FFFF,"lightgoldenrodyellow":0xFAFAD2,"lightgray":0xD3D3D3,"lightgreen":0x90EE90,"lightgrey":0xD3D3D3,"lightpink":0xFFB6C1,"lightsalmon":0xFFA07A,"lightseagreen":0x20B2AA,"lightskyblue":0x87CEFA,"lightslategray":0x778899,"lightslategrey":0x778899,"lightsteelblue":0xB0C4DE,"lightyellow":0xFFFFE0,"lime":0x00FF00,"limegreen":0x32CD32,"linen":0xFAF0E6,"magenta":0xFF00FF,"maroon":0x800000,"mediumaquamarine":0x66CDAA,"mediumblue":0x0000CD,"mediumorchid":0xBA55D3,"mediumpurple":0x9370DB,"mediumseagreen":0x3CB371,"mediumslateblue":0x7B68EE,"mediumspringgreen":0x00FA9A,"mediumturquoise":0x48D1CC,"mediumvioletred":0xC71585,"midnightblue":0x191970,"mintcream":0xF5FFFA,"mistyrose":0xFFE4E1,"moccasin":0xFFE4B5,"navajowhite":0xFFDEAD,"navy":0x000080,"oldlace":0xFDF5E6,"olive":0x808000,"olivedrab":0x6B8E23,"orange":0xFFA500,"orangered":0xFF4500,"orchid":0xDA70D6,"palegoldenrod":0xEEE8AA,"palegreen":0x98FB98,"paleturquoise":0xAFEEEE,"palevioletred":0xDB7093,"papayawhip":0xFFEFD5,"peachpuff":0xFFDAB9,"peru":0xCD853F,"pink":0xFFC0CB,"plum":0xDDA0DD,"powderblue":0xB0E0E6,"purple":0x800080,"red":0xFF0000,"rosybrown":0xBC8F8F,"royalblue":0x4169E1,"saddlebrown":0x8B4513,"salmon":0xFA8072,"sandybrown":0xF4A460,"seagreen":0x2E8B57,"seashell":0xFFF5EE,"sienna":0xA0522D,"silver":0xC0C0C0,"skyblue":0x87CEEB,"slateblue":0x6A5ACD,"slategray":0x708090,"slategrey":0x708090,"snow":0xFFFAFA,"springgreen":0x00FF7F,"steelblue":0x4682B4,"tan":0xD2B48C,"teal":0x008080,"thistle":0xD8BFD8,"tomato":0xFF6347,"turquoise":0x40E0D0,"violet":0xEE82EE,"wheat":0xF5DEB3,"white":0xFFFFFF,"whitesmoke":0xF5F5F5,"yellow":0xFFFF00,"yellowgreen":0x9ACD32};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=(d!==undefined)?d:1;};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:undefined,_updateEuler:function(a){if(this._euler!==undefined)this._euler.setFromQuaternion(this,undefined,false);},get x(){return this._x;},set x(value){this._x=value;this._updateEuler();},get y(){return this._y;},set y(value){this._y=value;this._updateEuler();},get z(){return this._z;},set z(value){this._z=value;this._updateEuler();},get w(){return this._w;},set w(value){this._w=value;this._updateEuler();},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this._updateEuler();return this;},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._w=a._w;this._updateEuler();return this;},setFromEuler:function(a,b){if(a instanceof THREE.Euler===false)throw new Error('ERROR: Quaternion\'s .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.');var c=Math.cos(a._x/2);var d=Math.cos(a._y/2);var e=Math.cos(a._z/2);var f=Math.sin(a._x/2);var g=Math.sin(a._y/2);var h=Math.sin(a._z/2);if(a.order==='XYZ'){this._x=f*d*e+c*g*h;this._y=c*g*e-f*d*h;this._z=c*d*h+f*g*e;this._w=c*d*e-f*g*h;}else if(a.order==='YXZ'){this._x=f*d*e+c*g*h;this._y=c*g*e-f*d*h;this._z=c*d*h-f*g*e;this._w=c*d*e+f*g*h;}else if(a.order==='ZXY'){this._x=f*d*e-c*g*h;this._y=c*g*e+f*d*h;this._z=c*d*h+f*g*e;this._w=c*d*e-f*g*h;}else if(a.order==='ZYX'){this._x=f*d*e-c*g*h;this._y=c*g*e+f*d*h;this._z=c*d*h-f*g*e;this._w=c*d*e+f*g*h;}else if(a.order==='YZX'){this._x=f*d*e+c*g*h;this._y=c*g*e+f*d*h;this._z=c*d*h-f*g*e;this._w=c*d*e-f*g*h;}else if(a.order==='XZY'){this._x=f*d*e-c*g*h;this._y=c*g*e-f*d*h;this._z=c*d*h+f*g*e;this._w=c*d*e+f*g*h;}if(b!==false)this._updateEuler();return this;},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this._updateEuler();return this;},setFromRotationMatrix:function(a){var b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k,m;if(l>0){m=0.5/Math.sqrt(l+1.0);this._w=0.25/m;this._x=(j-h)*m;this._y=(e-i)*m;this._z=(f-d)*m;}else if(c>g&&c>k){m=2.0*Math.sqrt(1.0+c-g-k);this._w=(j-h)/m;this._x=0.25*m;this._y=(d+f)/m;this._z=(e+i)/m;}else if(g>k){m=2.0*Math.sqrt(1.0+g-c-k);this._w=(e-i)/m;this._x=(d+f)/m;this._y=0.25*m;this._z=(h+j)/m;}else{m=2.0*Math.sqrt(1.0+k-c-g);this._w=(f-d)/m;this._x=(e+i)/m;this._y=(h+j)/m;this._z=0.25*m;}this._updateEuler();return this;},inverse:function(){this.conjugate().normalize();return this;},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this._updateEuler();return this;},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w;},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w);},normalize:function(){var a=this.length();if(a===0){this._x=0;this._y=0;this._z=0;this._w=1;}else{a=1/a;this._x=this._x*a;this._y=this._y*a;this._z=this._z*a;this._w=this._w*a;}return this;},multiply:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Quaternion\'s .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');return this.multiplyQuaternions(a,b);}return this.multiplyQuaternions(this,a);},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w;var g=b._x,h=b._y,i=b._z,j=b._w;this._x=c*j+f*g+d*i-e*h;this._y=d*j+f*h+e*g-c*i;this._z=e*j+f*i+c*h-d*g;this._w=f*j-c*g-d*h-e*i;this._updateEuler();return this;},multiplyVector3:function(a){console.warn('DEPRECATED: Quaternion\'s .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');return a.applyQuaternion(this);},slerp:function(a,b){var c=this._x,d=this._y,e=this._z,f=this._w;var g=f*a._w+c*a._x+d*a._y+e*a._z;if(g<0){this._w=-a._w;this._x=-a._x;this._y=-a._y;this._z=-a._z;g=-g;}else this.copy(a);if(g>=1.0){this._w=f;this._x=c;this._y=d;this._z=e;return this;}var h=Math.acos(g);var i=Math.sqrt(1.0-g*g);if(Math.abs(i)<0.001){this._w=0.5*(f+this._w);this._x=0.5*(c+this._x);this._y=0.5*(d+this._y);this._z=0.5*(e+this._z);return this;}var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;this._w=(f*j+this._w*k);this._x=(c*j+this._x*k);this._y=(d*j+this._y*k);this._z=(e*j+this._z*k);this._updateEuler();return this;},equals:function(a){return(a._x===this._x)&&(a._y===this._y)&&(a._z===this._z)&&(a._w===this._w);},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];this._w=a[3];this._updateEuler();return this;},toArray:function(){return [this._x,this._y,this._z,this._w];},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w);}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d);};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0;};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this;},setX:function(a){this.x=a;return this;},setY:function(a){this.y=a;return this;},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this;},add:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector2\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(a,b);}this.x+=a.x;this.y+=a.y;return this;},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this;},addScalar:function(a){this.x+=a;this.y+=a;return this;},sub:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector2\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(a,b);}this.x-=a.x;this.y-=a.y;return this;},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this;},multiplyScalar:function(a){this.x*=a;this.y*=a;return this;},divideScalar:function(a){if(a!==0){var b=1/a;this.x*=b;this.y*=b;}else{this.x=0;this.y=0;}return this;},min:function(a){if(this.x>a.x)this.x=a.x;if(this.y>a.y)this.y=a.y;return this;},max:function(a){if(this.x<a.x)this.x=a.x;if(this.y<a.y)this.y=a.y;return this;},clamp:function(a,b){if(this.x<a.x)this.x=a.x;else if(this.x>b.x)this.x=b.x;if(this.y<a.y)this.y=a.y;else if(this.y>b.y)this.y=b.y;return this;},clampScalar:(function(){var a,b;return function(c,d){if(a===undefined){a=new THREE.Vector2();b=new THREE.Vector2();}a.set(c,c);b.set(d,d);return this.clamp(a,b);};})(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this;},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this;},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this;},roundToZero:function(){this.x=(this.x<0)?Math.ceil(this.x):Math.floor(this.x);this.y=(this.y<0)?Math.ceil(this.y):Math.floor(this.y);return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(a){return this.x*a.x+this.y*a.y;},lengthSq:function(){return this.x*this.x+this.y*this.y;},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);},normalize:function(){return this.divideScalar(this.length());},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a));},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c;},setLength:function(a){var b=this.length();if(b!==0&&a!==b)this.multiplyScalar(a/b);return this;},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this;},equals:function(a){return((a.x===this.x)&&(a.y===this.y));},fromArray:function(a){this.x=a[0];this.y=a[1];return this;},toArray:function(){return [this.x,this.y];},clone:function(){return new THREE.Vector2(this.x,this.y);}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0;};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this;},setX:function(a){this.x=a;return this;},setY:function(a){this.y=a;return this;},setZ:function(a){this.z=a;return this;},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this;},add:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector3\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(a,b);}this.x+=a.x;this.y+=a.y;this.z+=a.z;return this;},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this;},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this;},sub:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector3\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(a,b);}this.x-=a.x;this.y-=a.y;this.z-=a.z;return this;},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this;},multiply:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector3\'s .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');return this.multiplyVectors(a,b);}this.x*=a.x;this.y*=a.y;this.z*=a.z;return this;},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this;},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this;},applyEuler:function(){var a;return function(b){if(b instanceof THREE.Euler===false)console.error('ERROR: Vector3\'s .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.');if(a===undefined)a=new THREE.Quaternion();this.applyQuaternion(a.setFromEuler(b));return this;};}(),applyAxisAngle:function(){var a;return function(b,c){if(a===undefined)a=new THREE.Quaternion();this.applyQuaternion(a.setFromAxisAngle(b,c));return this;};}(),applyMatrix3:function(a){var b=this.x;var c=this.y;var d=this.z;var e=a.elements;this.x=e[0]*b+e[3]*c+e[6]*d;this.y=e[1]*b+e[4]*c+e[7]*d;this.z=e[2]*b+e[5]*c+e[8]*d;return this;},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;this.x=e[0]*b+e[4]*c+e[8]*d+e[12];this.y=e[1]*b+e[5]*c+e[9]*d+e[13];this.z=e[2]*b+e[6]*c+e[10]*d+e[14];return this;},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;var f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f;this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f;this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f;return this;},applyQuaternion:function(a){var b=this.x;var c=this.y;var d=this.z;var e=a.x;var f=a.y;var g=a.z;var h=a.w;var i=h*b+f*d-g*c;var j=h*c+g*b-e*d;var k=h*d+e*c-f*b;var l=-e*b-f*c-g*d;this.x=i*h+l*-e+j*-g-k*-f;this.y=j*h+l*-f+k*-e-i*-g;this.z=k*h+l*-g+i*-f-j*-e;return this;},transformDirection:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;this.x=e[0]*b+e[4]*c+e[8]*d;this.y=e[1]*b+e[5]*c+e[9]*d;this.z=e[2]*b+e[6]*c+e[10]*d;this.normalize();return this;},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this;},divideScalar:function(a){if(a!==0){var b=1/a;this.x*=b;this.y*=b;this.z*=b;}else{this.x=0;this.y=0;this.z=0;}return this;},min:function(a){if(this.x>a.x)this.x=a.x;if(this.y>a.y)this.y=a.y;if(this.z>a.z)this.z=a.z;return this;},max:function(a){if(this.x<a.x)this.x=a.x;if(this.y<a.y)this.y=a.y;if(this.z<a.z)this.z=a.z;return this;},clamp:function(a,b){if(this.x<a.x)this.x=a.x;else if(this.x>b.x)this.x=b.x;if(this.y<a.y)this.y=a.y;else if(this.y>b.y)this.y=b.y;if(this.z<a.z)this.z=a.z;else if(this.z>b.z)this.z=b.z;return this;},clampScalar:(function(){var a,b;return function(c,d){if(a===undefined){a=new THREE.Vector3();b=new THREE.Vector3();}a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b);};})(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this;},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this;},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this;},roundToZero:function(){this.x=(this.x<0)?Math.ceil(this.x):Math.floor(this.x);this.y=(this.y<0)?Math.ceil(this.y):Math.floor(this.y);this.z=(this.z<0)?Math.ceil(this.z):Math.floor(this.z);return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z;},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z;},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);},normalize:function(){return this.divideScalar(this.length());},setLength:function(a){var b=this.length();if(b!==0&&a!==b)this.multiplyScalar(a/b);return this;},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this;},cross:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector3\'s .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');return this.crossVectors(a,b);}var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this;},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z;var f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this;},projectOnVector:function(){var a,b;return function(c){if(a===undefined)a=new THREE.Vector3();a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b);};}(),projectOnPlane:function(){var a;return function(b){if(a===undefined)a=new THREE.Vector3();a.copy(this).projectOnVector(b);return this.sub(a);};}(),reflect:function(){var a;return function(b){if(a===undefined)a=new THREE.Vector3();return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)));};}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(b,-1,1));},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a));},distanceToSquared:function(a){var b=this.x-a.x;var c=this.y-a.y;var d=this.z-a.z;return b*b+c*c+d*d;},setEulerFromRotationMatrix:function(a,b){console.error("REMOVED: Vector3\'s setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.");},setEulerFromQuaternion:function(a,b){console.error("REMOVED: Vector3\'s setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.");},getPositionFromMatrix:function(a){console.warn("DEPRECATED: Vector3\'s .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code.");return this.setFromMatrixPosition(a);},getScaleFromMatrix:function(a){console.warn("DEPRECATED: Vector3\'s .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code.");return this.setFromMatrixScale(a);},getColumnFromMatrix:function(a,b){console.warn("DEPRECATED: Vector3\'s .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code.");return this.setFromMatrixColumn(a,b);},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this;},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length();var c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();var d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=d;return this;},setFromMatrixColumn:function(a,b){var c=a*4;var d=b.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this;},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z));},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this;},toArray:function(){return [this.x,this.y,this.z];},clone:function(){return new THREE.Vector3(this.x,this.y,this.z);}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=(d!==undefined)?d:1;};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this;},setX:function(a){this.x=a;return this;},setY:function(a){this.y=a;return this;},setZ:function(a){this.z=a;return this;},setW:function(a){this.w=a;return this;},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=(a.w!==undefined)?a.w:1;return this;},add:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector4\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(a,b);}this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this;},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this;},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this;},sub:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Vector4\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(a,b);}this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this;},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this;},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this;},applyMatrix4:function(a){var b=this.x;var c=this.y;var d=this.z;var e=this.w;var f=a.elements;this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e;this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e;this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e;this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e;return this;},divideScalar:function(a){if(a!==0){var b=1/a;this.x*=b;this.y*=b;this.z*=b;this.w*=b;}else{this.x=0;this.y=0;this.z=0;this.w=1;}return this;},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);if(b<0.0001){this.x=1;this.y=0;this.z=0;}else{this.x=a.x/b;this.y=a.y/b;this.z=a.z/b;}return this;},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=0.01,g=0.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if((Math.abs(j-l)<f)&&(Math.abs(k-o)<f)&&(Math.abs(n-p)<f)){if((Math.abs(j+l)<g)&&(Math.abs(k+o)<g)&&(Math.abs(n+p)<g)&&(Math.abs(i+m+q-3)<g)){this.set(1,0,0,0);return this;}b=Math.PI;var r=(i+1)/2;var s=(m+1)/2;var t=(q+1)/2;var u=(j+l)/4;var v=(k+o)/4;var w=(n+p)/4;if((r>s)&&(r>t))if(r<f){c=0;d=0.707106781;e=0.707106781;}else{c=Math.sqrt(r);d=u/c;e=v/c;}else if(s>t)if(s<f){c=0.707106781;d=0;e=0.707106781;}else{d=Math.sqrt(s);c=u/d;e=w/d;}else if(t<f){c=0.707106781;d=0.707106781;e=0;}else{e=Math.sqrt(t);c=v/e;d=w/e;}this.set(c,d,e,b);return this;}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));if(Math.abs(x)<0.001)x=1;this.x=(p-n)/x;this.y=(k-o)/x;this.z=(l-j)/x;this.w=Math.acos((i+m+q-1)/2);return this;},min:function(a){if(this.x>a.x)this.x=a.x;if(this.y>a.y)this.y=a.y;if(this.z>a.z)this.z=a.z;if(this.w>a.w)this.w=a.w;return this;},max:function(a){if(this.x<a.x)this.x=a.x;if(this.y<a.y)this.y=a.y;if(this.z<a.z)this.z=a.z;if(this.w<a.w)this.w=a.w;return this;},clamp:function(a,b){if(this.x<a.x)this.x=a.x;else if(this.x>b.x)this.x=b.x;if(this.y<a.y)this.y=a.y;else if(this.y>b.y)this.y=b.y;if(this.z<a.z)this.z=a.z;else if(this.z>b.z)this.z=b.z;if(this.w<a.w)this.w=a.w;else if(this.w>b.w)this.w=b.w;return this;},clampScalar:(function(){var a,b;return function(c,d){if(a===undefined){a=new THREE.Vector4();b=new THREE.Vector4();}a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b);};})(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this;},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this;},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this;},roundToZero:function(){this.x=(this.x<0)?Math.ceil(this.x):Math.floor(this.x);this.y=(this.y<0)?Math.ceil(this.y):Math.floor(this.y);this.z=(this.z<0)?Math.ceil(this.z):Math.floor(this.z);this.w=(this.w<0)?Math.ceil(this.w):Math.floor(this.w);return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w;},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w);},normalize:function(){return this.divideScalar(this.length());},setLength:function(a){var b=this.length();if(b!==0&&a!==b)this.multiplyScalar(a/b);return this;},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this;},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z)&&(a.w===this.w));},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this;},toArray:function(){return [this.x,this.y,this.z,this.w];},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w);}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder;};THREE.Euler.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'];THREE.Euler.DefaultOrder='XYZ';THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:undefined,_updateQuaternion:function(){if(this._quaternion!==undefined)this._quaternion.setFromEuler(this,false);},get x(){return this._x;},set x(value){this._x=value;this._updateQuaternion();},get y(){return this._y;},set y(value){this._y=value;this._updateQuaternion();},get z(){return this._z;},set z(value){this._z=value;this._updateQuaternion();},get order(){return this._order;},set order(value){this._order=value;this._updateQuaternion();},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this._updateQuaternion();return this;},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this._updateQuaternion();return this;},setFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1);}var d=a.elements;var e=d[0],f=d[4],g=d[8];var h=d[1],i=d[5],j=d[9];var k=d[2],l=d[6],m=d[10];b=b||this._order;if(b==='XYZ'){this._y=Math.asin(c(g));if(Math.abs(g)<0.99999){this._x=Math.atan2(-j,m);this._z=Math.atan2(-f,e);}else{this._x=Math.atan2(l,i);this._z=0;}}else if(b==='YXZ'){this._x=Math.asin(-c(j));if(Math.abs(j)<0.99999){this._y=Math.atan2(g,m);this._z=Math.atan2(h,i);}else{this._y=Math.atan2(-k,e);this._z=0;}}else if(b==='ZXY'){this._x=Math.asin(c(l));if(Math.abs(l)<0.99999){this._y=Math.atan2(-k,m);this._z=Math.atan2(-f,i);}else{this._y=0;this._z=Math.atan2(h,e);}}else if(b==='ZYX'){this._y=Math.asin(-c(k));if(Math.abs(k)<0.99999){this._x=Math.atan2(l,m);this._z=Math.atan2(h,e);}else{this._x=0;this._z=Math.atan2(-f,i);}}else if(b==='YZX'){this._z=Math.asin(c(h));if(Math.abs(h)<0.99999){this._x=Math.atan2(-j,i);this._y=Math.atan2(-k,e);}else{this._x=0;this._y=Math.atan2(g,m);}}else if(b==='XZY'){this._z=Math.asin(-c(f));if(Math.abs(f)<0.99999){this._x=Math.atan2(l,i);this._y=Math.atan2(g,e);}else{this._x=Math.atan2(-j,m);this._y=0;}}else console.warn('WARNING: Euler.setFromRotationMatrix() given unsupported order: '+b);this._order=b;this._updateQuaternion();return this;},setFromQuaternion:function(a,b,c){function d(a){return Math.min(Math.max(a,-1),1);}var e=a.x*a.x;var f=a.y*a.y;var g=a.z*a.z;var h=a.w*a.w;b=b||this._order;if(b==='XYZ'){this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),(h-e-f+g));this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w)));this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),(h+e-f-g));}else if(b==='YXZ'){this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z)));this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),(h-e-f+g));this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),(h-e+f-g));}else if(b==='ZXY'){this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z)));this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),(h-e-f+g));this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),(h-e+f-g));}else if(b==='ZYX'){this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),(h-e-f+g));this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z)));this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),(h+e-f-g));}else if(b==='YZX'){this._x=Math.atan2(2*(a.x*a.w-a.z*a.y),(h-e+f-g));this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),(h+e-f-g));this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w)));}else if(b==='XZY'){this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),(h-e+f-g));this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),(h+e-f-g));this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y)));}else console.warn('WARNING: Euler.setFromQuaternion() given unsupported order: '+b);this._order=b;if(c!==false)this._updateQuaternion();return this;},reorder:function(){var a=new THREE.Quaternion();return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b);};}(),fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];if(a[3]!==undefined)this._order=a[3];this._updateQuaternion();return this;},toArray:function(){return [this._x,this._y,this._z,this._order];},equals:function(a){return(a._x===this._x)&&(a._y===this._y)&&(a._z===this._z)&&(a._order===this._order);},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order);}};THREE.Line3=function(a,b){this.start=(a!==undefined)?a:new THREE.Vector3();this.end=(b!==undefined)?b:new THREE.Vector3();};THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this;},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this;},center:function(a){var b=a||new THREE.Vector3();return b.addVectors(this.start,this.end).multiplyScalar(0.5);},delta:function(a){var b=a||new THREE.Vector3();return b.subVectors(this.end,this.start);},distanceSq:function(){return this.start.distanceToSquared(this.end);},distance:function(){return this.start.distanceTo(this.end);},at:function(a,b){var c=b||new THREE.Vector3();return this.delta(c).multiplyScalar(a).add(this.start);},closestPointToPointParameter:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b);var f=b.dot(a);var g=f/e;if(d)g=THREE.Math.clamp(g,0,1);return g;};}(),closestPointToPoint:function(a,b,c){var d=this.closestPointToPointParameter(a,b);var e=c||new THREE.Vector3();return this.delta(e).multiplyScalar(d).add(this.start);},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this;},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end);},clone:function(){return new THREE.Line3().copy(this);}};THREE.Box2=function(a,b){this.min=(a!==undefined)?a:new THREE.Vector2(Infinity,Infinity);this.max=(b!==undefined)?b:new THREE.Vector2(-Infinity,-Infinity);};THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this;},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b);this.max.copy(b);for(var c=1,d=a.length;c<d;c++){b=a[c];if(b.x<this.min.x)this.min.x=b.x;else if(b.x>this.max.x)this.max.x=b.x;if(b.y<this.min.y)this.min.y=b.y;else if(b.y>this.max.y)this.max.y=b.y;}}else this.makeEmpty();return this;},setFromCenterAndSize:function(){var a=new THREE.Vector2();return function(b,c){var d=a.copy(c).multiplyScalar(0.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this;};}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this;},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this;},empty:function(){return(this.max.x<this.min.x)||(this.max.y<this.min.y);},center:function(a){var b=a||new THREE.Vector2();return b.addVectors(this.min,this.max).multiplyScalar(0.5);},size:function(a){var b=a||new THREE.Vector2();return b.subVectors(this.max,this.min);},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this;},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this;},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this;},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)return false;return true;},containsBox:function(a){if((this.min.x<=a.min.x)&&(a.max.x<=this.max.x)&&(this.min.y<=a.min.y)&&(a.max.y<=this.max.y))return true;return false;},getParameter:function(a,b){var c=b||new THREE.Vector2();return c.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y));},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)return false;return true;},clampPoint:function(a,b){var c=b||new THREE.Vector2();return c.copy(a).clamp(this.min,this.max);},distanceToPoint:function(){var a=new THREE.Vector2();return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length();};}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this;},union:function(a){this.min.min(a.min);this.max.max(a.max);return this;},translate:function(a){this.min.add(a);this.max.add(a);return this;},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max);},clone:function(){return new THREE.Box2().copy(this);}};THREE.Box3=function(a,b){this.min=(a!==undefined)?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=(b!==undefined)?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity);};THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this;},addPoint:function(a){if(a.x<this.min.x)this.min.x=a.x;else if(a.x>this.max.x)this.max.x=a.x;if(a.y<this.min.y)this.min.y=a.y;else if(a.y>this.max.y)this.max.y=a.y;if(a.z<this.min.z)this.min.z=a.z;else if(a.z>this.max.z)this.max.z=a.z;},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b);this.max.copy(b);for(var c=1,d=a.length;c<d;c++)this.addPoint(a[c]);}else this.makeEmpty();return this;},setFromCenterAndSize:function(){var a=new THREE.Vector3();return function(b,c){var d=a.copy(c).multiplyScalar(0.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this;};}(),setFromObject:function(){var a=new THREE.Vector3();return function(b){var c=this;b.updateMatrixWorld(true);this.makeEmpty();b.traverse(function(b){if(b.geometry!==undefined&&b.geometry.vertices!==undefined){var d=b.geometry.vertices;for(var e=0,f=d.length;e<f;e++){a.copy(d[e]);a.applyMatrix4(b.matrixWorld);c.expandByPoint(a);}}});return this;};}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this;},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this;},empty:function(){return(this.max.x<this.min.x)||(this.max.y<this.min.y)||(this.max.z<this.min.z);},center:function(a){var b=a||new THREE.Vector3();return b.addVectors(this.min,this.max).multiplyScalar(0.5);},size:function(a){var b=a||new THREE.Vector3();return b.subVectors(this.max,this.min);},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this;},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this;},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this;},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)return false;return true;},containsBox:function(a){if((this.min.x<=a.min.x)&&(a.max.x<=this.max.x)&&(this.min.y<=a.min.y)&&(a.max.y<=this.max.y)&&(this.min.z<=a.min.z)&&(a.max.z<=this.max.z))return true;return false;},getParameter:function(a,b){var c=b||new THREE.Vector3();return c.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z));},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)return false;return true;},clampPoint:function(a,b){var c=b||new THREE.Vector3();return c.copy(a).clamp(this.min,this.max);},distanceToPoint:function(){var a=new THREE.Vector3();return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length();};}(),getBoundingSphere:function(){var a=new THREE.Vector3();return function(b){var c=b||new THREE.Sphere();c.center=this.center();c.radius=this.size(a).length()*0.5;return c;};}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this;},union:function(a){this.min.min(a.min);this.max.max(a.max);return this;},applyMatrix4:function(){var a=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this;};}(),translate:function(a){this.min.add(a);this.max.add(a);return this;},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max);},clone:function(){return new THREE.Box3().copy(this);}};THREE.Matrix3=function(a,b,c,d,e,f,g,h,i){this.elements=new Float32Array(9);this.set((a!==undefined)?a:1,b||0,c||0,d||0,(e!==undefined)?e:1,f||0,g||0,h||0,(i!==undefined)?i:1);};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;j[0]=a;j[3]=b;j[6]=c;j[1]=d;j[4]=e;j[7]=f;j[2]=g;j[5]=h;j[8]=i;return this;},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this;},copy:function(a){var b=a.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this;},multiplyVector3:function(a){console.warn('DEPRECATED: Matrix3\'s .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');return a.applyMatrix3(this);},multiplyVector3Array:function(){var a=new THREE.Vector3();return function(b){for(var c=0,d=b.length;c<d;c+=3){a.x=b[c];a.y=b[c+1];a.z=b[c+2];a.applyMatrix3(this);b[c]=a.x;b[c+1]=a.y;b[c+2]=a.z;}return b;};}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this;},determinant:function(){var a=this.elements;var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h;},getInverse:function(a,b){var c=a.elements;var d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9];d[1]=-c[10]*c[1]+c[2]*c[9];d[2]=c[6]*c[1]-c[2]*c[5];d[3]=-c[10]*c[4]+c[6]*c[8];d[4]=c[10]*c[0]-c[2]*c[8];d[5]=-c[6]*c[0]+c[2]*c[4];d[6]=c[9]*c[4]-c[5]*c[8];d[7]=-c[9]*c[0]+c[1]*c[8];d[8]=c[5]*c[0]-c[1]*c[4];var e=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(e===0){var f="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b||false)throw new Error(f);else console.warn(f);this.identity();return this;}this.multiplyScalar(1.0/e);return this;},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this;},getNormalMatrix:function(a){this.getInverse(a).transpose();return this;},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this;},fromArray:function(a){this.elements.set(a);return this;},toArray:function(){var a=this.elements;return [a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]];},clone:function(){var a=this.elements;return new THREE.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);}};THREE.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=(a!==undefined)?a:1;q[4]=b||0;q[8]=c||0;q[12]=d||0;q[1]=e||0;q[5]=(f!==undefined)?f:1;q[9]=g||0;q[13]=h||0;q[2]=i||0;q[6]=j||0;q[10]=(k!==undefined)?k:1;q[14]=l||0;q[3]=m||0;q[7]=n||0;q[11]=o||0;q[15]=(p!==undefined)?p:1;};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=h;q[2]=i;q[6]=j;q[10]=k;q[14]=l;q[3]=m;q[7]=n;q[11]=o;q[15]=p;return this;},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this;},copy:function(a){this.elements.set(a.elements);return this;},extractPosition:function(a){console.warn('DEPRECATED: Matrix4\'s .extractPosition() has been renamed to .copyPosition().');return this.copyPosition(a);},copyPosition:function(a){var b=this.elements;var c=a.elements;b[12]=c[12];b[13]=c[13];b[14]=c[14];return this;},extractRotation:function(){var a=new THREE.Vector3();return function(b){var c=this.elements;var d=b.elements;var e=1/a.set(d[0],d[1],d[2]).length();var f=1/a.set(d[4],d[5],d[6]).length();var g=1/a.set(d[8],d[9],d[10]).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*g;c[9]=d[9]*g;c[10]=d[10]*g;return this;};}(),makeRotationFromEuler:function(a){if(a instanceof THREE.Euler===false)console.error('ERROR: Matrix\'s .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.');var b=this.elements;var c=a.x,d=a.y,e=a.z;var f=Math.cos(c),g=Math.sin(c);var h=Math.cos(d),i=Math.sin(d);var j=Math.cos(e),k=Math.sin(e);if(a.order==='XYZ'){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j;b[4]=-h*k;b[8]=i;b[1]=m+n*i;b[5]=l-o*i;b[9]=-g*h;b[2]=o-l*i;b[6]=n+m*i;b[10]=f*h;}else if(a.order==='YXZ'){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p+s*g;b[4]=r*g-q;b[8]=f*i;b[1]=f*k;b[5]=f*j;b[9]=-g;b[2]=q*g-r;b[6]=s+p*g;b[10]=f*h;}else if(a.order==='ZXY'){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p-s*g;b[4]=-f*k;b[8]=r+q*g;b[1]=q+r*g;b[5]=f*j;b[9]=s-p*g;b[2]=-f*i;b[6]=g;b[10]=f*h;}else if(a.order==='ZYX'){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j;b[4]=n*i-m;b[8]=l*i+o;b[1]=h*k;b[5]=o*i+l;b[9]=m*i-n;b[2]=-i;b[6]=g*h;b[10]=f*h;}else if(a.order==='YZX'){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j;b[4]=w-t*k;b[8]=v*k+u;b[1]=k;b[5]=f*j;b[9]=-g*j;b[2]=-i*j;b[6]=u*k+v;b[10]=t-w*k;}else if(a.order==='XZY'){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j;b[4]=-k;b[8]=i*j;b[1]=t*k+w;b[5]=f*j;b[9]=u*k-v;b[2]=v*k-u;b[6]=g*j;b[10]=w*k+t;}b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this;},setRotationFromQuaternion:function(a){console.warn('DEPRECATED: Matrix4\'s .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code.');return this.makeRotationFromQuaternion(a);},makeRotationFromQuaternion:function(a){var b=this.elements;var c=a.x,d=a.y,e=a.z,f=a.w;var g=c+c,h=d+d,i=e+e;var j=c*g,k=c*h,l=c*i;var m=d*h,n=d*i,o=e*i;var p=f*g,q=f*h,r=f*i;b[0]=1-(m+o);b[4]=k-r;b[8]=l+q;b[1]=k+r;b[5]=1-(j+o);b[9]=n-p;b[2]=l-q;b[6]=n+p;b[10]=1-(j+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this;},lookAt:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();var c=new THREE.Vector3();return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();if(c.length()===0)c.z=1;a.crossVectors(f,c).normalize();if(a.length()===0){c.x+=0.0001;a.crossVectors(f,c).normalize();}b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this;};}(),multiply:function(a,b){if(b!==undefined){console.warn('DEPRECATED: Matrix4\'s .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');return this.multiplyMatrices(a,b);}return this.multiplyMatrices(this,a);},multiplyMatrices:function(a,b){var c=a.elements;var d=b.elements;var e=this.elements;var f=c[0],g=c[4],h=c[8],i=c[12];var j=c[1],k=c[5],l=c[9],m=c[13];var n=c[2],o=c[6],p=c[10],q=c[14];var r=c[3],s=c[7],t=c[11],u=c[15];var v=d[0],w=d[4],x=d[8],y=d[12];var z=d[1],A=d[5],B=d[9],C=d[13];var D=d[2],E=d[6],F=d[10],G=d[14];var H=d[3],I=d[7],J=d[11],K=d[15];e[0]=f*v+g*z+h*D+i*H;e[4]=f*w+g*A+h*E+i*I;e[8]=f*x+g*B+h*F+i*J;e[12]=f*y+g*C+h*G+i*K;e[1]=j*v+k*z+l*D+m*H;e[5]=j*w+k*A+l*E+m*I;e[9]=j*x+k*B+l*F+m*J;e[13]=j*y+k*C+l*G+m*K;e[2]=n*v+o*z+p*D+q*H;e[6]=n*w+o*A+p*E+q*I;e[10]=n*x+o*B+p*F+q*J;e[14]=n*y+o*C+p*G+q*K;e[3]=r*v+s*z+t*D+u*H;e[7]=r*w+s*A+t*E+u*I;e[11]=r*x+s*B+t*F+u*J;e[15]=r*y+s*C+t*G+u*K;return this;},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this;},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this;},multiplyVector3:function(a){console.warn('DEPRECATED: Matrix4\'s .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');return a.applyProjection(this);},multiplyVector4:function(a){console.warn('DEPRECATED: Matrix4\'s .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');return a.applyMatrix4(this);},multiplyVector3Array:function(){var a=new THREE.Vector3();return function(b){for(var c=0,d=b.length;c<d;c+=3){a.x=b[c];a.y=b[c+1];a.z=b[c+2];a.applyProjection(this);b[c]=a.x;b[c+1]=a.y;b[c+2]=a.z;}return b;};}(),rotateAxis:function(a){console.warn('DEPRECATED: Matrix4\'s .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');a.transformDirection(this);},crossVector:function(a){console.warn('DEPRECATED: Matrix4\'s .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');return a.applyMatrix4(this);},determinant:function(){var a=this.elements;var b=a[0],c=a[4],d=a[8],e=a[12];var f=a[1],g=a[5],h=a[9],i=a[13];var j=a[2],k=a[6],l=a[10],m=a[14];var n=a[3],o=a[7],p=a[11],q=a[15];return(n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j));},transpose:function(){var a=this.elements;var b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this;},flattenToArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a;},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a;},getPosition:function(){var a=new THREE.Vector3();return function(){console.warn('DEPRECATED: Matrix4\'s .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');var b=this.elements;return a.set(b[12],b[13],b[14]);};}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this;},getInverse:function(a,b){var c=this.elements;var d=a.elements;var e=d[0],f=d[4],g=d[8],h=d[12];var i=d[1],j=d[5],k=d[9],l=d[13];var m=d[2],n=d[6],o=d[10],p=d[14];var q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t;c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t;c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t;c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p;c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t;c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t;c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t;c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p;c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t;c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t;c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t;c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p;c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s;c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s;c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s;c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(u==0){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b||false)throw new Error(v);else console.warn(v);this.identity();return this;}this.multiplyScalar(1/u);return this;},translate:function(a){console.warn('DEPRECATED: Matrix4\'s .translate() has been removed.');},rotateX:function(a){console.warn('DEPRECATED: Matrix4\'s .rotateX() has been removed.');},rotateY:function(a){console.warn('DEPRECATED: Matrix4\'s .rotateY() has been removed.');},rotateZ:function(a){console.warn('DEPRECATED: Matrix4\'s .rotateZ() has been removed.');},rotateByAxis:function(a,b){console.warn('DEPRECATED: Matrix4\'s .rotateByAxis() has been removed.');},scale:function(a){var b=this.elements;var c=a.x,d=a.y,e=a.z;b[0]*=c;b[4]*=d;b[8]*=e;b[1]*=c;b[5]*=d;b[9]*=e;b[2]*=c;b[6]*=d;b[10]*=e;b[3]*=c;b[7]*=d;b[11]*=e;return this;},getMaxScaleOnAxis:function(){var a=this.elements;var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];var c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6];var d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)));},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this;},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1);return this;},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1);return this;},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1);return this;},makeRotationAxis:function(a,b){var c=Math.cos(b);var d=Math.sin(b);var e=1-c;var f=a.x,g=a.y,h=a.z;var i=e*f,j=e*g;this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1);return this;},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this;},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this;},decompose:function(){var a=new THREE.Vector3();var b=new THREE.Matrix4();return function(c,d,e){var f=this.elements;var g=a.set(f[0],f[1],f[2]).length();var h=a.set(f[4],f[5],f[6]).length();var i=a.set(f[8],f[9],f[10]).length();var j=this.determinant();if(j<0)g=-g;c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);var k=1/g;var l=1/h;var m=1/i;b.elements[0]*=k;b.elements[1]*=k;b.elements[2]*=k;b.elements[4]*=l;b.elements[5]*=l;b.elements[6]*=l;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=i;return this;};}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;var h=2*e/(b-a);var i=2*e/(d-c);var j=(b+a)/(b-a);var k=(d+c)/(d-c);var l=-(f+e)/(f-e);var m=-2*f*e/(f-e);g[0]=h;g[4]=0;g[8]=j;g[12]=0;g[1]=0;g[5]=i;g[9]=k;g[13]=0;g[2]=0;g[6]=0;g[10]=l;g[14]=m;g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this;},makePerspective:function(a,b,c,d){var e=c*Math.tan(THREE.Math.degToRad(a*0.5));var f=-e;var g=f*b;var h=e*b;return this.makeFrustum(g,h,f,e,c,d);},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements;var h=b-a;var i=c-d;var j=f-e;var k=(b+a)/h;var l=(c+d)/i;var m=(f+e)/j;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-k;g[1]=0;g[5]=2/i;g[9]=0;g[13]=-l;g[2]=0;g[6]=0;g[10]=-2/j;g[14]=-m;g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this;},fromArray:function(a){this.elements.set(a);return this;},toArray:function(){var a=this.elements;return [a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]];},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);}};THREE.Ray=function(a,b){this.origin=(a!==undefined)?a:new THREE.Vector3();this.direction=(b!==undefined)?b:new THREE.Vector3();};THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this;},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this;},at:function(a,b){var c=b||new THREE.Vector3();return c.copy(this.direction).multiplyScalar(a).add(this.origin);},recast:function(){var a=new THREE.Vector3();return function(b){this.origin.copy(this.at(b,a));return this;};}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3();c.subVectors(a,this.origin);var d=c.dot(this.direction);if(d<0)return c.copy(this.origin);return c.copy(this.direction).multiplyScalar(d).add(this.origin);},distanceToPoint:function(){var a=new THREE.Vector3();return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(c<0)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b);};}(),distanceSqToSegment:function(a,b,c,d){var e=a.clone().add(b).multiplyScalar(0.5);var f=b.clone().sub(a).normalize();var g=a.distanceTo(b)*0.5;var h=this.origin.clone().sub(e);var i=-this.direction.dot(f);var j=h.dot(this.direction);var k=-h.dot(f);var l=h.lengthSq();var m=Math.abs(1-i*i);var n,o,p,q;if(m>=0){n=i*k-j;o=i*j-k;q=g*m;if(n>=0)if(o>=-q)if(o<=q){var r=1/m;n*=r;o*=r;p=n*(n+i*o+2*j)+o*(i*n+o+2*k)+l;}else{o=g;n=Math.max(0,-(i*o+j));p=-n*n+o*(o+2*k)+l;}else{o=-g;n=Math.max(0,-(i*o+j));p=-n*n+o*(o+2*k)+l;}else if(o<=-q){n=Math.max(0,-(-i*g+j));o=(n>0)?-g:Math.min(Math.max(-g,-k),g);p=-n*n+o*(o+2*k)+l;}else if(o<=q){n=0;o=Math.min(Math.max(-g,-k),g);p=o*(o+2*k)+l;}else{n=Math.max(0,-(i*g+j));o=(n>0)?g:Math.min(Math.max(-g,-k),g);p=-n*n+o*(o+2*k)+l;}}else{o=(i>0)?-g:g;n=Math.max(0,-(i*o+j));p=-n*n+o*(o+2*k)+l;}if(c)c.copy(this.direction.clone().multiplyScalar(n).add(this.origin));if(d)d.copy(f.clone().multiplyScalar(o).add(e));return p;},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius;},isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);if(b===0)return true;var c=a.normal.dot(this.direction);if(c*b<0)return true;return false;},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(b==0){if(a.distanceToPoint(this.origin)==0)return 0;return null;}var c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null;},intersectPlane:function(a,b){var c=this.distanceToPlane(a);if(c===null)return null;return this.at(c,b);},isIntersectionBox:function(){var a=new THREE.Vector3();return function(b){return this.intersectBox(b,a)!==null;};}(),intersectBox:function(a,b){var c,d,e,f,g,h;var i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z;var l=this.origin;if(i>=0){c=(a.min.x-l.x)*i;d=(a.max.x-l.x)*i;}else{c=(a.max.x-l.x)*i;d=(a.min.x-l.x)*i;}if(j>=0){e=(a.min.y-l.y)*j;f=(a.max.y-l.y)*j;}else{e=(a.max.y-l.y)*j;f=(a.min.y-l.y)*j;}if((c>f)||(e>d))return null;if(e>c||c!==c)c=e;if(f<d||d!==d)d=f;if(k>=0){g=(a.min.z-l.z)*k;h=(a.max.z-l.z)*k;}else{g=(a.max.z-l.z)*k;h=(a.min.z-l.z)*k;}if((c>h)||(g>d))return null;if(g>c||c!==c)c=g;if(h<d||d!==d)d=h;if(d<0)return null;return this.at(c>=0?c:d,b);},intersectTriangle:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();var c=new THREE.Vector3();var d=new THREE.Vector3();return function(e,f,g,h,i){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);var j=this.direction.dot(d);var k;if(j>0){if(h)return null;k=1;}else if(j<0){k=-1;j=-j;}else return null;a.subVectors(this.origin,e);var l=k*this.direction.dot(c.crossVectors(a,c));if(l<0)return null;var m=k*this.direction.dot(b.cross(a));if(m<0)return null;if(l+m>j)return null;var n=-k*a.dot(d);if(n<0)return null;return this.at(n/j,i);};}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this;},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction);},clone:function(){return new THREE.Ray().copy(this);}};THREE.Sphere=function(a,b){this.center=(a!==undefined)?a:new THREE.Vector3();this.radius=(b!==undefined)?b:0;};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this;},setFromPoints:function(){var a=new THREE.Box3();return function(b,c){var d=this.center;if(c!==undefined)d.copy(c);else a.setFromPoints(b).center(d);var e=0;for(var f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this;};}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this;},empty:function(){return(this.radius<=0);},containsPoint:function(a){return(a.distanceToSquared(this.center)<=(this.radius*this.radius));},distanceToPoint:function(a){return(a.distanceTo(this.center)-this.radius);},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=(b*b);},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);var d=b||new THREE.Vector3();d.copy(a);if(c>(this.radius*this.radius)){d.sub(this.center).normalize();d.multiplyScalar(this.radius).add(this.center);}return d;},getBoundingBox:function(a){var b=a||new THREE.Box3();b.set(this.center,this.center);b.expandByScalar(this.radius);return b;},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius=this.radius*a.getMaxScaleOnAxis();return this;},translate:function(a){this.center.add(a);return this;},equals:function(a){return a.center.equals(this.center)&&(a.radius===this.radius);},clone:function(){return new THREE.Sphere().copy(this);}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[(a!==undefined)?a:new THREE.Plane(),(b!==undefined)?b:new THREE.Plane(),(c!==undefined)?c:new THREE.Plane(),(d!==undefined)?d:new THREE.Plane(),(e!==undefined)?e:new THREE.Plane(),(f!==undefined)?f:new THREE.Plane()];};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this;},copy:function(a){var b=this.planes;for(var c=0;c<6;c++)b[c].copy(a.planes[c]);return this;},setFromMatrix:function(a){var b=this.planes;var c=a.elements;var d=c[0],e=c[1],f=c[2],g=c[3];var h=c[4],i=c[5],j=c[6],k=c[7];var l=c[8],m=c[9],n=c[10],o=c[11];var p=c[12],q=c[13],r=c[14],s=c[15];b[0].setComponents(g-d,k-h,o-l,s-p).normalize();b[1].setComponents(g+d,k+h,o+l,s+p).normalize();b[2].setComponents(g+e,k+i,o+m,s+q).normalize();b[3].setComponents(g-e,k-i,o-m,s-q).normalize();b[4].setComponents(g-f,k-j,o-n,s-r).normalize();b[5].setComponents(g+f,k+j,o+n,s+r).normalize();return this;},intersectsObject:function(){var a=new THREE.Sphere();return function(b){var c=b.geometry;if(c.boundingSphere===null)c.computeBoundingSphere();a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a);};}(),intersectsSphere:function(a){var b=this.planes;var c=a.center;var d=-a.radius;for(var e=0;e<6;e++){var f=b[e].distanceToPoint(c);if(f<d)return false;}return true;},intersectsBox:function(){var a=new THREE.Vector3(),b=new THREE.Vector3();return function(c){var d=this.planes;for(var e=0;e<6;e++){var f=d[e];a.x=f.normal.x>0?c.min.x:c.max.x;b.x=f.normal.x>0?c.max.x:c.min.x;a.y=f.normal.y>0?c.min.y:c.max.y;b.y=f.normal.y>0?c.max.y:c.min.y;a.z=f.normal.z>0?c.min.z:c.max.z;b.z=f.normal.z>0?c.max.z:c.min.z;var g=f.distanceToPoint(a);var h=f.distanceToPoint(b);if(g<0&&h<0)return false;}return true;};}(),containsPoint:function(a){var b=this.planes;for(var c=0;c<6;c++)if(b[c].distanceToPoint(a)<0)return false;return true;},clone:function(){return new THREE.Frustum().copy(this);}};THREE.Plane=function(a,b){this.normal=(a!==undefined)?a:new THREE.Vector3(1,0,0);this.constant=(b!==undefined)?b:0;};THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this;},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this;},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this;},setFromCoplanarPoints:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(c,d,e){var f=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(f,c);return this;};}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this;},normalize:function(){var a=1.0/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this;},negate:function(){this.constant*=-1;this.normal.negate();return this;},distanceToPoint:function(a){return this.normal.dot(a)+this.constant;},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius;},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate();},orthoPoint:function(a,b){var c=this.distanceToPoint(a);var d=b||new THREE.Vector3();return d.copy(this.normal).multiplyScalar(c);},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);var c=this.distanceToPoint(a.end);return(b<0&&c>0)||(c<0&&b>0);},intersectLine:function(){var a=new THREE.Vector3();return function(b,c){var d=c||new THREE.Vector3();var e=b.delta(a);var f=this.normal.dot(e);if(f==0){if(this.distanceToPoint(b.start)==0)return d.copy(b.start);return undefined;}var g=-(b.start.dot(this.normal)+this.constant)/f;if(g<0||g>1)return undefined;return d.copy(e).multiplyScalar(g).add(b.start);};}(),coplanarPoint:function(a){var b=a||new THREE.Vector3();return b.copy(this.normal).multiplyScalar(-this.constant);},applyMatrix4:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();var c=new THREE.Matrix3();return function(d,e){var f=e||c.getNormalMatrix(d);var g=a.copy(this.normal).applyMatrix3(f);var h=this.coplanarPoint(b);h.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(g,h);return this;};}(),translate:function(a){this.constant=this.constant-a.dot(this.normal);return this;},equals:function(a){return a.normal.equals(this.normal)&&(a.constant==this.constant);},clone:function(){return new THREE.Plane().copy(this);}};THREE.Math={PI2:Math.PI*2,generateUUID:function(){var a='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');var b=new Array(36);var c=0,d;return function(){for(var e=0;e<36;e++)if(e==8||e==13||e==18||e==23)b[e]='-';else if(e==14)b[e]='4';else{if(c<=0x02)c=0x2000000+(Math.random()*0x1000000)|0;d=c&0xf;c=c>>4;b[e]=a[(e==19)?(d&0x3)|0x8:d];}return b.join('');};}(),clamp:function(a,b,c){return(a<b)?b:((a>c)?c:a);},clampBottom:function(a,b){return a<b?b:a;},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b);},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a);},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(a*6-15)+10);},random16:function(){return(65280*Math.random()+255*Math.random())/65535;},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1));},randFloat:function(a,b){return a+Math.random()*(b-a);},randFloatSpread:function(a){return a*(0.5-Math.random());},sign:function(a){return(a<0)?-1:(a>0)?1:0;},degToRad:function(){var a=Math.PI/180;return function(b){return b*a;};}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a;};}(),isPowerOfTwo:function(a){return(a&(a-1))===0&&a!==0;}};THREE.Spline=function(a){this.points=a;var b=[],c={x:0,y:0,z:0},d,e,f,g,h,i,j,k,l;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]};};this.getPoint=function(a){d=(this.points.length-1)*a;e=Math.floor(d);f=d-e;b[0]=e===0?e:e-1;b[1]=e;b[2]=e>this.points.length-2?this.points.length-1:e+1;b[3]=e>this.points.length-3?this.points.length-1:e+2;i=this.points[b[0]];j=this.points[b[1]];k=this.points[b[2]];l=this.points[b[3]];g=f*f;h=f*g;c.x=m(i.x,j.x,k.x,l.x,f,g,h);c.y=m(i.y,j.y,k.y,l.y,f,g,h);c.z=m(i.z,j.z,k.z,l.z,f,g,h);return c;};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++){b=this.points[a];d[a]=[b.x,b.y,b.z];}return d;};this.getLength=function(a){var b,c,d,e,f=0,g=0,h=0,i=new THREE.Vector3(),j=new THREE.Vector3(),k=[],l=0;k[0]=0;if(!a)a=100;d=this.points.length*a;i.copy(this.points[0]);for(b=1;b<d;b++){c=b/d;e=this.getPoint(c);j.copy(e);l+=j.distanceTo(i);i.copy(e);f=(this.points.length-1)*c;g=Math.floor(f);if(g!=h){k[g]=l;h=g;}}k[k.length]=l;return{chunks:k,total:l};};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h,i,j,k=[],l=new THREE.Vector3(),m=this.getLength();k.push(l.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){h=m.chunks[b]-m.chunks[b-1];i=Math.ceil(a*h/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<i-1;c++){d=e+c*(1/i)*(f-e);j=this.getPoint(d);k.push(l.copy(j).clone());}k.push(l.copy(this.points[b]).clone());}this.points=k;};function m(a,b,c,d,e,f,g){var h=(c-a)*0.5,i=(d-b)*0.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b;};};THREE.Triangle=function(a,b,c){this.a=(a!==undefined)?a:new THREE.Vector3();this.b=(b!==undefined)?b:new THREE.Vector3();this.c=(c!==undefined)?c:new THREE.Vector3();};THREE.Triangle.normal=function(){var a=new THREE.Vector3();return function(b,c,d,e){var f=e||new THREE.Vector3();f.subVectors(d,c);a.subVectors(b,c);f.cross(a);var g=f.lengthSq();if(g>0)return f.multiplyScalar(1/Math.sqrt(g));return f.set(0,0,0);};}();THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3();var b=new THREE.Vector3();var c=new THREE.Vector3();return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);var i=a.dot(a);var j=a.dot(b);var k=a.dot(c);var l=b.dot(b);var m=b.dot(c);var n=(i*l-j*j);var o=h||new THREE.Vector3();if(n==0)return o.set(-2,-1,-1);var p=1/n;var q=(l*k-j*m)*p;var r=(i*m-j*k)*p;return o.set(1-q-r,r,q);};}();THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3();return function(b,c,d,e){var f=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return(f.x>=0)&&(f.y>=0)&&((f.x+f.y)<=1);};}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this;},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this;},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this;},area:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return a.cross(b).length()*0.5;};}(),midpoint:function(a){var b=a||new THREE.Vector3();return b.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3);},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a);},plane:function(a){var b=a||new THREE.Plane();return b.setFromCoplanarPoints(this.a,this.b,this.c);},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b);},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c);},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c);},clone:function(){return new THREE.Triangle().copy(this);}};THREE.Vertex=function(a){console.warn('THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.');return a;};THREE.UV=function(a,b){console.warn('THREE.UV has been DEPRECATED. Use THREE.Vector2 instead.');return new THREE.Vector2(a,b);};THREE.Clock=function(a){this.autoStart=(a!==undefined)?a:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false;};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true;},stop:function(){this.getElapsedTime();this.running=false;},getElapsedTime:function(){this.getDelta();return this.elapsedTime;},getDelta:function(){var a=0;if(this.autoStart&&!this.running)this.start();if(this.running){var b=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();a=0.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a;}return a;}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent;},addEventListener:function(a,b){if(this._listeners===undefined)this._listeners={};var c=this._listeners;if(c[a]===undefined)c[a]=[];if(c[a].indexOf(b)===-1)c[a].push(b);},hasEventListener:function(a,b){if(this._listeners===undefined)return false;var c=this._listeners;if(c[a]!==undefined&&c[a].indexOf(b)!==-1)return true;return false;},removeEventListener:function(a,b){if(this._listeners===undefined)return;var c=this._listeners;var d=c[a];if(d!==undefined){var e=d.indexOf(b);if(e!==-1)d.splice(e,1);}},dispatchEvent:function(){var a=[];return function(b){if(this._listeners===undefined)return;var c=this._listeners;var d=c[b.type];if(d!==undefined){b.target=this;var e=d.length;for(var f=0;f<e;f++)a[f]=d[f];for(var f=0;f<e;f++)a[f].call(this,b);}};}()};(function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c);this.near=d||0;this.far=e||Infinity;};var b=new a.Sphere();var c=new a.Ray();var d=new a.Plane();var e=new a.Vector3();var f=new a.Vector3();var g=new a.Matrix4();var h=function(a,b){return a.distance-b.distance;};var i=new a.Vector3();var j=new a.Vector3();var k=new a.Vector3();var l=function(d,e,h){if(d instanceof a.Sprite){f.setFromMatrixPosition(d.matrixWorld);var m=e.ray.distanceToPoint(f);if(m>d.scale.x)return h;h.push({distance:m,point:d.position,face:null,object:d});}else if(d instanceof a.LOD){f.setFromMatrixPosition(d.matrixWorld);var m=e.ray.origin.distanceTo(f);l(d.getObjectForDistance(m),e,h);}else if(d instanceof a.Mesh){var n=d.geometry;if(n.boundingSphere===null)n.computeBoundingSphere();b.copy(n.boundingSphere);b.applyMatrix4(d.matrixWorld);if(e.ray.isIntersectionSphere(b)===false)return h;g.getInverse(d.matrixWorld);c.copy(e.ray).applyMatrix4(g);if(n.boundingBox!==null)if(c.isIntersectionBox(n.boundingBox)===false)return h;if(n instanceof a.BufferGeometry){var o=d.material;if(o===undefined)return h;var p=n.attributes;var q,r,s;var t=e.precision;if(p.index!==undefined){var u=n.offsets;var v=p.index.array;var w=p.position.array;for(var x=0,y=u.length;x<y;++x){var z=u[x].start;var A=u[x].count;var B=u[x].index;for(var C=z,D=z+A;C<D;C+=3){q=B+v[C];r=B+v[C+1];s=B+v[C+2];i.set(w[q*3],w[q*3+1],w[q*3+2]);j.set(w[r*3],w[r*3+1],w[r*3+2]);k.set(w[s*3],w[s*3+1],w[s*3+2]);if(o.side===a.BackSide)var E=c.intersectTriangle(k,j,i,true);else var E=c.intersectTriangle(i,j,k,o.side!==a.DoubleSide);if(E===null)continue;E.applyMatrix4(d.matrixWorld);var m=e.ray.origin.distanceTo(E);if(m<t||m<e.near||m>e.far)continue;h.push({distance:m,point:E,indices:[q,r,s],face:null,faceIndex:null,object:d});}}}else{var u=n.offsets;var w=p.position.array;for(var C=0,D=p.position.array.length;C<D;C+=3){q=C;r=C+1;s=C+2;i.set(w[q*3],w[q*3+1],w[q*3+2]);j.set(w[r*3],w[r*3+1],w[r*3+2]);k.set(w[s*3],w[s*3+1],w[s*3+2]);if(o.side===a.BackSide)var E=c.intersectTriangle(k,j,i,true);else var E=c.intersectTriangle(i,j,k,o.side!==a.DoubleSide);if(E===null)continue;E.applyMatrix4(d.matrixWorld);var m=e.ray.origin.distanceTo(E);if(m<t||m<e.near||m>e.far)continue;h.push({distance:m,point:E,indices:[q,r,s],face:null,faceIndex:null,object:d});}}}else if(n instanceof a.Geometry){var F=d.material instanceof a.MeshFaceMaterial;var G=F===true?d.material.materials:null;var q,r,s,H;var t=e.precision;var I=n.vertices;for(var J=0,K=n.faces.length;J<K;J++){var L=n.faces[J];var o=F===true?G[L.materialIndex]:d.material;if(o===undefined)continue;q=I[L.a];r=I[L.b];s=I[L.c];if(o.morphTargets===true){var M=n.morphTargets;var N=d.morphTargetInfluences;i.set(0,0,0);j.set(0,0,0);k.set(0,0,0);for(var O=0,P=M.length;O<P;O++){var Q=N[O];if(Q===0)continue;var R=M[O].vertices;i.x+=(R[L.a].x-q.x)*Q;i.y+=(R[L.a].y-q.y)*Q;i.z+=(R[L.a].z-q.z)*Q;j.x+=(R[L.b].x-r.x)*Q;j.y+=(R[L.b].y-r.y)*Q;j.z+=(R[L.b].z-r.z)*Q;k.x+=(R[L.c].x-s.x)*Q;k.y+=(R[L.c].y-s.y)*Q;k.z+=(R[L.c].z-s.z)*Q;}i.add(q);j.add(r);k.add(s);q=i;r=j;s=k;}if(o.side===a.BackSide)var E=c.intersectTriangle(s,r,q,true);else var E=c.intersectTriangle(q,r,s,o.side!==a.DoubleSide);if(E===null)continue;E.applyMatrix4(d.matrixWorld);var m=e.ray.origin.distanceTo(E);if(m<t||m<e.near||m>e.far)continue;h.push({distance:m,point:E,face:L,faceIndex:J,object:d});}}}else if(d instanceof a.Line){var t=e.linePrecision;var S=t*t;var n=d.geometry;if(n.boundingSphere===null)n.computeBoundingSphere();b.copy(n.boundingSphere);b.applyMatrix4(d.matrixWorld);if(e.ray.isIntersectionSphere(b)===false)return h;g.getInverse(d.matrixWorld);c.copy(e.ray).applyMatrix4(g);if(n instanceof a.Geometry){var I=n.vertices;var T=I.length;var U=new a.Vector3();var V=new a.Vector3();var W=d.type===a.LineStrip?1:2;for(var C=0;C<T-1;C=C+W){var X=c.distanceSqToSegment(I[C],I[C+1],V,U);if(X>S)continue;var m=c.origin.distanceTo(V);if(m<e.near||m>e.far)continue;h.push({distance:m,point:U.clone().applyMatrix4(d.matrixWorld),face:null,faceIndex:null,object:d});}}}};var m=function(a,b,c){var d=a.getDescendants();for(var e=0,f=d.length;e<f;e++)l(d[e],b,c);};a.Raycaster.prototype.precision=0.0001;a.Raycaster.prototype.linePrecision=1;a.Raycaster.prototype.set=function(a,b){this.ray.set(a,b);};a.Raycaster.prototype.intersectObject=function(a,b){var c=[];if(b===true)m(a,this,c);l(a,this,c);c.sort(h);return c;};a.Raycaster.prototype.intersectObjects=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){l(a[d],this,c);if(b===true)m(a[d],this,c);}c.sort(h);return c;};}(THREE));THREE.Object3D=function(){this.id=THREE.Object3DIdCount++;this.uuid=THREE.Math.generateUUID();this.name='';this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3();this._rotation=new THREE.Euler();this._quaternion=new THREE.Quaternion();this.scale=new THREE.Vector3(1,1,1);this._rotation._quaternion=this.quaternion;this._quaternion._euler=this.rotation;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4();this.matrixWorld=new THREE.Matrix4();this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={};};THREE.Object3D.prototype={constructor:THREE.Object3D,get rotation(){return this._rotation;},set rotation(value){this._rotation=value;this._rotation._quaternion=this._quaternion;this._quaternion._euler=this._rotation;this._rotation._updateQuaternion();},get quaternion(){return this._quaternion;},set quaternion(value){this._quaternion=value;this._quaternion._euler=this._rotation;this._rotation._quaternion=this._quaternion;this._quaternion._updateEuler();},get eulerOrder(){console.warn('DEPRECATED: Object3D\'s .eulerOrder has been moved to Object3D\'s .rotation.order.');return this.rotation.order;},set eulerOrder(value){console.warn('DEPRECATED: Object3D\'s .eulerOrder has been moved to Object3D\'s .rotation.order.');this.rotation.order=value;},get useQuaternion(){console.warn('DEPRECATED: Object3D\'s .useQuaternion has been removed. The library now uses quaternions by default.');},set useQuaternion(value){console.warn('DEPRECATED: Object3D\'s .useQuaternion has been removed. The library now uses quaternions by default.');},applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale);},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b);},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,true);},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a);},setRotationFromQuaternion:function(a){this.quaternion.copy(a);},rotateOnAxis:function(){var a=new THREE.Quaternion();return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this;};}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b);};}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b);};}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b);};}(),translateOnAxis:function(){var a=new THREE.Vector3();return function(b,c){a.copy(b);a.applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this;};}(),translate:function(a,b){console.warn('DEPRECATED: Object3D\'s .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed.');return this.translateOnAxis(b,a);},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b);};}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b);};}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b);};}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld);},worldToLocal:function(){var a=new THREE.Matrix4();return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld));};}(),lookAt:function(){var a=new THREE.Matrix4();return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a);};}(),add:function(a){if(a===this){console.warn('THREE.Object3D.add: An object can\'t be added as a child of itself.');return;}if(a instanceof THREE.Object3D){if(a.parent!==undefined)a.parent.remove(a);a.parent=this;a.dispatchEvent({type:'added'});this.children.push(a);var b=this;while(b.parent!==undefined)b=b.parent;if(b!==undefined&&b instanceof THREE.Scene)b.__addObject(a);}},remove:function(a){var b=this.children.indexOf(a);if(b!==-1){a.parent=undefined;a.dispatchEvent({type:'removed'});this.children.splice(b,1);var c=this;while(c.parent!==undefined)c=c.parent;if(c!==undefined&&c instanceof THREE.Scene)c.__removeObject(a);}},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a);},getObjectById:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.id===a)return e;if(b===true){e=e.getObjectById(a,b);if(e!==undefined)return e;}}return undefined;},getObjectByName:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.name===a)return e;if(b===true){e=e.getObjectByName(a,b);if(e!==undefined)return e;}}return undefined;},getChildByName:function(a,b){console.warn('DEPRECATED: Object3D\'s .getChildByName() has been renamed to .getObjectByName().');return this.getObjectByName(a,b);},getDescendants:function(a){if(a===undefined)a=[];Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;b<c;b++)this.children[b].getDescendants(a);return a;},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true;},updateMatrixWorld:function(a){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||a===true){if(this.parent===undefined)this.matrixWorld.copy(this.matrix);else this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorldNeedsUpdate=false;a=true;}for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a);},clone:function(a,b){if(a===undefined)a=new THREE.Object3D();if(b===undefined)b=true;a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.renderDepth=this.renderDepth;a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(b===true)for(var c=0;c<this.children.length;c++){var d=this.children[c];a.add(d.clone());}return a;}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Projector=function(){var a,b,c=[],d=0,e,f,g=[],h=0,i,j,k=[],l=0,m,n,o=[],p=0,q,r,s=[],t=0,u={objects:[],lights:[],elements:[]},v=new THREE.Vector3(),w=new THREE.Vector3(),x=new THREE.Vector3(),y=new THREE.Vector3(),z=new THREE.Vector4(),A=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),B=new THREE.Box3(),C=new Array(3),D=new Array(4),E=new THREE.Matrix4(),F=new THREE.Matrix4(),G,H=new THREE.Matrix4(),I=new THREE.Matrix3(),J=new THREE.Frustum(),K=new THREE.Vector4(),L=new THREE.Vector4();this.projectVector=function(a,b){b.matrixWorldInverse.getInverse(b.matrixWorld);F.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);return a.applyProjection(F);};this.unprojectVector=function(){var a=new THREE.Matrix4();return function(b,c){a.getInverse(c.projectionMatrix);F.multiplyMatrices(c.matrixWorld,a);return b.applyProjection(F);};}();this.pickingRay=function(a,b){a.z=-1.0;var c=new THREE.Vector3(a.x,a.y,1.0);this.unprojectVector(a,b);this.unprojectVector(c,b);c.sub(a).normalize();return new THREE.Raycaster(a,c);};var M=function(b){if(b.visible===false)return;if(b instanceof THREE.Light)u.lights.push(b);else if(b instanceof THREE.Mesh||b instanceof THREE.Line||b instanceof THREE.Sprite)if(b.frustumCulled===false||J.intersectsObject(b)===true){a=Q();a.id=b.id;a.object=b;if(b.renderDepth!==null)a.z=b.renderDepth;else{y.setFromMatrixPosition(b.matrixWorld);y.applyProjection(F);a.z=y.z;}u.objects.push(a);}for(var c=0,d=b.children.length;c<d;c++)M(b.children[c]);};var N=function(a,c){b=0;u.objects.length=0;u.lights.length=0;M(a);if(c===true)u.objects.sort(V);};var O=function(){var a=[];var b=null;var c=new THREE.Matrix3();var d=function(d){b=d;c.getNormalMatrix(b.matrixWorld);a.length=0;};var f=function(a){var b=a.position;var c=a.positionWorld;var d=a.positionScreen;c.copy(b).applyMatrix4(G);d.copy(c).applyMatrix4(F);var e=1/d.w;d.x*=e;d.y*=e;d.z*=e;a.visible=d.x>=-1&&d.x<=1&&d.y>=-1&&d.y<=1&&d.z>=-1&&d.z<=1;};var h=function(a,b,c){e=R();e.position.set(a,b,c);f(e);};var j=function(b,c,d){a.push(b,c,d);};var k=function(a,b,c){C[0]=a.positionScreen;C[1]=b.positionScreen;C[2]=c.positionScreen;if(a.visible===true||b.visible===true||c.visible===true||A.isIntersectionBox(B.setFromPoints(C)))return((c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x))<0;return false;};var l=function(a,c){var d=g[a];var e=g[c];m=T();m.id=b.id;m.v1.copy(d);m.v2.copy(e);m.z=(d.positionScreen.z+e.positionScreen.z)/2;m.material=b.material;u.elements.push(m);};var n=function(d,e,f){var h=g[d];var j=g[e];var l=g[f];if(k(h,j,l)===true){i=S();i.id=b.id;i.v1.copy(h);i.v2.copy(j);i.v3.copy(l);i.z=(h.positionScreen.z+j.positionScreen.z+l.positionScreen.z)/3;for(var m=0;m<3;m++){var n=arguments[m]*3;var o=i.vertexNormalsModel[m];o.set(a[n+0],a[n+1],a[n+2]);o.applyMatrix3(c).normalize();}i.vertexNormalsLength=3;i.material=b.material;u.elements.push(i);}};return{setObject:d,projectVertex:f,checkTriangleVisibility:k,pushVertex:h,pushNormal:j,pushLine:l,pushTriangle:n};};var P=new O();this.projectScene=function(a,b,c,d){var e,h,k,l,o,p,s,t,y,A;j=0;n=0;r=0;u.elements.length=0;if(a.autoUpdate===true)a.updateMatrixWorld();if(b.parent===undefined)b.updateMatrixWorld();E.copy(b.matrixWorldInverse.getInverse(b.matrixWorld));F.multiplyMatrices(b.projectionMatrix,E);J.setFromMatrix(F);N(a,c);for(var B=0,C=u.objects.length;B<C;B++){e=u.objects[B].object;h=e.geometry;P.setObject(e);G=e.matrixWorld;f=0;if(e instanceof THREE.Mesh){if(h instanceof THREE.BufferGeometry){var D=h.attributes;var M=h.offsets;if(D.position===undefined)continue;var O=D.position.array;for(var Q=0,X=O.length;Q<X;Q+=3)P.pushVertex(O[Q],O[Q+1],O[Q+2]);var Y=D.normal.array;for(var Q=0,X=Y.length;Q<X;Q+=3)P.pushNormal(Y[Q],Y[Q+1],Y[Q+2]);if(D.index!==undefined){var Z=D.index.array;if(M.length>0)for(var B=0;B<M.length;B++){var $=M[B];var _=$.index;for(var Q=$.start,X=$.start+$.count;Q<X;Q+=3)P.pushTriangle(Z[Q]+_,Z[Q+1]+_,Z[Q+2]+_);}else for(var Q=0,X=Z.length;Q<X;Q+=3)P.pushTriangle(Z[Q],Z[Q+1],Z[Q+2]);}else for(var Q=0,X=O.length/3;Q<X;Q+=3)P.pushTriangle(Q,Q+1,Q+2);}else if(h instanceof THREE.Geometry){k=h.vertices;l=h.faces;s=h.faceVertexUvs;I.getNormalMatrix(G);y=e.material instanceof THREE.MeshFaceMaterial;A=y===true?e.material:null;for(var ab=0,ac=k.length;ab<ac;ab++){var ad=k[ab];P.pushVertex(ad.x,ad.y,ad.z);}for(var ae=0,af=l.length;ae<af;ae++){o=l[ae];var ag=y===true?A.materials[o.materialIndex]:e.material;if(ag===undefined)continue;var ah=ag.side;var ai=g[o.a];var aj=g[o.b];var ak=g[o.c];if(ag.morphTargets===true){var al=h.morphTargets;var am=e.morphTargetInfluences;var an=ai.position;var ao=aj.position;var ap=ak.position;v.set(0,0,0);w.set(0,0,0);x.set(0,0,0);for(var aq=0,ar=al.length;aq<ar;aq++){var as=am[aq];if(as===0)continue;var at=al[aq].vertices;v.x+=(at[o.a].x-an.x)*as;v.y+=(at[o.a].y-an.y)*as;v.z+=(at[o.a].z-an.z)*as;w.x+=(at[o.b].x-ao.x)*as;w.y+=(at[o.b].y-ao.y)*as;w.z+=(at[o.b].z-ao.z)*as;x.x+=(at[o.c].x-ap.x)*as;x.y+=(at[o.c].y-ap.y)*as;x.z+=(at[o.c].z-ap.z)*as;}ai.position.add(v);aj.position.add(w);ak.position.add(x);P.projectVertex(ai);P.projectVertex(aj);P.projectVertex(ak);}var au=P.checkTriangleVisibility(ai,aj,ak);if((au===false&&ah===THREE.FrontSide)||(au===true&&ah===THREE.BackSide))continue;i=S();i.id=e.id;i.v1.copy(ai);i.v2.copy(aj);i.v3.copy(ak);i.normalModel.copy(o.normal);if(au===false&&(ah===THREE.BackSide||ah===THREE.DoubleSide))i.normalModel.negate();i.normalModel.applyMatrix3(I).normalize();i.centroidModel.copy(o.centroid).applyMatrix4(G);p=o.vertexNormals;for(var av=0,aw=Math.min(p.length,3);av<aw;av++){var ax=i.vertexNormalsModel[av];ax.copy(p[av]);if(au===false&&(ah===THREE.BackSide||ah===THREE.DoubleSide))ax.negate();ax.applyMatrix3(I).normalize();}i.vertexNormalsLength=p.length;for(var ay=0,az=Math.min(s.length,3);ay<az;ay++){t=s[ay][ae];if(t===undefined)continue;for(var aA=0,aB=t.length;aA<aB;aA++)i.uvs[ay][aA]=t[aA];}i.color=o.color;i.material=ag;i.z=(ai.positionScreen.z+aj.positionScreen.z+ak.positionScreen.z)/3;u.elements.push(i);}}}else if(e instanceof THREE.Line){if(h instanceof THREE.BufferGeometry){var D=h.attributes;if(D.position!==undefined){var O=D.position.array;for(var Q=0,X=O.length;Q<X;Q+=3)P.pushVertex(O[Q],O[Q+1],O[Q+2]);if(D.index!==undefined){var Z=D.index.array;for(var Q=0,X=Z.length;Q<X;Q+=2)P.pushLine(Z[Q],Z[Q+1]);}else for(var Q=0,X=(O.length/3)-1;Q<X;Q++)P.pushLine(Q,Q+1);}}else if(h instanceof THREE.Geometry){H.multiplyMatrices(F,G);k=e.geometry.vertices;if(k.length===0)continue;ai=R();ai.positionScreen.copy(k[0]).applyMatrix4(H);var aC=e.type===THREE.LinePieces?2:1;for(var ab=1,ac=k.length;ab<ac;ab++){ai=R();ai.positionScreen.copy(k[ab]).applyMatrix4(H);if((ab+1)%aC>0)continue;aj=g[f-2];K.copy(ai.positionScreen);L.copy(aj.positionScreen);if(W(K,L)===true){K.multiplyScalar(1/K.w);L.multiplyScalar(1/L.w);m=T();m.id=e.id;m.v1.positionScreen.copy(K);m.v2.positionScreen.copy(L);m.z=Math.max(K.z,L.z);m.material=e.material;if(e.material.vertexColors===THREE.VertexColors){m.vertexColors[0].copy(e.geometry.colors[ab]);m.vertexColors[1].copy(e.geometry.colors[ab-1]);}u.elements.push(m);}}}}else if(e instanceof THREE.Sprite){z.set(G.elements[12],G.elements[13],G.elements[14],1);z.applyMatrix4(F);var aD=1/z.w;z.z*=aD;if(z.z>=-1&&z.z<=1){q=U();q.id=e.id;q.x=z.x*aD;q.y=z.y*aD;q.z=z.z;q.object=e;q.rotation=e.rotation;q.scale.x=e.scale.x*Math.abs(q.x-(z.x+b.projectionMatrix.elements[0])/(z.w+b.projectionMatrix.elements[12]));q.scale.y=e.scale.y*Math.abs(q.y-(z.y+b.projectionMatrix.elements[5])/(z.w+b.projectionMatrix.elements[13]));q.material=e.material;u.elements.push(q);}}}if(d===true)u.elements.sort(V);return u;};function Q(){if(b===d){var a=new THREE.RenderableObject();c.push(a);d++;b++;return a;}return c[b++];}function R(){if(f===h){var a=new THREE.RenderableVertex();g.push(a);h++;f++;return a;}return g[f++];}function S(){if(j===l){var a=new THREE.RenderableFace();k.push(a);l++;j++;return a;}return k[j++];}function T(){if(n===p){var a=new THREE.RenderableLine();o.push(a);p++;n++;return a;}return o[n++];}function U(){if(r===t){var a=new THREE.RenderableSprite();s.push(a);t++;r++;return a;}return s[r++];}function V(a,b){if(a.z!==b.z)return b.z-a.z;else if(a.id!==b.id)return a.id-b.id;else return 0;}function W(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(e>=0&&f>=0&&g>=0&&h>=0)return true;else if((e<0&&f<0)||(g<0&&h<0))return false;else{if(e<0)c=Math.max(c,e/(e-f));else if(f<0)d=Math.min(d,e/(e-f));if(g<0)c=Math.max(c,g/(g-h));else if(h<0)d=Math.min(d,g/(g-h));if(d<c)return false;else{a.lerp(b,c);b.lerp(a,1-d);return true;}}}};THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3();this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color();this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=f!==undefined?f:0;this.centroid=new THREE.Vector3();};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.centroid.copy(this.centroid);a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a;}};THREE.Face4=function(a,b,c,d,e,f,g){console.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.');return new THREE.Face3(a,b,c,e,f,g);};THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name='';this.attributes={};this.offsets=[];this.boundingBox=null;this.boundingSphere=null;};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b,c,d){this.attributes[a]={array:new b(c*d),itemSize:d};return this.attributes[a];},applyMatrix:function(a){var b=this.attributes.position;if(b!==undefined){a.multiplyVector3Array(b.array);b.needsUpdate=true;}var c=this.attributes.normal;if(c!==undefined){var d=new THREE.Matrix3().getNormalMatrix(a);d.multiplyVector3Array(c.array);c.needsUpdate=true;}},computeBoundingBox:function(){if(this.boundingBox===null)this.boundingBox=new THREE.Box3();var a=this.attributes.position.array;if(a){var b=this.boundingBox;if(a.length>=3){b.min.x=b.max.x=a[0];b.min.y=b.max.y=a[1];b.min.z=b.max.z=a[2];}for(var c=3,d=a.length;c<d;c+=3){var e=a[c];var f=a[c+1];var g=a[c+2];if(e<b.min.x)b.min.x=e;else if(e>b.max.x)b.max.x=e;if(f<b.min.y)b.min.y=f;else if(f>b.max.y)b.max.y=f;if(g<b.min.z)b.min.z=g;else if(g>b.max.z)b.max.z=g;}}if(a===undefined||a.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0);}},computeBoundingSphere:function(){var a=new THREE.Box3();var b=new THREE.Vector3();return function(){if(this.boundingSphere===null)this.boundingSphere=new THREE.Sphere();var c=this.attributes.position.array;if(c){a.makeEmpty();var d=this.boundingSphere.center;for(var e=0,f=c.length;e<f;e+=3){b.set(c[e],c[e+1],c[e+2]);a.addPoint(b);}a.center(d);var g=0;for(var e=0,f=c.length;e<f;e+=3){b.set(c[e],c[e+1],c[e+2]);g=Math.max(g,d.distanceToSquared(b));}this.boundingSphere.radius=Math.sqrt(g);}};}(),computeVertexNormals:function(){if(this.attributes.position){var a,b;var c,d;var e=this.attributes.position.array.length;if(this.attributes.normal===undefined)this.attributes.normal={itemSize:3,array:new Float32Array(e)};else for(a=0,b=this.attributes.normal.array.length;a<b;a++)this.attributes.normal.array[a]=0;var f=this.attributes.position.array;var g=this.attributes.normal.array;var h,i,j,k,l,m,n=new THREE.Vector3(),o=new THREE.Vector3(),p=new THREE.Vector3(),q=new THREE.Vector3(),r=new THREE.Vector3();if(this.attributes.index){var s=this.attributes.index.array;var t=this.offsets;for(c=0,d=t.length;c<d;++c){var u=t[c].start;var v=t[c].count;var w=t[c].index;for(a=u,b=u+v;a<b;a+=3){h=w+s[a];i=w+s[a+1];j=w+s[a+2];k=f[h*3];l=f[h*3+1];m=f[h*3+2];n.set(k,l,m);k=f[i*3];l=f[i*3+1];m=f[i*3+2];o.set(k,l,m);k=f[j*3];l=f[j*3+1];m=f[j*3+2];p.set(k,l,m);q.subVectors(p,o);r.subVectors(n,o);q.cross(r);g[h*3]+=q.x;g[h*3+1]+=q.y;g[h*3+2]+=q.z;g[i*3]+=q.x;g[i*3+1]+=q.y;g[i*3+2]+=q.z;g[j*3]+=q.x;g[j*3+1]+=q.y;g[j*3+2]+=q.z;}}}else for(a=0,b=f.length;a<b;a+=9){k=f[a];l=f[a+1];m=f[a+2];n.set(k,l,m);k=f[a+3];l=f[a+4];m=f[a+5];o.set(k,l,m);k=f[a+6];l=f[a+7];m=f[a+8];p.set(k,l,m);q.subVectors(p,o);r.subVectors(n,o);q.cross(r);g[a]=q.x;g[a+1]=q.y;g[a+2]=q.z;g[a+3]=q.x;g[a+4]=q.y;g[a+5]=q.z;g[a+6]=q.x;g[a+7]=q.y;g[a+8]=q.z;}this.normalizeNormals();this.normalsNeedUpdate=true;}},normalizeNormals:function(){var a=this.attributes.normal.array;var b,c,d,e;for(var f=0,g=a.length;f<g;f+=3){b=a[f];c=a[f+1];d=a[f+2];e=1.0/Math.sqrt(b*b+c*c+d*d);a[f]*=e;a[f+1]*=e;a[f+2]*=e;}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return;}var a=this.attributes.index.array;var b=this.attributes.position.array;var c=this.attributes.normal.array;var d=this.attributes.uv.array;var e=b.length/3;if(this.attributes.tangent===undefined){var f=4*e;this.attributes.tangent={itemSize:4,array:new Float32Array(f)};}var g=this.attributes.tangent.array;var h=[],i=[];for(var j=0;j<e;j++){h[j]=new THREE.Vector3();i[j]=new THREE.Vector3();}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;var K=new THREE.Vector3(),L=new THREE.Vector3();function M(a,c,e){k=b[a*3];l=b[a*3+1];m=b[a*3+2];n=b[c*3];o=b[c*3+1];p=b[c*3+2];q=b[e*3];r=b[e*3+1];s=b[e*3+2];t=d[a*2];u=d[a*2+1];v=d[c*2];w=d[c*2+1];x=d[e*2];y=d[e*2+1];z=n-k;A=q-k;B=o-l;C=r-l;D=p-m;E=s-m;F=v-t;G=x-t;H=w-u;I=y-u;J=1.0/(F*I-G*H);K.set((I*z-H*A)*J,(I*B-H*C)*J,(I*D-H*E)*J);L.set((F*A-G*z)*J,(F*C-G*B)*J,(F*E-G*D)*J);h[a].add(K);h[c].add(K);h[e].add(K);i[a].add(L);i[c].add(L);i[e].add(L);}var N,O;var P,Q;var R,S,T;var U=this.offsets;for(P=0,Q=U.length;P<Q;++P){var V=U[P].start;var W=U[P].count;var X=U[P].index;for(N=V,O=V+W;N<O;N+=3){R=X+a[N];S=X+a[N+1];T=X+a[N+2];M(R,S,T);}}var Y=new THREE.Vector3(),Z=new THREE.Vector3();var $=new THREE.Vector3(),_=new THREE.Vector3();var ab,ac,ad;function ae(a){$.x=c[a*3];$.y=c[a*3+1];$.z=c[a*3+2];_.copy($);ac=h[a];Y.copy(ac);Y.sub($.multiplyScalar($.dot(ac))).normalize();Z.crossVectors(_,ac);ad=Z.dot(i[a]);ab=(ad<0.0)?-1.0:1.0;g[a*4]=Y.x;g[a*4+1]=Y.y;g[a*4+2]=Y.z;g[a*4+3]=ab;}for(P=0,Q=U.length;P<Q;++P){var V=U[P].start;var W=U[P].count;var X=U[P].index;for(N=V,O=V+W;N<O;N+=3){R=X+a[N];S=X+a[N+1];T=X+a[N+2];ae(R);ae(S);ae(T);}}},computeOffsets:function(a){var b=a;if(a===undefined)b=65535;var c=Date.now();var d=this.attributes.index.array;var e=this.attributes.position.array;var f=(e.length/3);var g=(d.length/3);var h=new Uint16Array(d.length);var i=0;var j=0;var k=[{start:0,count:0,index:0}];var l=k[0];var m=0;var n=0;var o=new Int32Array(6);var p=new Int32Array(e.length);var q=new Int32Array(e.length);for(var r=0;r<e.length;r++){p[r]=-1;q[r]=-1;}for(var s=0;s<g;s++){n=0;for(var t=0;t<3;t++){var u=d[s*3+t];if(p[u]==-1){o[t*2]=u;o[t*2+1]=-1;n++;}else if(p[u]<l.index){o[t*2]=u;o[t*2+1]=-1;m++;}else{o[t*2]=u;o[t*2+1]=p[u];}}var v=j+n;if(v>(l.index+b)){var w={start:i,count:0,index:j};k.push(w);l=w;for(var x=0;x<6;x+=2){var y=o[x+1];if(y>-1&&y<l.index)o[x+1]=-1;}}for(var x=0;x<6;x+=2){var u=o[x];var y=o[x+1];if(y===-1)y=j++;p[u]=y;q[y]=u;h[i++]=y-l.index;l.count++;}}this.reorderBuffers(h,q,j);this.offsets=k;return k;},reorderBuffers:function(a,b,c){var d={};var e=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var f in this.attributes){if(f=='index')continue;var g=this.attributes[f].array;for(var h=0,i=e.length;h<i;h++){var j=e[h];if(g instanceof j){d[f]=new j(this.attributes[f].itemSize*c);break;}}}for(var k=0;k<c;k++){var l=b[k];for(var f in this.attributes){if(f=='index')continue;var m=this.attributes[f].array;var n=this.attributes[f].itemSize;var o=d[f];for(var p=0;p<n;p++)o[k*n+p]=m[l*n+p];}}this.attributes.index.array=a;for(var f in this.attributes){if(f=='index')continue;this.attributes[f].array=d[f];this.attributes[f].numItems=this.attributes[f].itemSize*c;}},clone:function(){var a=new THREE.BufferGeometry();var b=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var c in this.attributes){var d=this.attributes[c];var e=d.array;var f={itemSize:d.itemSize,array:null};for(var g=0,h=b.length;g<h;g++){var i=b[g];if(e instanceof i){f.array=new i(e);break;}}a.attributes[c]=f;}for(var g=0,h=this.offsets.length;g<h;g++){var j=this.offsets[g];a.offsets.push({start:j.start,index:j.index,count:j.count});}return a;},dispose:function(){this.dispatchEvent({type:'dispose'});}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name='';this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.buffersNeedUpdate=false;};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(a){var b=new THREE.Matrix3().getNormalMatrix(a);for(var c=0,d=this.vertices.length;c<d;c++){var e=this.vertices[c];e.applyMatrix4(a);}for(var c=0,d=this.faces.length;c<d;c++){var f=this.faces[c];f.normal.applyMatrix3(b).normalize();for(var g=0,h=f.vertexNormals.length;g<h;g++)f.vertexNormals[g].applyMatrix3(b).normalize();f.centroid.applyMatrix4(a);}if(this.boundingBox instanceof THREE.Box3)this.computeBoundingBox();if(this.boundingSphere instanceof THREE.Sphere)this.computeBoundingSphere();},computeCentroids:function(){var a,b,c;for(a=0,b=this.faces.length;a<b;a++){c=this.faces[a];c.centroid.set(0,0,0);c.centroid.add(this.vertices[c.a]);c.centroid.add(this.vertices[c.b]);c.centroid.add(this.vertices[c.c]);c.centroid.divideScalar(3);}},computeFaceNormals:function(){var a=new THREE.Vector3(),b=new THREE.Vector3();for(var c=0,d=this.faces.length;c<d;c++){var e=this.faces[c];var f=this.vertices[e.a];var g=this.vertices[e.b];var h=this.vertices[e.c];a.subVectors(h,g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a);}},computeVertexNormals:function(a){var b,c,d,e,f,g;g=new Array(this.vertices.length);for(b=0,c=this.vertices.length;b<c;b++)g[b]=new THREE.Vector3();if(a){var h,i,j,k;var l=new THREE.Vector3(),m=new THREE.Vector3(),n=new THREE.Vector3(),o=new THREE.Vector3(),p=new THREE.Vector3();for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];h=this.vertices[f.a];i=this.vertices[f.b];j=this.vertices[f.c];l.subVectors(j,i);m.subVectors(h,i);l.cross(m);g[f.a].add(l);g[f.b].add(l);g[f.c].add(l);}}else for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];g[f.a].add(f.normal);g[f.b].add(f.normal);g[f.c].add(f.normal);}for(b=0,c=this.vertices.length;b<c;b++)g[b].normalize();for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];f.vertexNormals[0]=g[f.a].clone();f.vertexNormals[1]=g[f.b].clone();f.vertexNormals[2]=g[f.c].clone();}},computeMorphNormals:function(){var a,b,c,d,e;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];if(!e.__originalFaceNormal)e.__originalFaceNormal=e.normal.clone();else e.__originalFaceNormal.copy(e.normal);if(!e.__originalVertexNormals)e.__originalVertexNormals=[];for(a=0,b=e.vertexNormals.length;a<b;a++)if(!e.__originalVertexNormals[a])e.__originalVertexNormals[a]=e.vertexNormals[a].clone();else e.__originalVertexNormals[a].copy(e.vertexNormals[a]);}var f=new THREE.Geometry();f.faces=this.faces;for(a=0,b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];var g=this.morphNormals[a].faceNormals;var h=this.morphNormals[a].vertexNormals;var i,j;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];i=new THREE.Vector3();j={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3()};g.push(i);h.push(j);}}var k=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();var i,j;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];i=k.faceNormals[c];j=k.vertexNormals[c];i.copy(e.normal);j.a.copy(e.vertexNormals[0]);j.b.copy(e.vertexNormals[1]);j.c.copy(e.vertexNormals[2]);}}for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];e.normal=e.__originalFaceNormal;e.vertexNormals=e.__originalVertexNormals;}},computeTangents:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=[],D=[],E=new THREE.Vector3(),F=new THREE.Vector3(),G=new THREE.Vector3(),H=new THREE.Vector3(),I=new THREE.Vector3(),J;for(c=0,d=this.vertices.length;c<d;c++){C[c]=new THREE.Vector3();D[c]=new THREE.Vector3();}function K(a,b,c,d,e,f,g){j=a.vertices[b];k=a.vertices[c];l=a.vertices[d];m=i[e];n=i[f];o=i[g];p=k.x-j.x;q=l.x-j.x;r=k.y-j.y;s=l.y-j.y;t=k.z-j.z;u=l.z-j.z;v=n.x-m.x;w=o.x-m.x;x=n.y-m.y;y=o.y-m.y;z=1.0/(v*y-w*x);E.set((y*p-x*q)*z,(y*r-x*s)*z,(y*t-x*u)*z);F.set((v*q-w*p)*z,(v*s-w*r)*z,(v*u-w*t)*z);C[b].add(E);C[c].add(E);C[d].add(E);D[b].add(F);D[c].add(F);D[d].add(F);}for(a=0,b=this.faces.length;a<b;a++){h=this.faces[a];i=this.faceVertexUvs[0][a];K(this,h.a,h.b,h.c,0,1,2);}var L=['a','b','c','d'];for(a=0,b=this.faces.length;a<b;a++){h=this.faces[a];for(e=0;e<Math.min(h.vertexNormals.length,3);e++){I.copy(h.vertexNormals[e]);g=h[L[e]];A=C[g];G.copy(A);G.sub(I.multiplyScalar(I.dot(A))).normalize();H.crossVectors(h.vertexNormals[e],A);B=H.dot(D[g]);J=(B<0.0)?-1.0:1.0;h.vertexTangents[e]=new THREE.Vector4(G.x,G.y,G.z,J);}}this.hasTangents=true;},computeLineDistances:function(){var a=0;var b=this.vertices;for(var c=0,d=b.length;c<d;c++){if(c>0)a+=b[c].distanceTo(b[c-1]);this.lineDistances[c]=a;}},computeBoundingBox:function(){if(this.boundingBox===null)this.boundingBox=new THREE.Box3();this.boundingBox.setFromPoints(this.vertices);},computeBoundingSphere:function(){if(this.boundingSphere===null)this.boundingSphere=new THREE.Sphere();this.boundingSphere.setFromPoints(this.vertices);},mergeVertices:function(){var a={};var b=[],c=[];var d,e;var f=4;var g=Math.pow(10,f);var h,i,j;var k,l,m,n,o;for(h=0,i=this.vertices.length;h<i;h++){d=this.vertices[h];e=Math.round(d.x*g)+'_'+Math.round(d.y*g)+'_'+Math.round(d.z*g);if(a[e]===undefined){a[e]=h;b.push(this.vertices[h]);c[h]=b.length-1;}else c[h]=c[a[e]];};var p=[];for(h=0,i=this.faces.length;h<i;h++){j=this.faces[h];j.a=c[j.a];j.b=c[j.b];j.c=c[j.c];k=[j.a,j.b,j.c];var q=-1;for(var r=0;r<3;r++)if(k[r]==k[(r+1)%3]){q=r;p.push(h);break;}}for(h=p.length-1;h>=0;h--){var s=p[h];this.faces.splice(s,1);for(m=0,n=this.faceVertexUvs.length;m<n;m++)this.faceVertexUvs[m].splice(s,1);}var t=this.vertices.length-b.length;this.vertices=b;return t;},makeGroups:(function(){var a=0;return function(b){var c,d,e,f,g,h={};var i=this.morphTargets.length;var j=this.morphNormals.length;this.geometryGroups={};for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];f=b?e.materialIndex:0;if(!(f in h))h[f]={'hash':f,'counter':0};g=h[f].hash+'_'+h[f].counter;if(!(g in this.geometryGroups))this.geometryGroups[g]={'faces3':[],'materialIndex':f,'vertices':0,'numMorphTargets':i,'numMorphNormals':j};if(this.geometryGroups[g].vertices+3>65535){h[f].counter+=1;g=h[f].hash+'_'+h[f].counter;if(!(g in this.geometryGroups))this.geometryGroups[g]={'faces3':[],'materialIndex':f,'vertices':0,'numMorphTargets':i,'numMorphNormals':j};}this.geometryGroups[g].faces3.push(c);this.geometryGroups[g].vertices+=3;}this.geometryGroupsList=[];for(var k in this.geometryGroups){this.geometryGroups[k].id=a++;this.geometryGroupsList.push(this.geometryGroups[k]);}};})(),clone:function(){var a=new THREE.Geometry();var b=this.vertices;for(var c=0,d=b.length;c<d;c++)a.vertices.push(b[c].clone());var e=this.faces;for(var c=0,d=e.length;c<d;c++)a.faces.push(e[c].clone());var f=this.faceVertexUvs[0];for(var c=0,d=f.length;c<d;c++){var g=f[c],h=[];for(var i=0,j=g.length;i<j;i++)h.push(new THREE.Vector2(g[i].x,g[i].y));a.faceVertexUvs[0].push(h);}return a;},dispose:function(){this.dispatchEvent({type:'dispose'});}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Geometry2=function(a){THREE.BufferGeometry.call(this);this.vertices=this.addAttribute('position',Float32Array,a,3).array;this.normals=this.addAttribute('normal',Float32Array,a,3).array;this.uvs=this.addAttribute('uv',Float32Array,a,2).array;this.boundingBox=null;this.boundingSphere=null;};THREE.Geometry2.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4();this.projectionMatrix=new THREE.Matrix4();};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4();return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a);};}();THREE.Camera.prototype.clone=function(a){if(a===undefined)a=new THREE.Camera();THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a;};THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=(e!==undefined)?e:0.1;this.far=(f!==undefined)?f:2000;this.updateProjectionMatrix();};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far);};THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera();THREE.Camera.prototype.clone.call(this,a);a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;return a;};THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.fov=a!==undefined?a:50;this.aspect=b!==undefined?b:1;this.near=c!==undefined?c:0.1;this.far=d!==undefined?d:2000;this.updateProjectionMatrix();};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(a,b){if(b===undefined)b=24;this.fov=2*THREE.Math.radToDeg(Math.atan(b/(a*2)));this.updateProjectionMatrix();};THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix();};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight;var b=Math.tan(THREE.Math.degToRad(this.fov*0.5))*this.near;var c=-b;var d=a*c;var e=a*b;var f=Math.abs(e-d);var g=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*f/this.fullWidth,d+(this.x+this.width)*f/this.fullWidth,b-(this.y+this.height)*g/this.fullHeight,b-this.y*g/this.fullHeight,this.near,this.far);}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far);};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera();THREE.Camera.prototype.clone.call(this,a);a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;return a;};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a);};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(a){if(a===undefined)a=new THREE.Light();THREE.Object3D.prototype.clone.call(this,a);a.color.copy(this.color);return a;};THREE.AmbientLight=function(a){THREE.Light.call(this,a);};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight();THREE.Light.prototype.clone.call(this,a);return a;};THREE.AreaLight=function(a,b){THREE.Light.call(this,a);this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=(b!==undefined)?b:1;this.width=1.0;this.height=1.0;this.constantAttenuation=1.5;this.linearAttenuation=0.5;this.quadraticAttenuation=0.1;};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D();this.intensity=(b!==undefined)?b:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1000);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1.000,0.990,0.998];this.shadowCascadeFarZ=[0.990,0.998,1.000];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null;};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight();THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a;};THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a);this.position.set(0,100,0);this.groundColor=new THREE.Color(b);this.intensity=(c!==undefined)?c:1;};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.HemisphereLight();THREE.Light.prototype.clone.call(this,a);a.groundColor.copy(this.groundColor);a.intensity=this.intensity;return a;};THREE.PointLight=function(a,b,c){THREE.Light.call(this,a);this.intensity=(b!==undefined)?b:1;this.distance=(c!==undefined)?c:0;};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight();THREE.Light.prototype.clone.call(this,a);a.intensity=this.intensity;a.distance=this.distance;return a;};THREE.SpotLight=function(a,b,c,d,e){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D();this.intensity=(b!==undefined)?b:1;this.distance=(c!==undefined)?c:0;this.angle=(d!==undefined)?d:Math.PI/3;this.exponent=(e!==undefined)?e:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null;};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight();THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.distance=this.distance;a.angle=this.angle;a.exponent=this.exponent;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a;};THREE.Loader=function(a){this.showStatus=a;this.statusDomElement=a?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a;},updateProgress:function(a){var b="Loaded ";if(a.total)b+=(100*a.loaded/a.total).toFixed(0)+"%";else b+=(a.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=b;},extractUrlBase:function(a){var b=a.split('/');if(b.length===1)return './';b.pop();return b.join('/')+'/';},initMaterials:function(a,b){var c=[];for(var d=0;d<a.length;++d)c[d]=THREE.Loader.prototype.createMaterial(a[d],b);return c;},needsTangents:function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d instanceof THREE.ShaderMaterial)return true;}return false;},createMaterial:function(a,b){var c=this;function d(a){var b=Math.log(a)/Math.LN2;return Math.floor(b)==b;}function e(a){var b=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(b));}function f(a,b){var f=new Image();f.onload=function(){if(!d(this.width)||!d(this.height)){var b=e(this.width);var c=e(this.height);a.image.width=b;a.image.height=c;a.image.getContext('2d').drawImage(this,0,0,b,c);}else a.image=this;a.needsUpdate=true;};if(c.crossOrigin!==undefined)f.crossOrigin=c.crossOrigin;f.src=b;}function g(a,c,d,e,g,h,i){var j=/\.dds$/i.test(d);var k=b+d;if(j){var l=THREE.ImageUtils.loadCompressedTexture(k);a[c]=l;}else{var l=document.createElement('canvas');a[c]=new THREE.Texture(l);}a[c].sourceFile=d;if(e){a[c].repeat.set(e[0],e[1]);if(e[0]!==1)a[c].wrapS=THREE.RepeatWrapping;if(e[1]!==1)a[c].wrapT=THREE.RepeatWrapping;}if(g)a[c].offset.set(g[0],g[1]);if(h){var m={"repeat":THREE.RepeatWrapping,"mirror":THREE.MirroredRepeatWrapping};if(m[h[0]]!==undefined)a[c].wrapS=m[h[0]];if(m[h[1]]!==undefined)a[c].wrapT=m[h[1]];}if(i)a[c].anisotropy=i;if(!j)f(a[c],k);}function h(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255;}var i="MeshLambertMaterial";var j={color:0xeeeeee,opacity:1.0,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(a.shading){var k=a.shading.toLowerCase();if(k==="phong")i="MeshPhongMaterial";else if(k==="basic")i="MeshBasicMaterial";}if(a.blending!==undefined&&THREE[a.blending]!==undefined)j.blending=THREE[a.blending];if(a.transparent!==undefined||a.opacity<1.0)j.transparent=a.transparent;if(a.depthTest!==undefined)j.depthTest=a.depthTest;if(a.depthWrite!==undefined)j.depthWrite=a.depthWrite;if(a.visible!==undefined)j.visible=a.visible;if(a.flipSided!==undefined)j.side=THREE.BackSide;if(a.doubleSided!==undefined)j.side=THREE.DoubleSide;if(a.wireframe!==undefined)j.wireframe=a.wireframe;if(a.vertexColors!==undefined)if(a.vertexColors==="face")j.vertexColors=THREE.FaceColors;else if(a.vertexColors)j.vertexColors=THREE.VertexColors;if(a.colorDiffuse)j.color=h(a.colorDiffuse);else if(a.DbgColor)j.color=a.DbgColor;if(a.colorSpecular)j.specular=h(a.colorSpecular);if(a.colorAmbient)j.ambient=h(a.colorAmbient);if(a.transparency)j.opacity=a.transparency;if(a.specularCoef)j.shininess=a.specularCoef;if(a.mapDiffuse&&b)g(j,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy);if(a.mapLight&&b)g(j,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);if(a.mapBump&&b)g(j,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);if(a.mapNormal&&b)g(j,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);if(a.mapSpecular&&b)g(j,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy);if(a.mapBumpScale)j.bumpScale=a.mapBumpScale;if(a.mapNormal){var l=THREE.ShaderLib.normalmap;var m=THREE.UniformsUtils.clone(l.uniforms);m.tNormal.value=j.normalMap;if(a.mapNormalFactor)m.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor);if(j.map){m.tDiffuse.value=j.map;m.enableDiffuse.value=true;}if(j.specularMap){m.tSpecular.value=j.specularMap;m.enableSpecular.value=true;}if(j.lightMap){m.tAO.value=j.lightMap;m.enableAO.value=true;}m.diffuse.value.setHex(j.color);m.specular.value.setHex(j.specular);m.ambient.value.setHex(j.ambient);m.shininess.value=j.shininess;if(j.opacity!==undefined)m.opacity.value=j.opacity;var n={fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:m,lights:true,fog:true};var o=new THREE.ShaderMaterial(n);if(j.transparent)o.transparent=true;}else var o=new THREE[i](j);if(a.DbgName!==undefined)o.name=a.DbgName;return o;}};THREE.XHRLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,b,c,d){var e=this;var f=new XMLHttpRequest();if(b!==undefined)f.addEventListener('load',function(c){b(c.target.responseText);e.manager.itemEnd(a);},false);if(c!==undefined)f.addEventListener('progress',function(a){c(a);},false);if(d!==undefined)f.addEventListener('error',function(a){d(a);},false);if(this.crossOrigin!==undefined)f.crossOrigin=this.crossOrigin;f.open('GET',a,true);f.send(null);e.manager.itemStart(a);},setCrossOrigin:function(a){this.crossOrigin=a;}};THREE.ImageLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,b,c,d){var e=this;var f=document.createElement('img');if(b!==undefined)f.addEventListener('load',function(c){e.manager.itemEnd(a);b(this);},false);if(c!==undefined)f.addEventListener('progress',function(a){c(a);},false);if(d!==undefined)f.addEventListener('error',function(a){d(a);},false);if(this.crossOrigin!==undefined)f.crossOrigin=this.crossOrigin;f.src=a;e.manager.itemStart(a);return f;},setCrossOrigin:function(a){this.crossOrigin=a;}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a);this.withCredentials=false;};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,b,c){var d=this;c=c&&(typeof c==="string")?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,b,c);};THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest();var g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE){if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);if(h.metadata.type==='scene'){console.error('THREE.JSONLoader: "'+b+'" seems to be a Scene. Use THREE.SceneLoader instead.');return;}var i=a.parse(h,d);c(i.geometry,i.materials);}else console.error('THREE.JSONLoader: "'+b+'" seems to be unreachable or the file is empty.');a.onLoadComplete();}else console.error('THREE.JSONLoader: Couldn\'t load "'+b+'" ('+f.status+')');}else if(f.readyState===f.LOADING){if(e){if(g===0)g=f.getResponseHeader('Content-Length');e({total:g,loaded:f.responseText.length});}}else if(f.readyState===f.HEADERS_RECEIVED)if(e!==undefined)g=f.getResponseHeader("Content-Length");};f.open("GET",b,true);f.withCredentials=this.withCredentials;f.send(null);};THREE.JSONLoader.prototype.parse=function(a,b){var c=this,d=new THREE.Geometry(),e=(a.scale!==undefined)?1.0/a.scale:1.0;f(e);g();h(e);d.computeCentroids();d.computeFaceNormals();d.computeBoundingSphere();function f(b){function c(a,b){return a&(1<<b);}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.faces,H=a.vertices,I=a.normals,J=a.colors,K=0;if(a.uvs!==undefined){for(e=0;e<a.uvs.length;e++)if(a.uvs[e].length)K++;for(e=0;e<K;e++)d.faceVertexUvs[e]=[];}h=0;i=H.length;while(h<i){v=new THREE.Vector3();v.x=H[h++]*b;v.y=H[h++]*b;v.z=H[h++]*b;d.vertices.push(v);}h=0;i=G.length;while(h<i){n=G[h++];o=c(n,0);p=c(n,1);q=c(n,3);r=c(n,4);s=c(n,5);t=c(n,6);u=c(n,7);if(o){x=new THREE.Face3();x.a=G[h];x.b=G[h+1];x.c=G[h+3];y=new THREE.Face3();y.a=G[h+1];y.b=G[h+2];y.c=G[h+3];h+=4;if(p){m=G[h++];x.materialIndex=m;y.materialIndex=m;}g=d.faces.length;if(q)for(e=0;e<K;e++){C=a.uvs[e];d.faceVertexUvs[e][g]=[];d.faceVertexUvs[e][g+1]=[];for(f=0;f<4;f++){l=G[h++];E=C[l*2];F=C[l*2+1];D=new THREE.Vector2(E,F);if(f!==2)d.faceVertexUvs[e][g].push(D);if(f!==0)d.faceVertexUvs[e][g+1].push(D);}}if(r){k=G[h++]*3;x.normal.set(I[k++],I[k++],I[k]);y.normal.copy(x.normal);}if(s)for(e=0;e<4;e++){k=G[h++]*3;B=new THREE.Vector3(I[k++],I[k++],I[k]);if(e!==2)x.vertexNormals.push(B);if(e!==0)y.vertexNormals.push(B);}if(t){j=G[h++];A=J[j];x.color.setHex(A);y.color.setHex(A);}if(u)for(e=0;e<4;e++){j=G[h++];A=J[j];if(e!==2)x.vertexColors.push(new THREE.Color(A));if(e!==0)y.vertexColors.push(new THREE.Color(A));}d.faces.push(x);d.faces.push(y);}else{w=new THREE.Face3();w.a=G[h++];w.b=G[h++];w.c=G[h++];if(p){m=G[h++];w.materialIndex=m;}g=d.faces.length;if(q)for(e=0;e<K;e++){C=a.uvs[e];d.faceVertexUvs[e][g]=[];for(f=0;f<3;f++){l=G[h++];E=C[l*2];F=C[l*2+1];D=new THREE.Vector2(E,F);d.faceVertexUvs[e][g].push(D);}}if(r){k=G[h++]*3;w.normal.set(I[k++],I[k++],I[k]);}if(s)for(e=0;e<3;e++){k=G[h++]*3;B=new THREE.Vector3(I[k++],I[k++],I[k]);w.vertexNormals.push(B);}if(t){j=G[h++];w.color.setHex(J[j]);}if(u)for(e=0;e<3;e++){j=G[h++];w.vertexColors.push(new THREE.Color(J[j]));}d.faces.push(w);}}};function g(){if(a.skinWeights)for(var b=0,c=a.skinWeights.length;b<c;b+=2){var e=a.skinWeights[b];var f=a.skinWeights[b+1];var g=0;var h=0;d.skinWeights.push(new THREE.Vector4(e,f,g,h));}if(a.skinIndices)for(var b=0,c=a.skinIndices.length;b<c;b+=2){var i=a.skinIndices[b];var j=a.skinIndices[b+1];var k=0;var l=0;d.skinIndices.push(new THREE.Vector4(i,j,k,l));}d.bones=a.bones;if(d.bones&&d.bones.length>0&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length))console.warn('When skinning, number of vertices ('+d.vertices.length+'), skinIndices ('+d.skinIndices.length+'), and skinWeights ('+d.skinWeights.length+') should match.');d.animation=a.animation;d.animations=a.animations;};function h(b){if(a.morphTargets!==undefined){var c,e,f,g,h,i;for(c=0,e=a.morphTargets.length;c<e;c++){d.morphTargets[c]={};d.morphTargets[c].name=a.morphTargets[c].name;d.morphTargets[c].vertices=[];h=d.morphTargets[c].vertices;i=a.morphTargets[c].vertices;for(f=0,g=i.length;f<g;f+=3){var j=new THREE.Vector3();j.x=i[f]*b;j.y=i[f+1]*b;j.z=i[f+2]*b;h.push(j);}}}if(a.morphColors!==undefined){var c,e,k,l,m,n,o;for(c=0,e=a.morphColors.length;c<e;c++){d.morphColors[c]={};d.morphColors[c].name=a.morphColors[c].name;d.morphColors[c].colors=[];m=d.morphColors[c].colors;n=a.morphColors[c].colors;for(k=0,l=n.length;k<l;k+=3){o=new THREE.Color(0xffaa00);o.setRGB(n[k],n[k+1],n[k+2]);m.push(o);}}}};if(a.materials===undefined)return{geometry:d};else{var i=this.initMaterials(a.materials,b);if(this.needsTangents(i))d.computeTangents();return{geometry:d,materials:i};}};THREE.LoadingManager=function(a,b,c){var d=this;var e=0,f=0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){f++;};this.itemEnd=function(a){e++;if(d.onProgress!==undefined)d.onProgress(a,e,f);if(e===f&&d.onLoad!==undefined)d.onLoad();};};THREE.DefaultLoadingManager=new THREE.LoadingManager();THREE.BufferGeometryLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(a,b,c,d){var e=this;var f=new THREE.XHRLoader();f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)));});},setCrossOrigin:function(a){this.crossOrigin=a;},parse:function(a){var b=new THREE.BufferGeometry();var c=a.attributes;var d=a.offsets;var e=a.boundingSphere;for(var f in c){var g=c[f];b.attributes[f]={itemSize:g.itemSize,array:new self[g.type](g.array)};}if(d!==undefined)b.offsets=JSON.parse(JSON.stringify(d));if(e!==undefined)b.boundingSphere=new THREE.Sphere(new THREE.Vector3().fromArray(e.center!==undefined?e.center:[0,0,0]),e.radius);return b;}};THREE.Geometry2Loader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.Geometry2Loader.prototype={constructor:THREE.Geometry2Loader,load:function(a,b,c,d){var e=this;var f=new THREE.XHRLoader();f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)));});},setCrossOrigin:function(a){this.crossOrigin=a;},parse:function(a){var b=new THREE.Geometry2(a.vertices.length/3);var c=['vertices','normals','uvs'];var d=a.boundingSphere;for(var e in c){var f=c[e];b[f].set(a[f]);}if(d!==undefined)b.boundingSphere=new THREE.Sphere(new THREE.Vector3().fromArray(d.center!==undefined?d.center:[0,0,0]),d.radius);return b;}};THREE.MaterialLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(a,b,c,d){var e=this;var f=new THREE.XHRLoader();f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)));});},setCrossOrigin:function(a){this.crossOrigin=a;},parse:function(a){var b=new THREE[a.type]();if(a.color!==undefined)b.color.setHex(a.color);if(a.ambient!==undefined)b.ambient.setHex(a.ambient);if(a.emissive!==undefined)b.emissive.setHex(a.emissive);if(a.specular!==undefined)b.specular.setHex(a.specular);if(a.shininess!==undefined)b.shininess=a.shininess;if(a.vertexColors!==undefined)b.vertexColors=a.vertexColors;if(a.blending!==undefined)b.blending=a.blending;if(a.side!==undefined)b.side=a.side;if(a.opacity!==undefined)b.opacity=a.opacity;if(a.transparent!==undefined)b.transparent=a.transparent;if(a.wireframe!==undefined)b.wireframe=a.wireframe;if(a.materials!==undefined)for(var c=0,d=a.materials.length;c<d;c++)b.materials.push(this.parse(a.materials[c]));return b;}};THREE.ObjectLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(a,b,c,d){var e=this;var f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)));});},setCrossOrigin:function(a){this.crossOrigin=a;},parse:function(a){var b=this.parseGeometries(a.geometries);var c=this.parseMaterials(a.materials);var d=this.parseObject(a.object,b,c);return d;},parseGeometries:function(a){var b={};if(a!==undefined){var c=new THREE.JSONLoader();var d=new THREE.Geometry2Loader();var e=new THREE.BufferGeometryLoader();for(var f=0,g=a.length;f<g;f++){var h;var i=a[f];switch(i.type){case 'PlaneGeometry':h=new THREE.PlaneGeometry(i.width,i.height,i.widthSegments,i.heightSegments);break;case 'BoxGeometry':case 'CubeGeometry':h=new THREE.BoxGeometry(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);break;case 'CircleGeometry':h=new THREE.CircleGeometry(i.radius,i.segments);break;case 'CylinderGeometry':h=new THREE.CylinderGeometry(i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded);break;case 'SphereGeometry':h=new THREE.SphereGeometry(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);break;case 'IcosahedronGeometry':h=new THREE.IcosahedronGeometry(i.radius,i.detail);break;case 'TorusGeometry':h=new THREE.TorusGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);break;case 'TorusKnotGeometry':h=new THREE.TorusKnotGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.heightScale);break;case 'BufferGeometry':h=e.parse(i.data);break;case 'Geometry2':h=d.parse(i.data);break;case 'Geometry':h=c.parse(i.data).geometry;break;}h.uuid=i.uuid;if(i.name!==undefined)h.name=i.name;b[i.uuid]=h;}}return b;},parseMaterials:function(a){var b={};if(a!==undefined){var c=new THREE.MaterialLoader();for(var d=0,e=a.length;d<e;d++){var f=a[d];var g=c.parse(f);g.uuid=f.uuid;if(f.name!==undefined)g.name=f.name;b[f.uuid]=g;}}return b;},parseObject:function(){var a=new THREE.Matrix4();return function(b,c,d){var e;switch(b.type){case 'Scene':e=new THREE.Scene();break;case 'PerspectiveCamera':e=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case 'OrthographicCamera':e=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case 'AmbientLight':e=new THREE.AmbientLight(b.color);break;case 'DirectionalLight':e=new THREE.DirectionalLight(b.color,b.intensity);break;case 'PointLight':e=new THREE.PointLight(b.color,b.intensity,b.distance);break;case 'SpotLight':e=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent);break;case 'HemisphereLight':e=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case 'Mesh':var f=c[b.geometry];var g=d[b.material];if(f===undefined)console.error('THREE.ObjectLoader: Undefined geometry '+b.geometry);if(g===undefined)console.error('THREE.ObjectLoader: Undefined material '+b.material);e=new THREE.Mesh(f,g);break;case 'Sprite':var g=d[b.material];if(g===undefined)console.error('THREE.ObjectLoader: Undefined material '+b.material);e=new THREE.Sprite(g);break;default:e=new THREE.Object3D();}e.uuid=b.uuid;if(b.name!==undefined)e.name=b.name;if(b.matrix!==undefined){a.fromArray(b.matrix);a.decompose(e.position,e.quaternion,e.scale);}else{if(b.position!==undefined)e.position.fromArray(b.position);if(b.rotation!==undefined)e.rotation.fromArray(b.rotation);if(b.scale!==undefined)e.scale.fromArray(b.scale);}if(b.visible!==undefined)e.visible=b.visible;if(b.userData!==undefined)e.userData=b.userData;if(b.children!==undefined)for(var h in b.children)e.add(this.parseObject(b.children[h],c,d));return e;};}()};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlers={};this.hierarchyHandlers={};this.addGeometryHandler("ascii",THREE.JSONLoader);};THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(a,b,c,d){var e=this;var f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(a,function(c){e.parse(JSON.parse(c),b,a);});},setCrossOrigin:function(a){this.crossOrigin=a;},addGeometryHandler:function(a,b){this.geometryHandlers[a]={"loaderClass":b};},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={"loaderClass":b};},parse:function(a,b,c){var d=this;var e=THREE.Loader.prototype.extractUrlBase(c);var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;var u=[];var v=a;for(var w in this.geometryHandlers){var x=this.geometryHandlers[w].loaderClass;this.geometryHandlers[w].loaderObject=new x();}for(var w in this.hierarchyHandlers){var x=this.hierarchyHandlers[w].loaderClass;this.hierarchyHandlers[w].loaderObject=new x();}p=0;q=0;t={scene:new THREE.Scene(),geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}};if(v.transform){var y=v.transform.position,z=v.transform.rotation,A=v.transform.scale;if(y)t.scene.position.fromArray(y);if(z)t.scene.rotation.fromArray(z);if(A)t.scene.scale.fromArray(A);if(y||z||A){t.scene.updateMatrix();t.scene.updateMatrixWorld();}}function B(a,b){if(b=="relativeToHTML")return a;else return e+a;};function C(){D(t.scene,v.objects);}function D(a,b){var c,e,i,j,k,l;for(var n in b){var o=t.objects[n];var p=b[n];if(o===undefined){if(p.type&&(p.type in d.hierarchyHandlers)){if(p.loading===undefined){var q={"type":1,"url":1,"material":1,"position":1,"rotation":1,"scale":1,"visible":1,"children":1,"userData":1,"skin":1,"morph":1,"mirroredLoop":1,"duration":1};var r={};for(var s in p)if(!(s in q))r[s]=p[s];g=t.materials[p.material];p.loading=true;var u=d.hierarchyHandlers[p.type].loaderObject;if(u.options)u.load(B(p.url,v.urlBaseType),H(n,a,g,p));else u.load(B(p.url,v.urlBaseType),H(n,a,g,p),r);}}else if(p.geometry!==undefined){f=t.geometries[p.geometry];if(f){var w=false;g=t.materials[p.material];w=g instanceof THREE.ShaderMaterial;i=p.position;j=p.rotation;k=p.scale;c=p.matrix;l=p.quaternion;if(!p.material)g=new THREE.MeshFaceMaterial(t.face_materials[p.geometry]);if((g instanceof THREE.MeshFaceMaterial)&&g.materials.length===0)g=new THREE.MeshFaceMaterial(t.face_materials[p.geometry]);if(g instanceof THREE.MeshFaceMaterial)for(var x=0;x<g.materials.length;x++)w=w||(g.materials[x] instanceof THREE.ShaderMaterial);if(w)f.computeTangents();if(p.skin)o=new THREE.SkinnedMesh(f,g);else if(p.morph){o=new THREE.MorphAnimMesh(f,g);if(p.duration!==undefined)o.duration=p.duration;if(p.time!==undefined)o.time=p.time;if(p.mirroredLoop!==undefined)o.mirroredLoop=p.mirroredLoop;if(g.morphNormals)f.computeMorphNormals();}else o=new THREE.Mesh(f,g);o.name=n;if(c){o.matrixAutoUpdate=false;o.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]);}else{o.position.fromArray(i);if(l)o.quaternion.fromArray(l);else o.rotation.fromArray(j);o.scale.fromArray(k);}o.visible=p.visible;o.castShadow=p.castShadow;o.receiveShadow=p.receiveShadow;a.add(o);t.objects[n]=o;}}else if(p.type==="AmbientLight"||p.type==="PointLight"||p.type==="DirectionalLight"||p.type==="SpotLight"||p.type==="HemisphereLight"||p.type==="AreaLight"){var y=p.color;var z=p.intensity;var A=p.distance;var C=p.position;var E=p.rotation;switch(p.type){case 'AmbientLight':m=new THREE.AmbientLight(y);break;case 'PointLight':m=new THREE.PointLight(y,z,A);m.position.fromArray(C);break;case 'DirectionalLight':m=new THREE.DirectionalLight(y,z);m.position.fromArray(p.direction);break;case 'SpotLight':m=new THREE.SpotLight(y,z,A,1);m.angle=p.angle;m.position.fromArray(C);m.target.set(C[0],C[1]-A,C[2]);m.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],'XYZ'));break;case 'HemisphereLight':m=new THREE.DirectionalLight(y,z,A);m.target.set(C[0],C[1]-A,C[2]);m.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],'XYZ'));break;case 'AreaLight':m=new THREE.AreaLight(y,z);m.position.fromArray(C);m.width=p.size;m.height=p.size_y;break;}a.add(m);m.name=n;t.lights[n]=m;t.objects[n]=m;}else if(p.type==="PerspectiveCamera"||p.type==="OrthographicCamera"){i=p.position;j=p.rotation;l=p.quaternion;if(p.type==="PerspectiveCamera")h=new THREE.PerspectiveCamera(p.fov,p.aspect,p.near,p.far);else if(p.type==="OrthographicCamera")h=new THREE.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far);h.name=n;h.position.fromArray(i);if(l!==undefined)h.quaternion.fromArray(l);else if(j!==undefined)h.rotation.fromArray(j);a.add(h);t.cameras[n]=h;t.objects[n]=h;}else{i=p.position;j=p.rotation;k=p.scale;l=p.quaternion;o=new THREE.Object3D();o.name=n;o.position.fromArray(i);if(l)o.quaternion.fromArray(l);else o.rotation.fromArray(j);o.scale.fromArray(k);o.visible=(p.visible!==undefined)?p.visible:false;a.add(o);t.objects[n]=o;t.empties[n]=o;}if(o){if(p.userData!==undefined)for(var F in p.userData){var G=p.userData[F];o.userData[F]=G;}if(p.groups!==undefined)for(var x=0;x<p.groups.length;x++){var I=p.groups[x];if(t.groups[I]===undefined)t.groups[I]=[];t.groups[I].push(n);}}}if(o!==undefined&&p.children!==undefined)D(o,p.children);}};function E(a,b,c){t.geometries[c]=a;t.face_materials[c]=b;C();};function F(a,b,c,d,e){var f=e.position;var g=e.rotation;var h=e.quaternion;var i=e.scale;a.position.fromArray(f);if(h)a.quaternion.fromArray(h);else a.rotation.fromArray(g);a.scale.fromArray(i);if(d)a.traverse(function(a){a.material=d;});var j=(e.visible!==undefined)?e.visible:true;a.traverse(function(a){a.visible=j;});c.add(a);a.name=b;t.objects[b]=a;C();};function G(a){return function(b,c){b.name=a;E(b,c,a);p-=1;d.onLoadComplete();J();};};function H(a,b,c,e){return function(f){var g;if(f.content)g=f.content;else if(f.dae)g=f.scene;else g=f;F(g,a,b,c,e);p-=1;d.onLoadComplete();J();};};function I(a){return function(b,c){b.name=a;t.geometries[a]=b;t.face_materials[a]=c;};};function J(){var a={totalModels:r,totalTextures:s,loadedModels:r-p,loadedTextures:s-q};d.callbackProgress(a,t);d.onLoadProgress();if(p===0&&q===0){K();b(t);}};function K(){for(var a=0;a<u.length;a++){var b=u[a];var c=t.objects[b.targetName];if(c)b.object.target=c;else{b.object.target=new THREE.Object3D();t.scene.add(b.object.target);}b.object.target.userData.targetInverse=b.object;}};var L=function(a){q-=a;J();d.onLoadComplete();};var M=function(a){return function(){L(a);};};function N(a,b){b(a);if(a.children!==undefined)for(var c in a.children)N(a.children[c],b);};var O,P;for(O in v.fogs){P=v.fogs[O];if(P.type==="linear")i=new THREE.Fog(0x000000,P.near,P.far);else if(P.type==="exp2")i=new THREE.FogExp2(0x000000,P.density);l=P.color;i.color.setRGB(l[0],l[1],l[2]);t.fogs[O]=i;}var Q,R;for(Q in v.geometries){R=v.geometries[Q];if(R.type in this.geometryHandlers){p+=1;d.onLoadStart();}}for(var S in v.objects)N(v.objects[S],function(a){if(a.type&&(a.type in d.hierarchyHandlers)){p+=1;d.onLoadStart();}});r=p;for(Q in v.geometries){R=v.geometries[Q];if(R.type==="cube"){f=new THREE.BoxGeometry(R.width,R.height,R.depth,R.widthSegments,R.heightSegments,R.depthSegments);f.name=Q;t.geometries[Q]=f;}else if(R.type==="plane"){f=new THREE.PlaneGeometry(R.width,R.height,R.widthSegments,R.heightSegments);f.name=Q;t.geometries[Q]=f;}else if(R.type==="sphere"){f=new THREE.SphereGeometry(R.radius,R.widthSegments,R.heightSegments);f.name=Q;t.geometries[Q]=f;}else if(R.type==="cylinder"){f=new THREE.CylinderGeometry(R.topRad,R.botRad,R.height,R.radSegs,R.heightSegs);f.name=Q;t.geometries[Q]=f;}else if(R.type==="torus"){f=new THREE.TorusGeometry(R.radius,R.tube,R.segmentsR,R.segmentsT);f.name=Q;t.geometries[Q]=f;}else if(R.type==="icosahedron"){f=new THREE.IcosahedronGeometry(R.radius,R.subdivisions);f.name=Q;t.geometries[Q]=f;}else if(R.type in this.geometryHandlers){var T={};for(var U in R)if(U!=="type"&&U!=="url")T[U]=R[U];var V=this.geometryHandlers[R.type].loaderObject;V.load(B(R.url,v.urlBaseType),G(Q),T);}else if(R.type==="embedded"){var W=v.embeds[R.id],X="";W.metadata=v.metadata;if(W){var Y=this.geometryHandlers.ascii.loaderObject;var Z=Y.parse(W,X);I(Q)(Z.geometry,Z.materials);}}}var $,_;for($ in v.textures){_=v.textures[$];if(_.url instanceof Array){q+=_.url.length;for(var ab=0;ab<_.url.length;ab++)d.onLoadStart();}else{q+=1;d.onLoadStart();}}s=q;for($ in v.textures){_=v.textures[$];if(_.mapping!==undefined&&THREE[_.mapping]!==undefined)_.mapping=new THREE[_.mapping]();if(_.url instanceof Array){var ac=_.url.length;var ad=[];for(var ae=0;ae<ac;ae++)ad[ae]=B(_.url[ae],v.urlBaseType);var af=/\.dds$/i.test(ad[0]);if(af)j=THREE.ImageUtils.loadCompressedTextureCube(ad,_.mapping,M(ac));else j=THREE.ImageUtils.loadTextureCube(ad,_.mapping,M(ac));}else{var af=/\.dds$/i.test(_.url);var ag=B(_.url,v.urlBaseType);var ah=M(1);if(af)j=THREE.ImageUtils.loadCompressedTexture(ag,_.mapping,ah);else j=THREE.ImageUtils.loadTexture(ag,_.mapping,ah);if(THREE[_.minFilter]!==undefined)j.minFilter=THREE[_.minFilter];if(THREE[_.magFilter]!==undefined)j.magFilter=THREE[_.magFilter];if(_.anisotropy)j.anisotropy=_.anisotropy;if(_.repeat){j.repeat.set(_.repeat[0],_.repeat[1]);if(_.repeat[0]!==1)j.wrapS=THREE.RepeatWrapping;if(_.repeat[1]!==1)j.wrapT=THREE.RepeatWrapping;}if(_.offset)j.offset.set(_.offset[0],_.offset[1]);if(_.wrap){var ai={"repeat":THREE.RepeatWrapping,"mirror":THREE.MirroredRepeatWrapping};if(ai[_.wrap[0]]!==undefined)j.wrapS=ai[_.wrap[0]];if(ai[_.wrap[1]]!==undefined)j.wrapT=ai[_.wrap[1]];}}t.textures[$]=j;}var aj,ak;var al;for(aj in v.materials){ak=v.materials[aj];for(al in ak.parameters)if(al==="envMap"||al==="map"||al==="lightMap"||al==="bumpMap")ak.parameters[al]=t.textures[ak.parameters[al]];else if(al==="shading")ak.parameters[al]=(ak.parameters[al]==="flat")?THREE.FlatShading:THREE.SmoothShading;else if(al==="side")if(ak.parameters[al]=="double")ak.parameters[al]=THREE.DoubleSide;else if(ak.parameters[al]=="back")ak.parameters[al]=THREE.BackSide;else ak.parameters[al]=THREE.FrontSide;else if(al==="blending")ak.parameters[al]=ak.parameters[al] in THREE?THREE[ak.parameters[al]]:THREE.NormalBlending;else if(al==="combine")ak.parameters[al]=ak.parameters[al] in THREE?THREE[ak.parameters[al]]:THREE.MultiplyOperation;else if(al==="vertexColors"){if(ak.parameters[al]=="face")ak.parameters[al]=THREE.FaceColors;else if(ak.parameters[al])ak.parameters[al]=THREE.VertexColors;}else if(al==="wrapRGB"){var am=ak.parameters[al];ak.parameters[al]=new THREE.Vector3(am[0],am[1],am[2]);}if(ak.parameters.opacity!==undefined&&ak.parameters.opacity<1.0)ak.parameters.transparent=true;if(ak.parameters.normalMap){var an=THREE.ShaderLib.normalmap;var ao=THREE.UniformsUtils.clone(an.uniforms);var ap=ak.parameters.color;var aq=ak.parameters.specular;var ar=ak.parameters.ambient;var as=ak.parameters.shininess;ao.tNormal.value=t.textures[ak.parameters.normalMap];if(ak.parameters.normalScale)ao.uNormalScale.value.set(ak.parameters.normalScale[0],ak.parameters.normalScale[1]);if(ak.parameters.map){ao.tDiffuse.value=ak.parameters.map;ao.enableDiffuse.value=true;}if(ak.parameters.envMap){ao.tCube.value=ak.parameters.envMap;ao.enableReflection.value=true;ao.reflectivity.value=ak.parameters.reflectivity;}if(ak.parameters.lightMap){ao.tAO.value=ak.parameters.lightMap;ao.enableAO.value=true;}if(ak.parameters.specularMap){ao.tSpecular.value=t.textures[ak.parameters.specularMap];ao.enableSpecular.value=true;}if(ak.parameters.displacementMap){ao.tDisplacement.value=t.textures[ak.parameters.displacementMap];ao.enableDisplacement.value=true;ao.uDisplacementBias.value=ak.parameters.displacementBias;ao.uDisplacementScale.value=ak.parameters.displacementScale;}ao.diffuse.value.setHex(ap);ao.specular.value.setHex(aq);ao.ambient.value.setHex(ar);ao.shininess.value=as;if(ak.parameters.opacity)ao.opacity.value=ak.parameters.opacity;var at={fragmentShader:an.fragmentShader,vertexShader:an.vertexShader,uniforms:ao,lights:true,fog:true};g=new THREE.ShaderMaterial(at);}else g=new THREE[ak.type](ak.parameters);g.name=aj;t.materials[aj]=g;}for(aj in v.materials){ak=v.materials[aj];if(ak.parameters.materials){var au=[];for(var ae=0;ae<ak.parameters.materials.length;ae++){var av=ak.parameters.materials[ae];au.push(t.materials[av]);}t.materials[aj].materials=au;}}C();if(t.cameras&&v.defaults.camera)t.currentCamera=t.cameras[v.defaults.camera];if(t.fogs&&v.defaults.fog)t.scene.fog=t.fogs[v.defaults.fog];d.callbackSync(t);J();}};THREE.TextureLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager;};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a,b,c,d){var e=this;var f=new THREE.ImageLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){var c=new THREE.Texture(a);c.needsUpdate=true;if(b!==undefined)b(c);});},setCrossOrigin:function(a){this.crossOrigin=a;}};THREE.Material=function(){this.id=THREE.MaterialIdCount++;this.uuid=THREE.Math.generateUUID();this.name='';this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true;};THREE.Material.prototype={constructor:THREE.Material,setValues:function(a){if(a===undefined)return;for(var b in a){var c=a[b];if(c===undefined){console.warn('THREE.Material: \''+b+'\' parameter is undefined.');continue;}if(b in this){var d=this[b];if(d instanceof THREE.Color)d.set(c);else if(d instanceof THREE.Vector3&&c instanceof THREE.Vector3)d.copy(c);else if(b=='overdraw')this[b]=Number(c);else this[b]=c;}}},clone:function(a){if(a===undefined)a=new THREE.Material();a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a;},dispose:function(){this.dispatchEvent({type:'dispose'});}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.linewidth=1;this.linecap='round';this.linejoin='round';this.vertexColors=false;this.fog=true;this.setValues(a);};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a;};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(a);};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.scale=this.scale;a.dashSize=this.dashSize;a.gapSize=this.gapSize;a.vertexColors=this.vertexColors;a.fog=this.fog;return a;};THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(a);};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a;};THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.ambient=new THREE.Color(0xffffff);this.emissive=new THREE.Color(0x000000);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a);};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a;};THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.ambient=new THREE.Color(0xffffff);this.emissive=new THREE.Color(0x000000);this.specular=new THREE.Color(0x111111);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a);};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a;};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(a);};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial();THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a;};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(a);};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial();THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a;};THREE.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[];};THREE.MeshFaceMaterial.prototype.clone=function(){var a=new THREE.MeshFaceMaterial();for(var b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a;};THREE.ParticleSystemMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(a);};THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleSystemMaterial.prototype.clone=function(){var a=new THREE.ParticleSystemMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a;};THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial;THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={"color":[1,1,1],"uv":[0,0],"uv2":[0,0]};this.index0AttributeName="position";this.setValues(a);};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial();THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=THREE.UniformsUtils.clone(this.uniforms);a.attributes=this.attributes;a.defines=this.defines;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a;};THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.map=null;this.rotation=0;this.fog=false;this.setValues(a);};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.rotation=this.rotation;a.fog=this.fog;return a;};THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.program=function(a,b){};this.setValues(a);};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a;};THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial;THREE.Texture=function(a,b,c,d,e,f,g,h,i){this.id=THREE.TextureIdCount++;this.uuid=THREE.Math.generateUUID();this.name='';this.image=a;this.mipmaps=[];this.mapping=b!==undefined?b:new THREE.UVMapping();this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=e!==undefined?e:THREE.LinearFilter;this.minFilter=f!==undefined?f:THREE.LinearMipMapLinearFilter;this.anisotropy=i!==undefined?i:1;this.format=g!==undefined?g:THREE.RGBAFormat;this.type=h!==undefined?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null;};THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate;},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value;},clone:function(a){if(a===undefined)a=new THREE.Texture();a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a;},update:function(){this.dispatchEvent({type:'update'});},dispose:function(){this.dispatchEvent({type:'dispose'});}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=false;};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture();THREE.Texture.prototype.clone.call(this,a);return a;};THREE.DataTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k);this.image={data:a,width:b,height:c};};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture();THREE.Texture.prototype.clone.call(this,a);return a;};THREE.ParticleSystem=function(a,b){THREE.Object3D.call(this);this.geometry=a!==undefined?a:new THREE.Geometry();this.material=b!==undefined?b:new THREE.ParticleSystemMaterial({color:Math.random()*0xffffff});this.sortParticles=false;this.frustumCulled=false;};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem.prototype.clone=function(a){if(a===undefined)a=new THREE.ParticleSystem(this.geometry,this.material);a.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,a);return a;};THREE.Line=function(a,b,c){THREE.Object3D.call(this);this.geometry=a!==undefined?a:new THREE.Geometry();this.material=b!==undefined?b:new THREE.LineBasicMaterial({color:Math.random()*0xffffff});this.type=(c!==undefined)?c:THREE.LineStrip;};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.clone=function(a){if(a===undefined)a=new THREE.Line(this.geometry,this.material,this.type);THREE.Object3D.prototype.clone.call(this,a);return a;};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=a!==undefined?a:new THREE.Geometry();this.material=b!==undefined?b:new THREE.MeshBasicMaterial({color:Math.random()*0xffffff});this.updateMorphTargets();};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a;}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==undefined)return this.morphTargetDictionary[a];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0;};THREE.Mesh.prototype.clone=function(a){if(a===undefined)a=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,a);return a;};THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4();};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(a,b){if(this.matrixAutoUpdate)b|=this.updateMatrix();if(b||this.matrixWorldNeedsUpdate){if(a)this.skinMatrix.multiplyMatrices(a,this.matrix);else this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=false;b=true;}var c,d,e=this.children.length;for(d=0;d<e;d++)this.children[d].update(this.skinMatrix,b);};THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.useVertexTexture=c!==undefined?c:true;this.identityMatrix=new THREE.Matrix4();this.bones=[];this.boneMatrices=[];var d,e,f,g,h,i;if(this.geometry&&this.geometry.bones!==undefined){for(d=0;d<this.geometry.bones.length;d++){f=this.geometry.bones[d];g=f.pos;h=f.rotq;i=f.scl;e=this.addBone();e.name=f.name;e.position.set(g[0],g[1],g[2]);e.quaternion.set(h[0],h[1],h[2],h[3]);if(i!==undefined)e.scale.set(i[0],i[1],i[2]);else e.scale.set(1,1,1);}for(d=0;d<this.bones.length;d++){f=this.geometry.bones[d];e=this.bones[d];if(f.parent===-1)this.add(e);else this.bones[f.parent].add(e);}var j=this.bones.length;if(this.useVertexTexture){var k;if(j>256)k=64;else if(j>64)k=32;else if(j>16)k=16;else k=8;this.boneTextureWidth=k;this.boneTextureHeight=k;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false;}else this.boneMatrices=new Float32Array(16*j);this.pose();}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(a){if(a===undefined)a=new THREE.Bone(this);this.bones.push(a);return a;};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var a=new THREE.Matrix4();return function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b){if(this.parent)this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;b=true;}for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e instanceof THREE.Bone)e.update(this.identityMatrix,false);else e.updateMatrixWorld(true);}if(this.boneInverses==undefined){this.boneInverses=[];for(var f=0,g=this.bones.length;f<g;f++){var h=new THREE.Matrix4();h.getInverse(this.bones[f].skinMatrix);this.boneInverses.push(h);}}for(var f=0,g=this.bones.length;f<g;f++){a.multiplyMatrices(this.bones[f].skinMatrix,this.boneInverses[f]);a.flattenToArrayOffset(this.boneMatrices,f*16);}if(this.useVertexTexture)this.boneTexture.needsUpdate=true;};}();THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);this.normalizeSkinWeights();};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a];var c=1.0/b.lengthManhattan();if(c!==Infinity)b.multiplyScalar(c);else b.set(1);}else{}};THREE.SkinnedMesh.prototype.clone=function(a){if(a===undefined)a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture);THREE.Mesh.prototype.clone.call(this,a);return a;};THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b);this.duration=1000;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1);};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a;this.endKeyframe=b;this.length=this.endKeyframe-this.startKeyframe+1;};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false;};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true;};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;if(!a.animations)a.animations={};var b,c=a.animations;var d=/([a-z]+)(\d+)/;for(var e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e];var h=g.name.match(d);if(h&&h.length>1){var i=h[1];var j=h[2];if(!c[i])c[i]={start:Infinity,end:-Infinity};var k=c[i];if(e<k.start)k.start=e;if(e>k.end)k.end=e;if(!b)b=i;}}a.firstAnimation=b;};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[a]={start:b,end:c};};THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];if(c){this.setFrameRange(c.start,c.end);this.duration=1000*((c.end-c.start)/b);this.time=0;}else console.warn("animation["+a+"] undefined");};THREE.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true;}if(this.time<0){this.time=0;this.directionBackwards=false;}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration;}var c=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/b),0,this.length-1);if(c!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[c]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=c;}var d=(this.time%b)/b;if(this.directionBackwards)d=1-d;this.morphTargetInfluences[this.currentKeyframe]=d;this.morphTargetInfluences[this.lastKeyframe]=1-d;};THREE.MorphAnimMesh.prototype.clone=function(a){if(a===undefined)a=new THREE.MorphAnimMesh(this.geometry,this.material);a.duration=this.duration;a.mirroredLoop=this.mirroredLoop;a.time=this.time;a.lastKeyframe=this.lastKeyframe;a.currentKeyframe=this.currentKeyframe;a.direction=this.direction;a.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,a);return a;};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[];};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(a,b){if(b===undefined)b=0;b=Math.abs(b);for(var c=0;c<this.objects.length;c++)if(b<this.objects[c].distance)break;this.objects.splice(c,0,{distance:b,object:a});this.add(a);};THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;b<c;b++)if(a<this.objects[b].distance)break;return this.objects[b-1].object;};THREE.LOD.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(c){if(this.objects.length>1){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);var d=a.distanceTo(b);this.objects[0].object.visible=true;for(var e=1,f=this.objects.length;e<f;e++)if(d>=this.objects[e].distance){this.objects[e-1].object.visible=false;this.objects[e].object.visible=true;}else break;for(;e<f;e++)this.objects[e].object.visible=false;}};}();THREE.LOD.prototype.clone=function(a){if(a===undefined)a=new THREE.LOD();THREE.Object3D.prototype.clone.call(this,a);for(var b=0,c=this.objects.length;b<c;b++){var d=this.objects[b].object.clone();d.visible=b===0;a.addLevel(d,this.objects[b].distance);}return a;};THREE.Sprite=(function(){var a=new THREE.Geometry2(3);a.vertices.set([-0.5,-0.5,0,0.5,-0.5,0,0.5,0.5,0]);return function(b){THREE.Object3D.call(this);this.geometry=a;this.material=(b!==undefined)?b:new THREE.SpriteMaterial();};})();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true;};THREE.Sprite.prototype.clone=function(a){if(a===undefined)a=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,a);return a;};THREE.Particle=THREE.Sprite;THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;this.matrixAutoUpdate=false;this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[];};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light){if(this.__lights.indexOf(a)===-1)this.__lights.push(a);if(a.target&&a.target.parent===undefined)this.add(a.target);}else if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);if(b!==-1)this.__objectsRemoved.splice(b,1);}this.dispatchEvent({type:'objectAdded',object:a});a.dispatchEvent({type:'addedToScene',scene:this});for(var c=0;c<a.children.length;c++)this.__addObject(a.children[c]);};THREE.Scene.prototype.__removeObject=function(a){if(a instanceof THREE.Light){var b=this.__lights.indexOf(a);if(b!==-1)this.__lights.splice(b,1);if(a.shadowCascadeArray)for(var c=0;c<a.shadowCascadeArray.length;c++)this.__removeObject(a.shadowCascadeArray[c]);}else if(!(a instanceof THREE.Camera)){this.__objectsRemoved.push(a);var b=this.__objectsAdded.indexOf(a);if(b!==-1)this.__objectsAdded.splice(b,1);}this.dispatchEvent({type:'objectRemoved',object:a});a.dispatchEvent({type:'removedFromScene',scene:this});for(var d=0;d<a.children.length;d++)this.__removeObject(a.children[d]);};THREE.Scene.prototype.clone=function(a){if(a===undefined)a=new THREE.Scene();THREE.Object3D.prototype.clone.call(this,a);if(this.fog!==null)a.fog=this.fog.clone();if(this.overrideMaterial!==null)a.overrideMaterial=this.overrideMaterial.clone();a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a;};THREE.Fog=function(a,b,c){this.name='';this.color=new THREE.Color(a);this.near=(b!==undefined)?b:1;this.far=(c!==undefined)?c:1000;};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far);};THREE.FogExp2=function(a,b){this.name='';this.color=new THREE.Color(a);this.density=(b!==undefined)?b:0.00025;};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density);};THREE.CanvasRenderer=function(a){console.log('THREE.CanvasRenderer',THREE.REVISION);var b=THREE.Math.smoothstep;a=a||{};var c=this,d,e,f,g=new THREE.Projector(),h=a.canvas!==undefined?a.canvas:document.createElement('canvas'),i=h.width,j=h.height,k=Math.floor(i/2),l=Math.floor(j/2),m=h.getContext('2d',{alpha:a.alpha===true}),n=new THREE.Color(0x000000),o=0,p=1,q=0,r=null,s=null,t=null,u=null,v=null,w=null,x=0,y,z,A,B,C,D=new THREE.RenderableVertex(),E=new THREE.RenderableVertex(),F,G,H,I,J,K,L,M,N,O,P,Q,R=new THREE.Color(),S=new THREE.Color(),T=new THREE.Color(),U=new THREE.Color(),V=new THREE.Color(),W=new THREE.Color(),X=new THREE.Color(),Y=new THREE.Color(),Z={},$,_,ab,ac,ad,ae,af,ag,ah,ai,aj=new THREE.Box2(),ak=new THREE.Box2(),al=new THREE.Box2(),am=new THREE.Color(),an=new THREE.Color(),ao=new THREE.Color(),ap=new THREE.Vector3(),aq=new THREE.Vector3(),ar=new THREE.Matrix3(),as,at,au,av,aw,ax,ay=16;as=document.createElement('canvas');as.width=as.height=2;at=as.getContext('2d');at.fillStyle='rgba(0,0,0,1)';at.fillRect(0,0,2,2);au=at.getImageData(0,0,2,2);av=au.data;aw=document.createElement('canvas');aw.width=aw.height=ay;ax=aw.getContext('2d');ax.translate(-ay/2,-ay/2);ax.scale(ay,ay);ay--;if(m.setLineDash===undefined)if(m.mozDash!==undefined)m.setLineDash=function(a){m.mozDash=a[0]!==null?a:null;};else m.setLineDash=function(){};this.domElement=h;this.devicePixelRatio=a.devicePixelRatio!==undefined?a.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setSize=function(a,b,c){i=a*this.devicePixelRatio;j=b*this.devicePixelRatio;k=Math.floor(i/2);l=Math.floor(j/2);h.width=i;h.height=j;if(this.devicePixelRatio!==1&&c!==false){h.style.width=a+'px';h.style.height=b+'px';}aj.min.set(-k,-l),aj.max.set(k,l);ak.min.set(-k,-l);ak.max.set(k,l);p=1;q=0;r=null;s=null;t=null;u=null;v=null;};this.setClearColor=function(a,b){n.set(a);o=b!==undefined?b:1;ak.min.set(-k,-l);ak.max.set(k,l);};this.setClearColorHex=function(a,b){console.warn('DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.');this.setClearColor(a,b);};this.getMaxAnisotropy=function(){return 0;};this.clear=function(){m.setTransform(1,0,0,-1,k,l);if(ak.empty()===false){ak.intersect(aj);ak.expandByScalar(2);if(o<1)m.clearRect(ak.min.x|0,ak.min.y|0,(ak.max.x-ak.min.x)|0,(ak.max.y-ak.min.y)|0);if(o>0){aO(THREE.NormalBlending);aN(1);aT('rgba('+Math.floor(n.r*255)+','+Math.floor(n.g*255)+','+Math.floor(n.b*255)+','+o+')');m.fillRect(ak.min.x|0,ak.min.y|0,(ak.max.x-ak.min.x)|0,(ak.max.y-ak.min.y)|0);}ak.makeEmpty();}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,b){if(b instanceof THREE.Camera===false){console.error('THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.');return;}if(this.autoClear===true)this.clear();m.setTransform(1,0,0,-1,k,l);c.info.render.vertices=0;c.info.render.faces=0;d=g.projectScene(a,b,this.sortObjects,this.sortElements);e=d.elements;f=d.lights;y=b;ar.getNormalMatrix(b.matrixWorldInverse);az();for(var h=0,i=e.length;h<i;h++){var j=e[h];var n=j.material;if(n===undefined||n.visible===false)continue;al.makeEmpty();if(j instanceof THREE.RenderableSprite){z=j;z.x*=k;z.y*=l;aB(z,j,n);}else if(j instanceof THREE.RenderableLine){z=j.v1;A=j.v2;z.positionScreen.x*=k;z.positionScreen.y*=l;A.positionScreen.x*=k;A.positionScreen.y*=l;al.setFromPoints([z.positionScreen,A.positionScreen]);if(aj.isIntersectionBox(al)===true)aC(z,A,j,n);}else if(j instanceof THREE.RenderableFace){z=j.v1;A=j.v2;B=j.v3;if(z.positionScreen.z<-1||z.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(B.positionScreen.z<-1||B.positionScreen.z>1)continue;z.positionScreen.x*=k;z.positionScreen.y*=l;A.positionScreen.x*=k;A.positionScreen.y*=l;B.positionScreen.x*=k;B.positionScreen.y*=l;if(n.overdraw>0){aM(z.positionScreen,A.positionScreen,n.overdraw);aM(A.positionScreen,B.positionScreen,n.overdraw);aM(B.positionScreen,z.positionScreen,n.overdraw);}al.setFromPoints([z.positionScreen,A.positionScreen,B.positionScreen]);if(aj.isIntersectionBox(al)===true)aD(z,A,B,0,1,2,j,n);}ak.union(al);}m.setTransform(1,0,0,1,0,0);};function az(){am.setRGB(0,0,0);an.setRGB(0,0,0);ao.setRGB(0,0,0);for(var a=0,b=f.length;a<b;a++){var c=f[a];var d=c.color;if(c instanceof THREE.AmbientLight)am.add(d);else if(c instanceof THREE.DirectionalLight)an.add(d);else if(c instanceof THREE.PointLight)ao.add(d);}}function aA(a,b,c){for(var d=0,e=f.length;d<e;d++){var g=f[d];Y.copy(g.color);if(g instanceof THREE.DirectionalLight){var h=ap.setFromMatrixPosition(g.matrixWorld).normalize();var i=b.dot(h);if(i<=0)continue;i*=g.intensity;c.add(Y.multiplyScalar(i));}else if(g instanceof THREE.PointLight){var h=ap.setFromMatrixPosition(g.matrixWorld);var i=b.dot(ap.subVectors(h,a).normalize());if(i<=0)continue;i*=g.distance==0?1:1-Math.min(a.distanceTo(h)/g.distance,1);if(i==0)continue;i*=g.intensity;c.add(Y.multiplyScalar(i));}}}function aB(a,b,c){aN(c.opacity);aO(c.blending);var d=b.scale.x*k;var e=b.scale.y*l;var f=0.5*Math.sqrt(d*d+e*e);al.min.set(a.x-f,a.y-f);al.max.set(a.x+f,a.y+f);if(c instanceof THREE.SpriteMaterial||c instanceof THREE.ParticleSystemMaterial){var g=c.map;if(g!==null){if(g.hasEventListener('update',aH)===false){if(g.image!==undefined&&g.image.width>0)aI(g);g.addEventListener('update',aH);}var h=Z[g.id];if(h!==undefined)aT(h);else aT('rgba( 0, 0, 0, 1 )');var i=g.image;var j=i.width*g.offset.x;var n=i.height*g.offset.y;var o=i.width*g.repeat.x;var p=i.height*g.repeat.y;var q=d/o;var r=e/p;m.save();m.translate(a.x,a.y);if(c.rotation!==0)m.rotate(c.rotation);m.translate(-d/2,-e/2);m.scale(q,r);m.translate(-j,-n);m.fillRect(j,n,o,p);m.restore();}else{aT(c.color.getStyle());m.save();m.translate(a.x,a.y);if(c.rotation!==0)m.rotate(c.rotation);m.scale(d,-e);m.fillRect(-0.5,-0.5,1,1);m.restore();}}else if(c instanceof THREE.SpriteCanvasMaterial){aS(c.color.getStyle());aT(c.color.getStyle());m.save();m.translate(a.x,a.y);if(c.rotation!==0)m.rotate(c.rotation);m.scale(d,e);c.program(m);m.restore();}}function aC(a,b,c,d){aN(d.opacity);aO(d.blending);m.beginPath();m.moveTo(a.positionScreen.x,a.positionScreen.y);m.lineTo(b.positionScreen.x,b.positionScreen.y);if(d instanceof THREE.LineBasicMaterial){aP(d.linewidth);aQ(d.linecap);aR(d.linejoin);if(d.vertexColors!==THREE.VertexColors)aS(d.color.getStyle());else{var e=c.vertexColors[0].getStyle();var f=c.vertexColors[1].getStyle();if(e===f)aS(e);else{try{var g=m.createLinearGradient(a.positionScreen.x,a.positionScreen.y,b.positionScreen.x,b.positionScreen.y);g.addColorStop(0,e);g.addColorStop(1,f);}catch(h){g=e;}aS(g);}}m.stroke();al.expandByScalar(d.linewidth*2);}else if(d instanceof THREE.LineDashedMaterial){aP(d.linewidth);aQ(d.linecap);aR(d.linejoin);aS(d.color.getStyle());aU(d.dashSize,d.gapSize);m.stroke();al.expandByScalar(d.linewidth*2);aU(null,null);}}function aD(a,d,e,f,g,h,i,j){c.info.render.vertices+=3;c.info.render.faces++;aN(j.opacity);aO(j.blending);F=a.positionScreen.x;G=a.positionScreen.y;H=d.positionScreen.x;I=d.positionScreen.y;J=e.positionScreen.x;K=e.positionScreen.y;aE(F,G,H,I,J,K);if((j instanceof THREE.MeshLambertMaterial||j instanceof THREE.MeshPhongMaterial)&&j.map===null){W.copy(j.color);X.copy(j.emissive);if(j.vertexColors===THREE.FaceColors)W.multiply(i.color);if(j.wireframe===false&&j.shading===THREE.SmoothShading&&i.vertexNormalsLength===3){S.copy(am);T.copy(am);U.copy(am);aA(i.v1.positionWorld,i.vertexNormalsModel[0],S);aA(i.v2.positionWorld,i.vertexNormalsModel[1],T);aA(i.v3.positionWorld,i.vertexNormalsModel[2],U);S.multiply(W).add(X);T.multiply(W).add(X);U.multiply(W).add(X);V.addColors(T,U).multiplyScalar(0.5);ab=aL(S,T,U,V);aK(F,G,H,I,J,K,0,0,1,0,0,1,ab);}else{R.copy(am);aA(i.centroidModel,i.normalModel,R);R.multiply(W).add(X);j.wireframe===true?aF(R,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):aG(R);}}else if(j instanceof THREE.MeshBasicMaterial||j instanceof THREE.MeshLambertMaterial||j instanceof THREE.MeshPhongMaterial){if(j.map!==null){if(j.map.mapping instanceof THREE.UVMapping){ac=i.uvs[0];aJ(F,G,H,I,J,K,ac[f].x,ac[f].y,ac[g].x,ac[g].y,ac[h].x,ac[h].y,j.map);}}else if(j.envMap!==null){if(j.envMap.mapping instanceof THREE.SphericalReflectionMapping){aq.copy(i.vertexNormalsModel[f]).applyMatrix3(ar);ad=0.5*aq.x+0.5;ae=0.5*aq.y+0.5;aq.copy(i.vertexNormalsModel[g]).applyMatrix3(ar);af=0.5*aq.x+0.5;ag=0.5*aq.y+0.5;aq.copy(i.vertexNormalsModel[h]).applyMatrix3(ar);ah=0.5*aq.x+0.5;ai=0.5*aq.y+0.5;aJ(F,G,H,I,J,K,ad,ae,af,ag,ah,ai,j.envMap);}}else{R.copy(j.color);if(j.vertexColors===THREE.FaceColors)R.multiply(i.color);j.wireframe===true?aF(R,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):aG(R);}}else if(j instanceof THREE.MeshDepthMaterial){$=y.near;_=y.far;S.r=S.g=S.b=1-b(a.positionScreen.z*a.positionScreen.w,$,_);T.r=T.g=T.b=1-b(d.positionScreen.z*d.positionScreen.w,$,_);U.r=U.g=U.b=1-b(e.positionScreen.z*e.positionScreen.w,$,_);V.addColors(T,U).multiplyScalar(0.5);ab=aL(S,T,U,V);aK(F,G,H,I,J,K,0,0,1,0,0,1,ab);}else if(j instanceof THREE.MeshNormalMaterial)if(j.shading===THREE.FlatShading){aq.copy(i.normalModel).applyMatrix3(ar);R.setRGB(aq.x,aq.y,aq.z).multiplyScalar(0.5).addScalar(0.5);j.wireframe===true?aF(R,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):aG(R);}else if(j.shading===THREE.SmoothShading){aq.copy(i.vertexNormalsModel[f]).applyMatrix3(ar);S.setRGB(aq.x,aq.y,aq.z).multiplyScalar(0.5).addScalar(0.5);aq.copy(i.vertexNormalsModel[g]).applyMatrix3(ar);T.setRGB(aq.x,aq.y,aq.z).multiplyScalar(0.5).addScalar(0.5);aq.copy(i.vertexNormalsModel[h]).applyMatrix3(ar);U.setRGB(aq.x,aq.y,aq.z).multiplyScalar(0.5).addScalar(0.5);V.addColors(T,U).multiplyScalar(0.5);ab=aL(S,T,U,V);aK(F,G,H,I,J,K,0,0,1,0,0,1,ab);}}function aE(a,b,c,d,e,f){m.beginPath();m.moveTo(a,b);m.lineTo(c,d);m.lineTo(e,f);m.closePath();}function aF(a,b,c,d){aP(b);aQ(c);aR(d);aS(a.getStyle());m.stroke();al.expandByScalar(b*2);}function aG(a){aT(a.getStyle());m.fill();}function aH(a){aI(a.target);}function aI(a){var b=a.wrapS===THREE.RepeatWrapping;var c=a.wrapT===THREE.RepeatWrapping;var d=a.image;var e=document.createElement('canvas');e.width=d.width;e.height=d.height;var f=e.getContext('2d');f.setTransform(1,0,0,-1,0,d.height);f.drawImage(d,0,0);Z[a.id]=m.createPattern(e,b===true&&c===true?'repeat':b===true&&c===false?'repeat-x':b===false&&c===true?'repeat-y':'no-repeat');}function aJ(a,b,c,d,e,f,g,h,i,j,k,l,n){if(n instanceof THREE.DataTexture)return;if(n.hasEventListener('update',aH)===false){if(n.image!==undefined&&n.image.width>0)aI(n);n.addEventListener('update',aH);}var o=Z[n.id];if(o!==undefined)aT(o);else{aT('rgba(0,0,0,1)');m.fill();return;}var p,q,r,s,t,u,v,w,x=n.offset.x/n.repeat.x,y=n.offset.y/n.repeat.y,z=n.image.width*n.repeat.x,A=n.image.height*n.repeat.y;g=(g+x)*z;h=(h+y)*A;i=(i+x)*z;j=(j+y)*A;k=(k+x)*z;l=(l+y)*A;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;v=i*l-k*j;if(v===0)return;w=1/v;p=(l*c-j*e)*w;q=(l*d-j*f)*w;r=(i*e-k*c)*w;s=(i*f-k*d)*w;t=a-p*g-r*h;u=b-q*g-s*h;m.save();m.transform(p,q,r,s,t,u);m.fill();m.restore();}function aK(a,b,c,d,e,f,g,h,i,j,k,l,n){var o,p,q,r,s,t,u,v,w=n.width-1,x=n.height-1;g*=w;h*=x;i*=w;j*=x;k*=w;l*=x;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;u=i*l-k*j;v=1/u;o=(l*c-j*e)*v;p=(l*d-j*f)*v;q=(i*e-k*c)*v;r=(i*f-k*d)*v;s=a-o*g-q*h;t=b-p*g-r*h;m.save();m.transform(o,p,q,r,s,t);m.clip();m.drawImage(n,0,0);m.restore();}function aL(a,b,c,d){av[0]=(a.r*255)|0;av[1]=(a.g*255)|0;av[2]=(a.b*255)|0;av[4]=(b.r*255)|0;av[5]=(b.g*255)|0;av[6]=(b.b*255)|0;av[8]=(c.r*255)|0;av[9]=(c.g*255)|0;av[10]=(c.b*255)|0;av[12]=(d.r*255)|0;av[13]=(d.g*255)|0;av[14]=(d.b*255)|0;at.putImageData(au,0,0);ax.drawImage(as,0,0);return aw;}function aM(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e,g;if(f===0)return;g=c/Math.sqrt(f);d*=g;e*=g;b.x+=d;b.y+=e;a.x-=d;a.y-=e;}function aN(a){if(p!==a){m.globalAlpha=a;p=a;}}function aO(a){if(q!==a){if(a===THREE.NormalBlending)m.globalCompositeOperation='source-over';else if(a===THREE.AdditiveBlending)m.globalCompositeOperation='lighter';else if(a===THREE.SubtractiveBlending)m.globalCompositeOperation='darker';q=a;}}function aP(a){if(t!==a){m.lineWidth=a;t=a;}}function aQ(a){if(u!==a){m.lineCap=a;u=a;}}function aR(a){if(v!==a){m.lineJoin=a;v=a;}}function aS(a){if(r!==a){m.strokeStyle=a;r=a;}}function aT(a){if(s!==a){m.fillStyle=a;s=a;}}function aU(a,b){if(w!==a||x!==b){m.setLineDash([a,b]);w=a;x=b;}}};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")};THREE.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)e[c]=d[c];}return e;},clone:function(a){var b,c,d,e,f={};for(b in a){f[b]={};for(c in a[b]){e=a[b][c];if(e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix4||e instanceof THREE.Texture)f[b][c]=e.clone();else if(e instanceof Array)f[b][c]=e.slice();else f[b][c]=e;}}return f;}};THREE.UniformsLib={common:{"diffuse":{type:"c",value:new THREE.Color(0xeeeeee)},"opacity":{type:"f",value:1.0},"map":{type:"t",value:null},"offsetRepeat":{type:"v4",value:new THREE.Vector4(0,0,1,1)},"lightMap":{type:"t",value:null},"specularMap":{type:"t",value:null},"envMap":{type:"t",value:null},"flipEnvMap":{type:"f",value:-1},"useRefract":{type:"i",value:0},"reflectivity":{type:"f",value:1.0},"refractionRatio":{type:"f",value:0.98},"combine":{type:"i",value:0},"morphTargetInfluences":{type:"f",value:0}},bump:{"bumpMap":{type:"t",value:null},"bumpScale":{type:"f",value:1}},normalmap:{"normalMap":{type:"t",value:null},"normalScale":{type:"v2",value:new THREE.Vector2(1,1)}},fog:{"fogDensity":{type:"f",value:0.00025},"fogNear":{type:"f",value:1},"fogFar":{type:"f",value:2000},"fogColor":{type:"c",value:new THREE.Color(0xffffff)}},lights:{"ambientLightColor":{type:"fv",value:[]},"directionalLightDirection":{type:"fv",value:[]},"directionalLightColor":{type:"fv",value:[]},"hemisphereLightDirection":{type:"fv",value:[]},"hemisphereLightSkyColor":{type:"fv",value:[]},"hemisphereLightGroundColor":{type:"fv",value:[]},"pointLightColor":{type:"fv",value:[]},"pointLightPosition":{type:"fv",value:[]},"pointLightDistance":{type:"fv1",value:[]},"spotLightColor":{type:"fv",value:[]},"spotLightPosition":{type:"fv",value:[]},"spotLightDirection":{type:"fv",value:[]},"spotLightDistance":{type:"fv1",value:[]},"spotLightAngleCos":{type:"fv1",value:[]},"spotLightExponent":{type:"fv1",value:[]}},particle:{"psColor":{type:"c",value:new THREE.Color(0xeeeeee)},"opacity":{type:"f",value:1.0},"size":{type:"f",value:1.0},"scale":{type:"f",value:1.0},"map":{type:"t",value:null},"fogDensity":{type:"f",value:0.00025},"fogNear":{type:"f",value:1},"fogFar":{type:"f",value:2000},"fogColor":{type:"c",value:new THREE.Color(0xffffff)}},shadowmap:{"shadowMap":{type:"tv",value:[]},"shadowMapSize":{type:"v2v",value:[]},"shadowBias":{type:"fv1",value:[]},"shadowDarkness":{type:"fv1",value:[]},"shadowMatrix":{type:"m4v",value:[]}}};THREE.ShaderLib={'basic':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},'lambert':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{"ambient":{type:"c",value:new THREE.Color(0xffffff)},"emissive":{type:"c",value:new THREE.Color(0x000000)},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},'phong':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{"ambient":{type:"c",value:new THREE.Color(0xffffff)},"emissive":{type:"c",value:new THREE.Color(0x000000)},"specular":{type:"c",value:new THREE.Color(0x111111)},"shininess":{type:"f",value:30},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},'particle_basic':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},'dashed':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{"scale":{type:"f",value:1},"dashSize":{type:"f",value:1},"totalSize":{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},'depth':{uniforms:{"mNear":{type:"f",value:1.0},"mFar":{type:"f",value:2000.0},"opacity":{type:"f",value:1.0}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},'normal':{uniforms:{"opacity":{type:"f",value:1.0}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},'normalmap':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{"enableAO":{type:"i",value:0},"enableDiffuse":{type:"i",value:0},"enableSpecular":{type:"i",value:0},"enableReflection":{type:"i",value:0},"enableDisplacement":{type:"i",value:0},"tDisplacement":{type:"t",value:null},"tDiffuse":{type:"t",value:null},"tCube":{type:"t",value:null},"tNormal":{type:"t",value:null},"tSpecular":{type:"t",value:null},"tAO":{type:"t",value:null},"uNormalScale":{type:"v2",value:new THREE.Vector2(1,1)},"uDisplacementBias":{type:"f",value:0.0},"uDisplacementScale":{type:"f",value:1.0},"diffuse":{type:"c",value:new THREE.Color(0xffffff)},"specular":{type:"c",value:new THREE.Color(0x111111)},"ambient":{type:"c",value:new THREE.Color(0xffffff)},"shininess":{type:"f",value:30},"opacity":{type:"f",value:1},"useRefract":{type:"i",value:0},"refractionRatio":{type:"f",value:0.98},"reflectivity":{type:"f",value:0.5},"uOffset":{type:"v2",value:new THREE.Vector2(0,0)},"uRepeat":{type:"v2",value:new THREE.Vector2(1,1)},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},'cube':{uniforms:{"tCube":{type:"t",value:null},"tFlip":{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},'depthRGBA':{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(a){console.log('THREE.WebGLRenderer',THREE.REVISION);a=a||{};var b=a.canvas!==undefined?a.canvas:document.createElement('canvas'),c=a.context!==undefined?a.context:null,d=a.precision!==undefined?a.precision:'highp',e={},f=a.alpha!==undefined?a.alpha:false,g=a.premultipliedAlpha!==undefined?a.premultipliedAlpha:true,h=a.antialias!==undefined?a.antialias:false,i=a.stencil!==undefined?a.stencil:true,j=a.preserveDrawingBuffer!==undefined?a.preserveDrawingBuffer:false,k=new THREE.Color(0x000000),l=0;this.domElement=b;this.context=null;this.devicePixelRatio=a.devicePixelRatio!==undefined?a.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var m=this,n=[],o=0,p=null,q=null,r=-1,s=null,t=null,u=0,v=-1,w=-1,x=-1,y=-1,z=-1,A=-1,B=-1,C=-1,D=null,E=null,F=null,G=null,H=0,I=0,J=b.width,K=b.height,L=0,M=0,N=new Uint8Array(16),O=new THREE.Frustum(),P=new THREE.Matrix4(),Q=new THREE.Matrix4(),R=new THREE.Vector3(),S=new THREE.Vector3(),T=true,U={ambient:[0,0,0],directional:{length:0,colors:new Array(),positions:new Array()},point:{length:0,colors:new Array(),positions:new Array(),distances:new Array()},spot:{length:0,colors:new Array(),positions:new Array(),distances:new Array(),directions:new Array(),anglesCos:new Array(),exponents:new Array()},hemi:{length:0,skyColors:new Array(),groundColors:new Array(),positions:new Array()}};var V;var W;var X;var Y;var Z;var $;cd();ce();this.context=V;var _=V.getParameter(V.MAX_TEXTURE_IMAGE_UNITS);var ab=V.getParameter(V.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var ac=V.getParameter(V.MAX_TEXTURE_SIZE);var ad=V.getParameter(V.MAX_CUBE_MAP_TEXTURE_SIZE);var ae=Z?V.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var af=(ab>0);var ag=af&&W;var ah=$?V.getParameter(V.COMPRESSED_TEXTURE_FORMATS):[];var ai=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.HIGH_FLOAT);var aj=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.MEDIUM_FLOAT);var ak=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.LOW_FLOAT);var al=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.HIGH_FLOAT);var am=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.MEDIUM_FLOAT);var an=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.LOW_FLOAT);var ao=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.HIGH_INT);var ap=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.MEDIUM_INT);var aq=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.LOW_INT);var ar=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.HIGH_INT);var as=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.MEDIUM_INT);var at=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.LOW_INT);var au=ai.precision>0&&al.precision>0;var av=aj.precision>0&&am.precision>0;if(d==="highp"&&!au)if(av){d="mediump";console.warn("WebGLRenderer: highp not supported, using mediump");}else{d="lowp";console.warn("WebGLRenderer: highp and mediump not supported, using lowp");}if(d==="mediump"&&!av){d="lowp";console.warn("WebGLRenderer: mediump not supported, using lowp");}this.getContext=function(){return V;};this.supportsVertexTextures=function(){return af;};this.supportsFloatTextures=function(){return W;};this.supportsStandardDerivatives=function(){return Y;};this.supportsCompressedTextureS3TC=function(){return $;};this.getMaxAnisotropy=function(){return ae;};this.getPrecision=function(){return d;};this.setSize=function(a,c,d){b.width=a*this.devicePixelRatio;b.height=c*this.devicePixelRatio;if(this.devicePixelRatio!==1&&d!==false){b.style.width=a+'px';b.style.height=c+'px';}this.setViewport(0,0,a,c);};this.setViewport=function(a,b,c,d){H=a*this.devicePixelRatio;I=b*this.devicePixelRatio;J=c*this.devicePixelRatio;K=d*this.devicePixelRatio;V.viewport(H,I,J,K);};this.setScissor=function(a,b,c,d){V.scissor(a*this.devicePixelRatio,b*this.devicePixelRatio,c*this.devicePixelRatio,d*this.devicePixelRatio);};this.enableScissorTest=function(a){a?V.enable(V.SCISSOR_TEST):V.disable(V.SCISSOR_TEST);};this.setClearColor=function(a,b){k.set(a);l=b!==undefined?b:1;V.clearColor(k.r,k.g,k.b,l);};this.setClearColorHex=function(a,b){console.warn('DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.');this.setClearColor(a,b);};this.getClearColor=function(){return k;};this.getClearAlpha=function(){return l;};this.clear=function(a,b,c){var d=0;if(a===undefined||a)d|=V.COLOR_BUFFER_BIT;if(b===undefined||b)d|=V.DEPTH_BUFFER_BIT;if(c===undefined||c)d|=V.STENCIL_BUFFER_BIT;V.clear(d);};this.clearColor=function(){V.clear(V.COLOR_BUFFER_BIT);};this.clearDepth=function(){V.clear(V.DEPTH_BUFFER_BIT);};this.clearStencil=function(){V.clear(V.STENCIL_BUFFER_BIT);};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d);};this.addPostPlugin=function(a){a.init(this);this.renderPluginsPost.push(a);};this.addPrePlugin=function(a){a.init(this);this.renderPluginsPre.push(a);};this.updateShadowMap=function(a,b){p=null;x=-1;B=-1;C=-1;s=-1;r=-1;T=true;v=-1;w=-1;this.shadowMapPlugin.update(a,b);};function aw(a){a.__webglVertexBuffer=V.createBuffer();a.__webglColorBuffer=V.createBuffer();m.info.memory.geometries++;};function ax(a){a.__webglVertexBuffer=V.createBuffer();a.__webglColorBuffer=V.createBuffer();a.__webglLineDistanceBuffer=V.createBuffer();m.info.memory.geometries++;};function ay(a){a.__webglVertexBuffer=V.createBuffer();a.__webglNormalBuffer=V.createBuffer();a.__webglTangentBuffer=V.createBuffer();a.__webglColorBuffer=V.createBuffer();a.__webglUVBuffer=V.createBuffer();a.__webglUV2Buffer=V.createBuffer();a.__webglSkinIndicesBuffer=V.createBuffer();a.__webglSkinWeightsBuffer=V.createBuffer();a.__webglFaceBuffer=V.createBuffer();a.__webglLineBuffer=V.createBuffer();var b,c;if(a.numMorphTargets){a.__webglMorphTargetsBuffers=[];for(b=0,c=a.numMorphTargets;b<c;b++)a.__webglMorphTargetsBuffers.push(V.createBuffer());}if(a.numMorphNormals){a.__webglMorphNormalsBuffers=[];for(b=0,c=a.numMorphNormals;b<c;b++)a.__webglMorphNormalsBuffers.push(V.createBuffer());}m.info.memory.geometries++;};var az=function(a){var b=a.target;b.removeEventListener('dispose',az);aE(b);};var aA=function(a){var b=a.target;b.removeEventListener('dispose',aA);aF(b);m.info.memory.textures--;};var aB=function(a){var b=a.target;b.removeEventListener('dispose',aB);aG(b);m.info.memory.textures--;};var aC=function(a){var b=a.target;b.removeEventListener('dispose',aC);aH(b);};var aD=function(a){if(a.__webglVertexBuffer!==undefined)V.deleteBuffer(a.__webglVertexBuffer);if(a.__webglNormalBuffer!==undefined)V.deleteBuffer(a.__webglNormalBuffer);if(a.__webglTangentBuffer!==undefined)V.deleteBuffer(a.__webglTangentBuffer);if(a.__webglColorBuffer!==undefined)V.deleteBuffer(a.__webglColorBuffer);if(a.__webglUVBuffer!==undefined)V.deleteBuffer(a.__webglUVBuffer);if(a.__webglUV2Buffer!==undefined)V.deleteBuffer(a.__webglUV2Buffer);if(a.__webglSkinIndicesBuffer!==undefined)V.deleteBuffer(a.__webglSkinIndicesBuffer);if(a.__webglSkinWeightsBuffer!==undefined)V.deleteBuffer(a.__webglSkinWeightsBuffer);if(a.__webglFaceBuffer!==undefined)V.deleteBuffer(a.__webglFaceBuffer);if(a.__webglLineBuffer!==undefined)V.deleteBuffer(a.__webglLineBuffer);if(a.__webglLineDistanceBuffer!==undefined)V.deleteBuffer(a.__webglLineDistanceBuffer);if(a.__webglCustomAttributesList!==undefined)for(var b in a.__webglCustomAttributesList)V.deleteBuffer(a.__webglCustomAttributesList[b].buffer);m.info.memory.geometries--;};var aE=function(a){a.__webglInit=undefined;if(a instanceof THREE.BufferGeometry){var b=a.attributes;for(var c in b)if(b[c].buffer!==undefined)V.deleteBuffer(b[c].buffer);m.info.memory.geometries--;}else if(a.geometryGroups!==undefined){for(var d in a.geometryGroups){var e=a.geometryGroups[d];if(e.numMorphTargets!==undefined)for(var f=0,g=e.numMorphTargets;f<g;f++)V.deleteBuffer(e.__webglMorphTargetsBuffers[f]);if(e.numMorphNormals!==undefined)for(var f=0,g=e.numMorphNormals;f<g;f++)V.deleteBuffer(e.__webglMorphNormalsBuffers[f]);aD(e);}}else aD(a);};var aF=function(a){if(a.image&&a.image.__webglTextureCube)V.deleteTexture(a.image.__webglTextureCube);else{if(!a.__webglInit)return;a.__webglInit=false;V.deleteTexture(a.__webglTexture);}};var aG=function(a){if(!a||!a.__webglTexture)return;V.deleteTexture(a.__webglTexture);if(a instanceof THREE.WebGLRenderTargetCube)for(var b=0;b<6;b++){V.deleteFramebuffer(a.__webglFramebuffer[b]);V.deleteRenderbuffer(a.__webglRenderbuffer[b]);}else{V.deleteFramebuffer(a.__webglFramebuffer);V.deleteRenderbuffer(a.__webglRenderbuffer);}};var aH=function(a){var b=a.program;if(b===undefined)return;a.program=undefined;var c,d,e;var f=false;for(c=0,d=n.length;c<d;c++){e=n[c];if(e.program===b){e.usedTimes--;if(e.usedTimes===0)f=true;break;}}if(f===true){var g=[];for(c=0,d=n.length;c<d;c++){e=n[c];if(e.program!==b)g.push(e);}n=g;V.deleteProgram(b);m.info.memory.programs--;}};function aI(a,b){var c=a.vertices.length;var d=b.material;if(d.attributes){if(a.__webglCustomAttributesList===undefined)a.__webglCustomAttributesList=[];for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=true;var g=1;if(f.type==="v2")g=2;else if(f.type==="v3")g=3;else if(f.type==="v4")g=4;else if(f.type==="c")g=3;f.size=g;f.array=new Float32Array(c*g);f.buffer=V.createBuffer();f.buffer.belongsToAttribute=e;f.needsUpdate=true;}a.__webglCustomAttributesList.push(f);}}};function aJ(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3);a.__colorArray=new Float32Array(c*3);a.__sortArray=[];a.__webglParticleCount=c;aI(a,b);};function aK(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3);a.__colorArray=new Float32Array(c*3);a.__lineDistanceArray=new Float32Array(c*1);a.__webglLineCount=c;aI(a,b);};function aL(a,b){var c=b.geometry,d=a.faces3,e=d.length*3,f=d.length*1,g=d.length*3,h=aM(b,a),i=aQ(h),j=aO(h),k=aP(h);a.__vertexArray=new Float32Array(e*3);if(j)a.__normalArray=new Float32Array(e*3);if(c.hasTangents)a.__tangentArray=new Float32Array(e*4);if(k)a.__colorArray=new Float32Array(e*3);if(i){if(c.faceVertexUvs.length>0)a.__uvArray=new Float32Array(e*2);if(c.faceVertexUvs.length>1)a.__uv2Array=new Float32Array(e*2);}if(b.geometry.skinWeights.length&&b.geometry.skinIndices.length){a.__skinIndexArray=new Float32Array(e*4);a.__skinWeightArray=new Float32Array(e*4);}a.__faceArray=new Uint16Array(f*3);a.__lineArray=new Uint16Array(g*2);var l,m;if(a.numMorphTargets){a.__morphTargetsArrays=[];for(l=0,m=a.numMorphTargets;l<m;l++)a.__morphTargetsArrays.push(new Float32Array(e*3));}if(a.numMorphNormals){a.__morphNormalsArrays=[];for(l=0,m=a.numMorphNormals;l<m;l++)a.__morphNormalsArrays.push(new Float32Array(e*3));}a.__webglFaceCount=f*3;a.__webglLineCount=g*2;if(h.attributes){if(a.__webglCustomAttributesList===undefined)a.__webglCustomAttributesList=[];for(var n in h.attributes){var o=h.attributes[n];var p={};for(var q in o)p[q]=o[q];if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=true;var r=1;if(p.type==="v2")r=2;else if(p.type==="v3")r=3;else if(p.type==="v4")r=4;else if(p.type==="c")r=3;p.size=r;p.array=new Float32Array(e*r);p.buffer=V.createBuffer();p.buffer.belongsToAttribute=n;o.needsUpdate=true;p.__original=o;}a.__webglCustomAttributesList.push(p);}}a.__inittedArrays=true;};function aM(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material;};function aN(a){return a&&a.shading!==undefined&&a.shading===THREE.SmoothShading;};function aO(a){if((a instanceof THREE.MeshBasicMaterial&&!a.envMap)||a instanceof THREE.MeshDepthMaterial)return false;if(aN(a))return THREE.SmoothShading;else return THREE.FlatShading;};function aP(a){if(a.vertexColors)return a.vertexColors;return false;};function aQ(a){if(a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a instanceof THREE.ShaderMaterial)return true;return false;};function aR(a){var b,c,d;for(b in a.attributes){if(b==="index")d=V.ELEMENT_ARRAY_BUFFER;else d=V.ARRAY_BUFFER;c=a.attributes[b];c.buffer=V.createBuffer();V.bindBuffer(d,c.buffer);V.bufferData(d,c.array,V.STATIC_DRAW);}};function aS(a,b,c){var d,e,f,g,h,i,j=a.vertices,k=j.length,l=a.colors,m=l.length,n=a.__vertexArray,o=a.__colorArray,p=a.__sortArray,q=a.verticesNeedUpdate,r=a.elementsNeedUpdate,s=a.colorsNeedUpdate,t=a.__webglCustomAttributesList,u,v,w,x,y,z,A;if(c.sortParticles){Q.copy(P);Q.multiply(c.matrixWorld);for(d=0;d<k;d++){f=j[d];R.copy(f);R.applyProjection(Q);p[d]=[R.z,d];}p.sort(a_);for(d=0;d<k;d++){f=j[p[d][1]];g=d*3;n[g]=f.x;n[g+1]=f.y;n[g+2]=f.z;}for(e=0;e<m;e++){g=e*3;i=l[p[e][1]];o[g]=i.r;o[g+1]=i.g;o[g+2]=i.b;}if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(!(A.boundTo===undefined||A.boundTo==="vertices"))continue;g=0;y=A.value.length;if(A.size===1)for(x=0;x<y;x++){h=p[x][1];A.array[x]=A.value[h];}else if(A.size===2)for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;g+=2;}else if(A.size===3)if(A.type==="c")for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.r;A.array[g+1]=z.g;A.array[g+2]=z.b;g+=3;}else for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;g+=3;}else if(A.size===4)for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;A.array[g+3]=z.w;g+=4;}}}else{if(q)for(d=0;d<k;d++){f=j[d];g=d*3;n[g]=f.x;n[g+1]=f.y;n[g+2]=f.z;}if(s)for(e=0;e<m;e++){i=l[e];g=e*3;o[g]=i.r;o[g+1]=i.g;o[g+2]=i.b;}if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate&&(A.boundTo===undefined||A.boundTo==="vertices")){y=A.value.length;g=0;if(A.size===1)for(x=0;x<y;x++)A.array[x]=A.value[x];else if(A.size===2)for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;g+=2;}else if(A.size===3)if(A.type==="c")for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.r;A.array[g+1]=z.g;A.array[g+2]=z.b;g+=3;}else for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;g+=3;}else if(A.size===4)for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;A.array[g+3]=z.w;g+=4;}}}}if(q||c.sortParticles){V.bindBuffer(V.ARRAY_BUFFER,a.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,n,b);}if(s||c.sortParticles){V.bindBuffer(V.ARRAY_BUFFER,a.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,o,b);}if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate||c.sortParticles){V.bindBuffer(V.ARRAY_BUFFER,A.buffer);V.bufferData(V.ARRAY_BUFFER,A.array,b);}}};function aT(a,b){var c,d,e,f,g,h,i=a.vertices,j=a.colors,k=a.lineDistances,l=i.length,m=j.length,n=k.length,o=a.__vertexArray,p=a.__colorArray,q=a.__lineDistanceArray,r=a.verticesNeedUpdate,s=a.colorsNeedUpdate,t=a.lineDistancesNeedUpdate,u=a.__webglCustomAttributesList,v,w,x,y,z,A,B;if(r){for(c=0;c<l;c++){f=i[c];g=c*3;o[g]=f.x;o[g+1]=f.y;o[g+2]=f.z;}V.bindBuffer(V.ARRAY_BUFFER,a.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,o,b);}if(s){for(d=0;d<m;d++){h=j[d];g=d*3;p[g]=h.r;p[g+1]=h.g;p[g+2]=h.b;}V.bindBuffer(V.ARRAY_BUFFER,a.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,p,b);}if(t){for(e=0;e<n;e++)q[e]=k[e];V.bindBuffer(V.ARRAY_BUFFER,a.__webglLineDistanceBuffer);V.bufferData(V.ARRAY_BUFFER,q,b);}if(u)for(v=0,w=u.length;v<w;v++){B=u[v];if(B.needsUpdate&&(B.boundTo===undefined||B.boundTo==="vertices")){g=0;z=B.value.length;if(B.size===1)for(y=0;y<z;y++)B.array[y]=B.value[y];else if(B.size===2)for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;g+=2;}else if(B.size===3)if(B.type==="c")for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.r;B.array[g+1]=A.g;B.array[g+2]=A.b;g+=3;}else for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;B.array[g+2]=A.z;g+=3;}else if(B.size===4)for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;B.array[g+2]=A.z;B.array[g+3]=A.w;g+=4;}V.bindBuffer(V.ARRAY_BUFFER,B.buffer);V.bufferData(V.ARRAY_BUFFER,B.array,b);}}};function aU(a,b,c,d,e){if(!a.__inittedArrays)return;var f=aO(e),g=aP(e),h=aQ(e),i=(f===THREE.SmoothShading);var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,W,X,Y,Z,$,_,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap=0,aq=0,ar=0,as=0,at=0,au=0,av=0,aw=0,ax=0,ay=0,az=0,aA=0,aB=0,aC,aD=a.__vertexArray,aE=a.__uvArray,aF=a.__uv2Array,aG=a.__normalArray,aH=a.__tangentArray,aI=a.__colorArray,aJ=a.__skinIndexArray,aK=a.__skinWeightArray,aL=a.__morphTargetsArrays,aM=a.__morphNormalsArrays,aN=a.__webglCustomAttributesList,aR,aS=a.__faceArray,aT=a.__lineArray,aU=b.geometry,aV=aU.verticesNeedUpdate,aW=aU.elementsNeedUpdate,aX=aU.uvsNeedUpdate,aY=aU.normalsNeedUpdate,aZ=aU.tangentsNeedUpdate,a$=aU.colorsNeedUpdate,a_=aU.morphTargetsNeedUpdate,bc=aU.vertices,bd=a.faces3,be=aU.faces,bf=aU.faceVertexUvs[0],bg=aU.faceVertexUvs[1],bh=aU.colors,bi=aU.skinIndices,bj=aU.skinWeights,bk=aU.morphTargets,bl=aU.morphNormals;if(aV){for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];v=bc[m.a];w=bc[m.b];x=bc[m.c];aD[aq]=v.x;aD[aq+1]=v.y;aD[aq+2]=v.z;aD[aq+3]=w.x;aD[aq+4]=w.y;aD[aq+5]=w.z;aD[aq+6]=x.x;aD[aq+7]=x.y;aD[aq+8]=x.z;aq+=9;}V.bindBuffer(V.ARRAY_BUFFER,a.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,aD,c);}if(a_)for(ai=0,aj=bk.length;ai<aj;ai++){az=0;for(j=0,k=bd.length;j<k;j++){am=bd[j];m=be[am];v=bk[ai].vertices[m.a];w=bk[ai].vertices[m.b];x=bk[ai].vertices[m.c];ak=aL[ai];ak[az]=v.x;ak[az+1]=v.y;ak[az+2]=v.z;ak[az+3]=w.x;ak[az+4]=w.y;ak[az+5]=w.z;ak[az+6]=x.x;ak[az+7]=x.y;ak[az+8]=x.z;if(e.morphNormals){if(i){an=bl[ai].vertexNormals[am];D=an.a;E=an.b;F=an.c;}else{D=bl[ai].faceNormals[am];E=D;F=D;}al=aM[ai];al[az]=D.x;al[az+1]=D.y;al[az+2]=D.z;al[az+3]=E.x;al[az+4]=E.y;al[az+5]=E.z;al[az+6]=F.x;al[az+7]=F.y;al[az+8]=F.z;}az+=9;}V.bindBuffer(V.ARRAY_BUFFER,a.__webglMorphTargetsBuffers[ai]);V.bufferData(V.ARRAY_BUFFER,aL[ai],c);if(e.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,a.__webglMorphNormalsBuffers[ai]);V.bufferData(V.ARRAY_BUFFER,aM[ai],c);}}if(bj.length){for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];L=bj[m.a];M=bj[m.b];N=bj[m.c];aK[ay]=L.x;aK[ay+1]=L.y;aK[ay+2]=L.z;aK[ay+3]=L.w;aK[ay+4]=M.x;aK[ay+5]=M.y;aK[ay+6]=M.z;aK[ay+7]=M.w;aK[ay+8]=N.x;aK[ay+9]=N.y;aK[ay+10]=N.z;aK[ay+11]=N.w;P=bi[m.a];Q=bi[m.b];R=bi[m.c];aJ[ay]=P.x;aJ[ay+1]=P.y;aJ[ay+2]=P.z;aJ[ay+3]=P.w;aJ[ay+4]=Q.x;aJ[ay+5]=Q.y;aJ[ay+6]=Q.z;aJ[ay+7]=Q.w;aJ[ay+8]=R.x;aJ[ay+9]=R.y;aJ[ay+10]=R.z;aJ[ay+11]=R.w;ay+=12;}if(ay>0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglSkinIndicesBuffer);V.bufferData(V.ARRAY_BUFFER,aJ,c);V.bindBuffer(V.ARRAY_BUFFER,a.__webglSkinWeightsBuffer);V.bufferData(V.ARRAY_BUFFER,aK,c);}}if(a$&&g){for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];q=m.vertexColors;r=m.color;if(q.length===3&&g===THREE.VertexColors){H=q[0];I=q[1];J=q[2];}else{H=r;I=r;J=r;}aI[ax]=H.r;aI[ax+1]=H.g;aI[ax+2]=H.b;aI[ax+3]=I.r;aI[ax+4]=I.g;aI[ax+5]=I.b;aI[ax+6]=J.r;aI[ax+7]=J.g;aI[ax+8]=J.b;ax+=9;}if(ax>0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,aI,c);}}if(aZ&&aU.hasTangents){for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];s=m.vertexTangents;z=s[0];A=s[1];B=s[2];aH[av]=z.x;aH[av+1]=z.y;aH[av+2]=z.z;aH[av+3]=z.w;aH[av+4]=A.x;aH[av+5]=A.y;aH[av+6]=A.z;aH[av+7]=A.w;aH[av+8]=B.x;aH[av+9]=B.y;aH[av+10]=B.z;aH[av+11]=B.w;av+=12;}V.bindBuffer(V.ARRAY_BUFFER,a.__webglTangentBuffer);V.bufferData(V.ARRAY_BUFFER,aH,c);}if(aY&&f){for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];n=m.vertexNormals;o=m.normal;if(n.length===3&&i)for(ad=0;ad<3;ad++){af=n[ad];aG[au]=af.x;aG[au+1]=af.y;aG[au+2]=af.z;au+=3;}else for(ad=0;ad<3;ad++){aG[au]=o.x;aG[au+1]=o.y;aG[au+2]=o.z;au+=3;}}V.bindBuffer(V.ARRAY_BUFFER,a.__webglNormalBuffer);V.bufferData(V.ARRAY_BUFFER,aG,c);}if(aX&&bf&&h){for(j=0,k=bd.length;j<k;j++){l=bd[j];t=bf[l];if(t===undefined)continue;for(ad=0;ad<3;ad++){ag=t[ad];aE[ar]=ag.x;aE[ar+1]=ag.y;ar+=2;}}if(ar>0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglUVBuffer);V.bufferData(V.ARRAY_BUFFER,aE,c);}}if(aX&&bg&&h){for(j=0,k=bd.length;j<k;j++){l=bd[j];u=bg[l];if(u===undefined)continue;for(ad=0;ad<3;ad++){ah=u[ad];aF[as]=ah.x;aF[as+1]=ah.y;as+=2;}}if(as>0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglUV2Buffer);V.bufferData(V.ARRAY_BUFFER,aF,c);}}if(aW){for(j=0,k=bd.length;j<k;j++){aS[at]=ap;aS[at+1]=ap+1;aS[at+2]=ap+2;at+=3;aT[aw]=ap;aT[aw+1]=ap+1;aT[aw+2]=ap;aT[aw+3]=ap+2;aT[aw+4]=ap+1;aT[aw+5]=ap+2;aw+=6;ap+=3;}V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer);V.bufferData(V.ELEMENT_ARRAY_BUFFER,aS,c);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer);V.bufferData(V.ELEMENT_ARRAY_BUFFER,aT,c);}if(aN)for(ad=0,ae=aN.length;ad<ae;ad++){aR=aN[ad];if(!aR.__original.needsUpdate)continue;aA=0;aB=0;if(aR.size===1){if(aR.boundTo===undefined||aR.boundTo==="vertices")for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];aR.array[aA]=aR.value[m.a];aR.array[aA+1]=aR.value[m.b];aR.array[aA+2]=aR.value[m.c];aA+=3;}else if(aR.boundTo==="faces")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];aR.array[aA]=aC;aR.array[aA+1]=aC;aR.array[aA+2]=aC;aA+=3;}}else if(aR.size===2){if(aR.boundTo===undefined||aR.boundTo==="vertices")for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];v=aR.value[m.a];w=aR.value[m.b];x=aR.value[m.c];aR.array[aA]=v.x;aR.array[aA+1]=v.y;aR.array[aA+2]=w.x;aR.array[aA+3]=w.y;aR.array[aA+4]=x.x;aR.array[aA+5]=x.y;aA+=6;}else if(aR.boundTo==="faces")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];v=aC;w=aC;x=aC;aR.array[aA]=v.x;aR.array[aA+1]=v.y;aR.array[aA+2]=w.x;aR.array[aA+3]=w.y;aR.array[aA+4]=x.x;aR.array[aA+5]=x.y;aA+=6;}}else if(aR.size===3){var bm;if(aR.type==="c")bm=["r","g","b"];else bm=["x","y","z"];if(aR.boundTo===undefined||aR.boundTo==="vertices")for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];v=aR.value[m.a];w=aR.value[m.b];x=aR.value[m.c];aR.array[aA]=v[bm[0]];aR.array[aA+1]=v[bm[1]];aR.array[aA+2]=v[bm[2]];aR.array[aA+3]=w[bm[0]];aR.array[aA+4]=w[bm[1]];aR.array[aA+5]=w[bm[2]];aR.array[aA+6]=x[bm[0]];aR.array[aA+7]=x[bm[1]];aR.array[aA+8]=x[bm[2]];aA+=9;}else if(aR.boundTo==="faces")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];v=aC;w=aC;x=aC;aR.array[aA]=v[bm[0]];aR.array[aA+1]=v[bm[1]];aR.array[aA+2]=v[bm[2]];aR.array[aA+3]=w[bm[0]];aR.array[aA+4]=w[bm[1]];aR.array[aA+5]=w[bm[2]];aR.array[aA+6]=x[bm[0]];aR.array[aA+7]=x[bm[1]];aR.array[aA+8]=x[bm[2]];aA+=9;}else if(aR.boundTo==="faceVertices")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];v=aC[0];w=aC[1];x=aC[2];aR.array[aA]=v[bm[0]];aR.array[aA+1]=v[bm[1]];aR.array[aA+2]=v[bm[2]];aR.array[aA+3]=w[bm[0]];aR.array[aA+4]=w[bm[1]];aR.array[aA+5]=w[bm[2]];aR.array[aA+6]=x[bm[0]];aR.array[aA+7]=x[bm[1]];aR.array[aA+8]=x[bm[2]];aA+=9;}}else if(aR.size===4)if(aR.boundTo===undefined||aR.boundTo==="vertices")for(j=0,k=bd.length;j<k;j++){m=be[bd[j]];v=aR.value[m.a];w=aR.value[m.b];x=aR.value[m.c];aR.array[aA]=v.x;aR.array[aA+1]=v.y;aR.array[aA+2]=v.z;aR.array[aA+3]=v.w;aR.array[aA+4]=w.x;aR.array[aA+5]=w.y;aR.array[aA+6]=w.z;aR.array[aA+7]=w.w;aR.array[aA+8]=x.x;aR.array[aA+9]=x.y;aR.array[aA+10]=x.z;aR.array[aA+11]=x.w;aA+=12;}else if(aR.boundTo==="faces")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];v=aC;w=aC;x=aC;aR.array[aA]=v.x;aR.array[aA+1]=v.y;aR.array[aA+2]=v.z;aR.array[aA+3]=v.w;aR.array[aA+4]=w.x;aR.array[aA+5]=w.y;aR.array[aA+6]=w.z;aR.array[aA+7]=w.w;aR.array[aA+8]=x.x;aR.array[aA+9]=x.y;aR.array[aA+10]=x.z;aR.array[aA+11]=x.w;aA+=12;}else if(aR.boundTo==="faceVertices")for(j=0,k=bd.length;j<k;j++){aC=aR.value[bd[j]];v=aC[0];w=aC[1];x=aC[2];aR.array[aA]=v.x;aR.array[aA+1]=v.y;aR.array[aA+2]=v.z;aR.array[aA+3]=v.w;aR.array[aA+4]=w.x;aR.array[aA+5]=w.y;aR.array[aA+6]=w.z;aR.array[aA+7]=w.w;aR.array[aA+8]=x.x;aR.array[aA+9]=x.y;aR.array[aA+10]=x.z;aR.array[aA+11]=x.w;aA+=12;}V.bindBuffer(V.ARRAY_BUFFER,aR.buffer);V.bufferData(V.ARRAY_BUFFER,aR.array,c);}if(d){delete a.__inittedArrays;delete a.__colorArray;delete a.__normalArray;delete a.__tangentArray;delete a.__uvArray;delete a.__uv2Array;delete a.__faceArray;delete a.__vertexArray;delete a.__lineArray;delete a.__skinIndexArray;delete a.__skinWeightArray;}};function aV(a,b,c,d){var e,f,g,h;for(f in b){g=b[f];e=c[f];if(g>=0)if(e){h=e.itemSize;V.bindBuffer(V.ARRAY_BUFFER,e.buffer);aX(g);V.vertexAttribPointer(g,h,V.FLOAT,false,0,d*h*4);}else if(a.defaultAttributeValues)if(a.defaultAttributeValues[f].length===2)V.vertexAttrib2fv(g,a.defaultAttributeValues[f]);else if(a.defaultAttributeValues[f].length===3)V.vertexAttrib3fv(g,a.defaultAttributeValues[f]);}}function aW(a,b){var c=a.attributes;var d,e;for(d in c){e=c[d];if(e.needsUpdate){if(d==='index'){V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.buffer);V.bufferData(V.ELEMENT_ARRAY_BUFFER,e.array,b);}else{V.bindBuffer(V.ARRAY_BUFFER,e.buffer);V.bufferData(V.ARRAY_BUFFER,e.array,b);}e.needsUpdate=false;}}}this.renderBufferImmediate=function(a,b,c){if(a.hasPositions&&!a.__webglVertexBuffer)a.__webglVertexBuffer=V.createBuffer();if(a.hasNormals&&!a.__webglNormalBuffer)a.__webglNormalBuffer=V.createBuffer();if(a.hasUvs&&!a.__webglUvBuffer)a.__webglUvBuffer=V.createBuffer();if(a.hasColors&&!a.__webglColorBuffer)a.__webglColorBuffer=V.createBuffer();if(a.hasPositions){V.bindBuffer(V.ARRAY_BUFFER,a.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,a.positionArray,V.DYNAMIC_DRAW);V.enableVertexAttribArray(b.attributes.position);V.vertexAttribPointer(b.attributes.position,3,V.FLOAT,false,0,0);}if(a.hasNormals){V.bindBuffer(V.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===THREE.FlatShading){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.count*3;for(q=0;q<r;q+=9){p=a.normalArray;g=p[q];j=p[q+1];m=p[q+2];h=p[q+3];k=p[q+4];n=p[q+5];i=p[q+6];l=p[q+7];o=p[q+8];d=(g+h+i)/3;e=(j+k+l)/3;f=(m+n+o)/3;p[q]=d;p[q+1]=e;p[q+2]=f;p[q+3]=d;p[q+4]=e;p[q+5]=f;p[q+6]=d;p[q+7]=e;p[q+8]=f;}}V.bufferData(V.ARRAY_BUFFER,a.normalArray,V.DYNAMIC_DRAW);V.enableVertexAttribArray(b.attributes.normal);V.vertexAttribPointer(b.attributes.normal,3,V.FLOAT,false,0,0);}if(a.hasUvs&&c.map){V.bindBuffer(V.ARRAY_BUFFER,a.__webglUvBuffer);V.bufferData(V.ARRAY_BUFFER,a.uvArray,V.DYNAMIC_DRAW);V.enableVertexAttribArray(b.attributes.uv);V.vertexAttribPointer(b.attributes.uv,2,V.FLOAT,false,0,0);}if(a.hasColors&&c.vertexColors!==THREE.NoColors){V.bindBuffer(V.ARRAY_BUFFER,a.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,a.colorArray,V.DYNAMIC_DRAW);V.enableVertexAttribArray(b.attributes.color);V.vertexAttribPointer(b.attributes.color,3,V.FLOAT,false,0,0);}V.drawArrays(V.TRIANGLES,0,a.count);a.count=0;};this.renderBufferDirect=function(a,b,c,d,e,f){if(d.visible===false)return;var g,h,i;var j,k,l,n;var o=br(a,b,c,d,f);var p=o.attributes;var q=e.attributes;var r=false,t=d.wireframe?1:0,u=(e.id*0xffffff)+(o.id*2)+t;if(u!==s){s=u;r=true;}if(r)aY();if(f instanceof THREE.Mesh){var v=q.index;if(v){var w=e.offsets;if(w.length>1)r=true;for(var x=0,y=w.length;x<y;x++){var z=w[x].index;if(r){for(k in p){l=p[k];j=q[k];if(l>=0)if(j){n=j.itemSize;V.bindBuffer(V.ARRAY_BUFFER,j.buffer);aX(l);V.vertexAttribPointer(l,n,V.FLOAT,false,0,z*n*4);}else if(d.defaultAttributeValues)if(d.defaultAttributeValues[k].length===2)V.vertexAttrib2fv(l,d.defaultAttributeValues[k]);else if(d.defaultAttributeValues[k].length===3)V.vertexAttrib3fv(l,d.defaultAttributeValues[k]);}V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,v.buffer);}V.drawElements(V.TRIANGLES,w[x].count,V.UNSIGNED_SHORT,w[x].start*2);m.info.render.calls++;m.info.render.vertices+=w[x].count;m.info.render.faces+=w[x].count/3;}}else{if(r)for(k in p){if(k==='index')continue;l=p[k];j=q[k];if(l>=0)if(j){n=j.itemSize;V.bindBuffer(V.ARRAY_BUFFER,j.buffer);aX(l);V.vertexAttribPointer(l,n,V.FLOAT,false,0,0);}else if(d.defaultAttributeValues&&d.defaultAttributeValues[k])if(d.defaultAttributeValues[k].length===2)V.vertexAttrib2fv(l,d.defaultAttributeValues[k]);else if(d.defaultAttributeValues[k].length===3)V.vertexAttrib3fv(l,d.defaultAttributeValues[k]);}var A=e.attributes.position;V.drawArrays(V.TRIANGLES,0,A.array.length/3);m.info.render.calls++;m.info.render.vertices+=A.array.length/3;m.info.render.faces+=A.array.length/3/3;}}else if(f instanceof THREE.ParticleSystem){if(r)for(k in p){l=p[k];j=q[k];if(l>=0)if(j){n=j.itemSize;V.bindBuffer(V.ARRAY_BUFFER,j.buffer);aX(l);V.vertexAttribPointer(l,n,V.FLOAT,false,0,0);}else if(d.defaultAttributeValues&&d.defaultAttributeValues[k])if(d.defaultAttributeValues[k].length===2)V.vertexAttrib2fv(l,d.defaultAttributeValues[k]);else if(d.defaultAttributeValues[k].length===3)V.vertexAttrib3fv(l,d.defaultAttributeValues[k]);}var A=q.position;V.drawArrays(V.POINTS,0,A.array.length/3);m.info.render.calls++;m.info.render.points+=A.array.length/3;}else if(f instanceof THREE.Line){var B=(f.type===THREE.LineStrip)?V.LINE_STRIP:V.LINES;bI(d.linewidth);var v=q.index;if(v){var w=e.offsets;if(w.length>1)r=true;for(var x=0,y=w.length;x<y;x++){var z=w[x].index;if(r){aV(d,p,q,z);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,v.buffer);}V.drawElements(V.LINES,w[x].count,V.UNSIGNED_SHORT,w[x].start*2);m.info.render.calls++;m.info.render.vertices+=w[x].count;}}else{if(r)aV(d,p,q,0);var A=q.position;V.drawArrays(B,0,A.array.length/3);m.info.render.calls++;m.info.render.points+=A.array.length;}}};this.renderBuffer=function(a,b,c,d,e,f){if(d.visible===false)return;var g,h,i,j,k;var l=br(a,b,c,d,f);var n=l.attributes;var o=false,p=d.wireframe?1:0,q=(e.id*0xffffff)+(l.id*2)+p;if(q!==s){s=q;o=true;}if(o)aY();if(!d.morphTargets&&n.position>=0){if(o){V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer);aX(n.position);V.vertexAttribPointer(n.position,3,V.FLOAT,false,0,0);}}else if(f.morphTargetBase)aZ(d,e,f);if(o){if(e.__webglCustomAttributesList)for(j=0,k=e.__webglCustomAttributesList.length;j<k;j++){i=e.__webglCustomAttributesList[j];if(n[i.buffer.belongsToAttribute]>=0){V.bindBuffer(V.ARRAY_BUFFER,i.buffer);aX(n[i.buffer.belongsToAttribute]);V.vertexAttribPointer(n[i.buffer.belongsToAttribute],i.size,V.FLOAT,false,0,0);}}if(n.color>=0)if(f.geometry.colors.length>0||f.geometry.faces.length>0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer);aX(n.color);V.vertexAttribPointer(n.color,3,V.FLOAT,false,0,0);}else if(d.defaultAttributeValues)V.vertexAttrib3fv(n.color,d.defaultAttributeValues.color);if(n.normal>=0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglNormalBuffer);aX(n.normal);V.vertexAttribPointer(n.normal,3,V.FLOAT,false,0,0);}if(n.tangent>=0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglTangentBuffer);aX(n.tangent);V.vertexAttribPointer(n.tangent,4,V.FLOAT,false,0,0);}if(n.uv>=0)if(f.geometry.faceVertexUvs[0]){V.bindBuffer(V.ARRAY_BUFFER,e.__webglUVBuffer);aX(n.uv);V.vertexAttribPointer(n.uv,2,V.FLOAT,false,0,0);}else if(d.defaultAttributeValues)V.vertexAttrib2fv(n.uv,d.defaultAttributeValues.uv);if(n.uv2>=0)if(f.geometry.faceVertexUvs[1]){V.bindBuffer(V.ARRAY_BUFFER,e.__webglUV2Buffer);aX(n.uv2);V.vertexAttribPointer(n.uv2,2,V.FLOAT,false,0,0);}else if(d.defaultAttributeValues)V.vertexAttrib2fv(n.uv2,d.defaultAttributeValues.uv2);if(d.skinning&&n.skinIndex>=0&&n.skinWeight>=0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);aX(n.skinIndex);V.vertexAttribPointer(n.skinIndex,4,V.FLOAT,false,0,0);V.bindBuffer(V.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);aX(n.skinWeight);V.vertexAttribPointer(n.skinWeight,4,V.FLOAT,false,0,0);}if(n.lineDistance>=0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglLineDistanceBuffer);aX(n.lineDistance);V.vertexAttribPointer(n.lineDistance,1,V.FLOAT,false,0,0);}}if(f instanceof THREE.Mesh){if(d.wireframe){bI(d.wireframeLinewidth);if(o)V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);V.drawElements(V.LINES,e.__webglLineCount,V.UNSIGNED_SHORT,0);}else{if(o)V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);V.drawElements(V.TRIANGLES,e.__webglFaceCount,V.UNSIGNED_SHORT,0);}m.info.render.calls++;m.info.render.vertices+=e.__webglFaceCount;m.info.render.faces+=e.__webglFaceCount/3;}else if(f instanceof THREE.Line){var r=(f.type===THREE.LineStrip)?V.LINE_STRIP:V.LINES;bI(d.linewidth);V.drawArrays(r,0,e.__webglLineCount);m.info.render.calls++;}else if(f instanceof THREE.ParticleSystem){V.drawArrays(V.POINTS,0,e.__webglParticleCount);m.info.render.calls++;m.info.render.points+=e.__webglParticleCount;}};function aX(a){if(N[a]===0){V.enableVertexAttribArray(a);N[a]=1;}};function aY(){for(var a in N)if(N[a]===1){V.disableVertexAttribArray(a);N[a]=0;}};function aZ(a,b,c){var d=a.program.attributes;if(c.morphTargetBase!==-1&&d.position>=0){V.bindBuffer(V.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[c.morphTargetBase]);aX(d.position);V.vertexAttribPointer(d.position,3,V.FLOAT,false,0,0);}else if(d.position>=0){V.bindBuffer(V.ARRAY_BUFFER,b.__webglVertexBuffer);aX(d.position);V.vertexAttribPointer(d.position,3,V.FLOAT,false,0,0);}if(c.morphTargetForcedOrder.length){var e=0;var f=c.morphTargetForcedOrder;var g=c.morphTargetInfluences;while(e<a.numSupportedMorphTargets&&e<f.length){if(d["morphTarget"+e]>=0){V.bindBuffer(V.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[f[e]]);aX(d["morphTarget"+e]);V.vertexAttribPointer(d["morphTarget"+e],3,V.FLOAT,false,0,0);}if(d["morphNormal"+e]>=0&&a.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[f[e]]);aX(d["morphNormal"+e]);V.vertexAttribPointer(d["morphNormal"+e],3,V.FLOAT,false,0,0);}c.__webglMorphTargetInfluences[e]=g[f[e]];e++;}}else{var h,i=[];var g=c.morphTargetInfluences;var j,k=g.length;for(j=0;j<k;j++){h=g[j];if(h>0)i.push([h,j]);}if(i.length>a.numSupportedMorphTargets){i.sort(a_);i.length=a.numSupportedMorphTargets;}else if(i.length>a.numSupportedMorphNormals)i.sort(a_);else if(i.length===0)i.push([0,0]);;var l,e=0;while(e<a.numSupportedMorphTargets){if(i[e]){l=i[e][1];if(d["morphTarget"+e]>=0){V.bindBuffer(V.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[l]);aX(d["morphTarget"+e]);V.vertexAttribPointer(d["morphTarget"+e],3,V.FLOAT,false,0,0);}if(d["morphNormal"+e]>=0&&a.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[l]);aX(d["morphNormal"+e]);V.vertexAttribPointer(d["morphNormal"+e],3,V.FLOAT,false,0,0);}c.__webglMorphTargetInfluences[e]=g[l];}else c.__webglMorphTargetInfluences[e]=0;e++;}}if(a.program.uniforms.morphTargetInfluences!==null)V.uniform1fv(a.program.uniforms.morphTargetInfluences,c.__webglMorphTargetInfluences);};function a$(a,b){if(a.z!==b.z)return b.z-a.z;else return a.id-b.id;};function a_(a,b){return b[0]-a[0];};this.render=function(a,b,c,d){if(b instanceof THREE.Camera===false){console.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');return;}var e,f,g,h,i,j=a.__lights,k=a.fog;r=-1;T=true;if(a.autoUpdate===true)a.updateMatrixWorld();if(b.parent===undefined)b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);P.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);O.setFromMatrix(P);if(this.autoUpdateObjects)this.initWebGLObjects(a);bc(this.renderPluginsPre,a,b);m.info.render.calls=0;m.info.render.vertices=0;m.info.render.faces=0;m.info.render.points=0;this.setRenderTarget(c);if(this.autoClear||d)this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);i=a.__webglObjects;for(e=0,f=i.length;e<f;e++){g=i[e];h=g.object;g.id=e;g.render=false;if(h.visible)if(!(h instanceof THREE.Mesh||h instanceof THREE.ParticleSystem)||!(h.frustumCulled)||O.intersectsObject(h)){bE(h,b);bg(g);g.render=true;if(this.sortObjects===true)if(h.renderDepth!==null)g.z=h.renderDepth;else{R.setFromMatrixPosition(h.matrixWorld);R.applyProjection(P);g.z=R.z;}}}if(this.sortObjects)i.sort(a$);i=a.__webglObjectsImmediate;for(e=0,f=i.length;e<f;e++){g=i[e];h=g.object;if(h.visible){bE(h,b);bf(g);}}if(a.overrideMaterial){var l=a.overrideMaterial;this.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst);this.setDepthTest(l.depthTest);this.setDepthWrite(l.depthWrite);bJ(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits);bd(a.__webglObjects,false,"",b,j,k,true,l);be(a.__webglObjectsImmediate,"",b,j,k,false,l);}else{var l=null;this.setBlending(THREE.NoBlending);bd(a.__webglObjects,true,"opaque",b,j,k,false,l);be(a.__webglObjectsImmediate,"opaque",b,j,k,false,l);bd(a.__webglObjects,false,"transparent",b,j,k,true,l);be(a.__webglObjectsImmediate,"transparent",b,j,k,true,l);}bc(this.renderPluginsPost,a,b);if(c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter)bW(c);this.setDepthTest(true);this.setDepthWrite(true);};function bc(a,b,c){if(!a.length)return;for(var d=0,e=a.length;d<e;d++){p=null;t=null;x=-1;B=-1;C=-1;v=-1;w=-1;s=-1;r=-1;T=true;a[d].render(b,c,L,M);p=null;t=null;x=-1;B=-1;C=-1;v=-1;w=-1;s=-1;r=-1;T=true;}};function bd(a,b,c,d,e,f,g,h){var i,j,k,l,n,o,p;if(b){n=a.length-1;o=-1;p=-1;}else{n=0;o=a.length;p=1;}for(var q=n;q!==o;q+=p){i=a[q];if(i.render){j=i.object;k=i.buffer;if(h)l=h;else{l=i[c];if(!l)continue;if(g)m.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst);m.setDepthTest(l.depthTest);m.setDepthWrite(l.depthWrite);bJ(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits);}m.setMaterialFaces(l);if(k instanceof THREE.BufferGeometry)m.renderBufferDirect(d,e,f,l,k,j);else m.renderBuffer(d,e,f,l,k,j);}}};function be(a,b,c,d,e,f,g){var h,i,j,k;for(var l=0,n=a.length;l<n;l++){h=a[l];i=h.object;if(i.visible){if(g)j=g;else{j=h[b];if(!j)continue;if(f)m.setBlending(j.blending,j.blendEquation,j.blendSrc,j.blendDst);m.setDepthTest(j.depthTest);m.setDepthWrite(j.depthWrite);bJ(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits);}m.renderImmediateObject(c,d,e,j,i);}}};this.renderImmediateObject=function(a,b,c,d,e){var f=br(a,b,c,d,e);s=-1;m.setMaterialFaces(d);if(e.immediateRenderCallback)e.immediateRenderCallback(f,V,O);else e.render(function(a){m.renderBufferImmediate(a,f,d);});};function bf(a){var b=a.object,c=b.material;if(c.transparent){a.transparent=c;a.opaque=null;}else{a.opaque=c;a.transparent=null;}};function bg(a){var b=a.object;var c=a.buffer;var d=b.geometry;var e=b.material;if(e instanceof THREE.MeshFaceMaterial){var f=d instanceof THREE.BufferGeometry?0:c.materialIndex;e=e.materials[f];if(e.transparent){a.transparent=e;a.opaque=null;}else{a.opaque=e;a.transparent=null;}}else if(e)if(e.transparent){a.transparent=e;a.opaque=null;}else{a.opaque=e;a.transparent=null;}};this.initWebGLObjects=function(a){if(!a.__webglObjects){a.__webglObjects=[];a.__webglObjectsImmediate=[];a.__webglSprites=[];a.__webglFlares=[];}while(a.__objectsAdded.length){bh(a.__objectsAdded[0],a);a.__objectsAdded.splice(0,1);}while(a.__objectsRemoved.length){bn(a.__objectsRemoved[0],a);a.__objectsRemoved.splice(0,1);}for(var b=0,c=a.__webglObjects.length;b<c;b++){var d=a.__webglObjects[b].object;if(d.__webglInit===undefined){if(d.__webglActive!==undefined)bn(d,a);bh(d,a);}bk(d);}};function bh(a,b){var c,d,e,f;if(a.__webglInit===undefined){a.__webglInit=true;a._modelViewMatrix=new THREE.Matrix4();a._normalMatrix=new THREE.Matrix3();if(a.geometry!==undefined&&a.geometry.__webglInit===undefined){a.geometry.__webglInit=true;a.geometry.addEventListener('dispose',az);}d=a.geometry;if(d===undefined){}else if(d instanceof THREE.BufferGeometry)aR(d);else if(a instanceof THREE.Mesh){e=a.material;if(d.geometryGroups===undefined)d.makeGroups(e instanceof THREE.MeshFaceMaterial);for(c in d.geometryGroups){f=d.geometryGroups[c];if(!f.__webglVertexBuffer){ay(f);aL(f,a);d.verticesNeedUpdate=true;d.morphTargetsNeedUpdate=true;d.elementsNeedUpdate=true;d.uvsNeedUpdate=true;d.normalsNeedUpdate=true;d.tangentsNeedUpdate=true;d.colorsNeedUpdate=true;}}}else if(a instanceof THREE.Line){if(!d.__webglVertexBuffer){ax(d);aK(d,a);d.verticesNeedUpdate=true;d.colorsNeedUpdate=true;d.lineDistancesNeedUpdate=true;}}else if(a instanceof THREE.ParticleSystem)if(!d.__webglVertexBuffer){aw(d);aJ(d,a);d.verticesNeedUpdate=true;d.colorsNeedUpdate=true;}}if(a.__webglActive===undefined){if(a instanceof THREE.Mesh){d=a.geometry;if(d instanceof THREE.BufferGeometry)bi(b.__webglObjects,d,a);else if(d instanceof THREE.Geometry)for(c in d.geometryGroups){f=d.geometryGroups[c];bi(b.__webglObjects,f,a);}}else if(a instanceof THREE.Line||a instanceof THREE.ParticleSystem){d=a.geometry;bi(b.__webglObjects,d,a);}else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)bj(b.__webglObjectsImmediate,a);else if(a instanceof THREE.Sprite)b.__webglSprites.push(a);else if(a instanceof THREE.LensFlare)b.__webglFlares.push(a);a.__webglActive=true;}};function bi(a,b,c){a.push({id:null,buffer:b,object:c,opaque:null,transparent:null,z:0});};function bj(a,b){a.push({id:null,object:b,opaque:null,transparent:null,z:0});};function bk(a){var b=a.geometry,c,d,e;if(b instanceof THREE.BufferGeometry)aW(b,V.DYNAMIC_DRAW);else if(a instanceof THREE.Mesh){for(var f=0,g=b.geometryGroupsList.length;f<g;f++){c=b.geometryGroupsList[f];e=aM(a,c);if(b.buffersNeedUpdate)aL(c,a);d=e.attributes&&bl(e);if(b.verticesNeedUpdate||b.morphTargetsNeedUpdate||b.elementsNeedUpdate||b.uvsNeedUpdate||b.normalsNeedUpdate||b.colorsNeedUpdate||b.tangentsNeedUpdate||d)aU(c,a,V.DYNAMIC_DRAW,!b.dynamic,e);}b.verticesNeedUpdate=false;b.morphTargetsNeedUpdate=false;b.elementsNeedUpdate=false;b.uvsNeedUpdate=false;b.normalsNeedUpdate=false;b.colorsNeedUpdate=false;b.tangentsNeedUpdate=false;b.buffersNeedUpdate=false;e.attributes&&bm(e);}else if(a instanceof THREE.Line){e=aM(a,b);d=e.attributes&&bl(e);if(b.verticesNeedUpdate||b.colorsNeedUpdate||b.lineDistancesNeedUpdate||d)aT(b,V.DYNAMIC_DRAW);b.verticesNeedUpdate=false;b.colorsNeedUpdate=false;b.lineDistancesNeedUpdate=false;e.attributes&&bm(e);}else if(a instanceof THREE.ParticleSystem){e=aM(a,b);d=e.attributes&&bl(e);if(b.verticesNeedUpdate||b.colorsNeedUpdate||a.sortParticles||d)aS(b,V.DYNAMIC_DRAW,a);b.verticesNeedUpdate=false;b.colorsNeedUpdate=false;e.attributes&&bm(e);}};function bl(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return true;return false;};function bm(a){for(var b in a.attributes)a.attributes[b].needsUpdate=false;};function bn(a,b){if(a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem||a instanceof THREE.Line)bo(b.__webglObjects,a);else if(a instanceof THREE.Sprite)bp(b.__webglSprites,a);else if(a instanceof THREE.LensFlare)bp(b.__webglFlares,a);else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)bo(b.__webglObjectsImmediate,a);delete a.__webglActive;};function bo(a,b){for(var c=a.length-1;c>=0;c--)if(a[c].object===b)a.splice(c,1);};function bp(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b)a.splice(c,1);};this.initMaterial=function(a,b,c,d){a.addEventListener('dispose',aC);var e,f,g,h,i,j,k,l,m;if(a instanceof THREE.MeshDepthMaterial)m='depth';else if(a instanceof THREE.MeshNormalMaterial)m='normal';else if(a instanceof THREE.MeshBasicMaterial)m='basic';else if(a instanceof THREE.MeshLambertMaterial)m='lambert';else if(a instanceof THREE.MeshPhongMaterial)m='phong';else if(a instanceof THREE.LineBasicMaterial)m='basic';else if(a instanceof THREE.LineDashedMaterial)m='dashed';else if(a instanceof THREE.ParticleSystemMaterial)m='particle_basic';if(m)bq(a,THREE.ShaderLib[m]);j=b$(b);l=b_(b);k=bZ(d);i={map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:a.sizeAttenuation,skinning:a.skinning,maxBones:k,useVertexTexture:ag&&d&&d.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:j.directional,maxPointLights:j.point,maxSpotLights:j.spot,maxHemiLights:j.hemi,maxShadows:l,shadowMapEnabled:this.shadowMapEnabled&&d.receiveShadow&&l>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,wrapAround:a.wrapAround,doubleSided:a.side===THREE.DoubleSide,flipSided:a.side===THREE.BackSide};a.program=bL(m,a.fragmentShader,a.vertexShader,a.uniforms,a.attributes,a.defines,i,a.index0AttributeName);var n=a.program.attributes;if(a.morphTargets){a.numSupportedMorphTargets=0;var o,p="morphTarget";for(h=0;h<this.maxMorphTargets;h++){o=p+h;if(n[o]>=0)a.numSupportedMorphTargets++;}}if(a.morphNormals){a.numSupportedMorphNormals=0;var o,p="morphNormal";for(h=0;h<this.maxMorphNormals;h++){o=p+h;if(n[o]>=0)a.numSupportedMorphNormals++;}}a.uniformsList=[];for(e in a.uniforms)a.uniformsList.push([a.uniforms[e],e]);};function bq(a,b){a.uniforms=THREE.UniformsUtils.clone(b.uniforms);a.vertexShader=b.vertexShader;a.fragmentShader=b.fragmentShader;};function br(a,b,c,d,e){u=0;if(d.needsUpdate){if(d.program)aH(d);m.initMaterial(d,b,c,e);d.needsUpdate=false;}if(d.morphTargets)if(!e.__webglMorphTargetInfluences)e.__webglMorphTargetInfluences=new Float32Array(m.maxMorphTargets);var f=false;var g=d.program,h=g.uniforms,i=d.uniforms;if(g!==p){V.useProgram(g);p=g;f=true;}if(d.id!==r){r=d.id;f=true;}if(f||a!==t){V.uniformMatrix4fv(h.projectionMatrix,false,a.projectionMatrix.elements);if(a!==t)t=a;}if(d.skinning)if(ag&&e.useVertexTexture){if(h.boneTexture!==null){var j=bC();V.uniform1i(h.boneTexture,j);m.setTexture(e.boneTexture,j);}if(h.boneTextureWidth!==null)V.uniform1i(h.boneTextureWidth,e.boneTextureWidth);if(h.boneTextureHeight!==null)V.uniform1i(h.boneTextureHeight,e.boneTextureHeight);}else if(h.boneGlobalMatrices!==null)V.uniformMatrix4fv(h.boneGlobalMatrices,false,e.boneMatrices);if(f){if(c&&d.fog)bw(i,c);if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights){if(T){bH(g,b);T=false;}bz(i,U);}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)bs(i,d);if(d instanceof THREE.LineBasicMaterial)bt(i,d);else if(d instanceof THREE.LineDashedMaterial){bt(i,d);bu(i,d);}else if(d instanceof THREE.ParticleSystemMaterial)bv(i,d);else if(d instanceof THREE.MeshPhongMaterial)bx(i,d);else if(d instanceof THREE.MeshLambertMaterial)by(i,d);else if(d instanceof THREE.MeshDepthMaterial){i.mNear.value=a.near;i.mFar.value=a.far;i.opacity.value=d.opacity;}else if(d instanceof THREE.MeshNormalMaterial)i.opacity.value=d.opacity;if(e.receiveShadow&&!d._shadowPass)bA(i,b);bD(g,d.uniformsList);if(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)if(h.cameraPosition!==null){R.setFromMatrixPosition(a.matrixWorld);V.uniform3f(h.cameraPosition,R.x,R.y,R.z);}if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning)if(h.viewMatrix!==null)V.uniformMatrix4fv(h.viewMatrix,false,a.matrixWorldInverse.elements);}bB(h,e);if(h.modelMatrix!==null)V.uniformMatrix4fv(h.modelMatrix,false,e.matrixWorld.elements);return g;};function bs(a,b){a.opacity.value=b.opacity;if(m.gammaInput)a.diffuse.value.copyGammaToLinear(b.color);else a.diffuse.value=b.color;a.map.value=b.map;a.lightMap.value=b.lightMap;a.specularMap.value=b.specularMap;if(b.bumpMap){a.bumpMap.value=b.bumpMap;a.bumpScale.value=b.bumpScale;}if(b.normalMap){a.normalMap.value=b.normalMap;a.normalScale.value.copy(b.normalScale);}var c;if(b.map)c=b.map;else if(b.specularMap)c=b.specularMap;else if(b.normalMap)c=b.normalMap;else if(b.bumpMap)c=b.bumpMap;if(c!==undefined){var d=c.offset;var e=c.repeat;a.offsetRepeat.value.set(d.x,d.y,e.x,e.y);}a.envMap.value=b.envMap;a.flipEnvMap.value=(b.envMap instanceof THREE.WebGLRenderTargetCube)?1:-1;if(m.gammaInput)a.reflectivity.value=b.reflectivity;else a.reflectivity.value=b.reflectivity;a.refractionRatio.value=b.refractionRatio;a.combine.value=b.combine;a.useRefract.value=b.envMap&&b.envMap.mapping instanceof THREE.CubeRefractionMapping;};function bt(a,b){a.diffuse.value=b.color;a.opacity.value=b.opacity;};function bu(a,b){a.dashSize.value=b.dashSize;a.totalSize.value=b.dashSize+b.gapSize;a.scale.value=b.scale;};function bv(a,c){a.psColor.value=c.color;a.opacity.value=c.opacity;a.size.value=c.size;a.scale.value=b.height/2.0;a.map.value=c.map;};function bw(a,b){a.fogColor.value=b.color;if(b instanceof THREE.Fog){a.fogNear.value=b.near;a.fogFar.value=b.far;}else if(b instanceof THREE.FogExp2)a.fogDensity.value=b.density;};function bx(a,b){a.shininess.value=b.shininess;if(m.gammaInput){a.ambient.value.copyGammaToLinear(b.ambient);a.emissive.value.copyGammaToLinear(b.emissive);a.specular.value.copyGammaToLinear(b.specular);}else{a.ambient.value=b.ambient;a.emissive.value=b.emissive;a.specular.value=b.specular;}if(b.wrapAround)a.wrapRGB.value.copy(b.wrapRGB);};function by(a,b){if(m.gammaInput){a.ambient.value.copyGammaToLinear(b.ambient);a.emissive.value.copyGammaToLinear(b.emissive);}else{a.ambient.value=b.ambient;a.emissive.value=b.emissive;}if(b.wrapAround)a.wrapRGB.value.copy(b.wrapRGB);};function bz(a,b){a.ambientLightColor.value=b.ambient;a.directionalLightColor.value=b.directional.colors;a.directionalLightDirection.value=b.directional.positions;a.pointLightColor.value=b.point.colors;a.pointLightPosition.value=b.point.positions;a.pointLightDistance.value=b.point.distances;a.spotLightColor.value=b.spot.colors;a.spotLightPosition.value=b.spot.positions;a.spotLightDistance.value=b.spot.distances;a.spotLightDirection.value=b.spot.directions;a.spotLightAngleCos.value=b.spot.anglesCos;a.spotLightExponent.value=b.spot.exponents;a.hemisphereLightSkyColor.value=b.hemi.skyColors;a.hemisphereLightGroundColor.value=b.hemi.groundColors;a.hemisphereLightDirection.value=b.hemi.positions;};function bA(a,b){if(a.shadowMatrix){var c=0;for(var d=0,e=b.length;d<e;d++){var f=b[d];if(!f.castShadow)continue;if(f instanceof THREE.SpotLight||(f instanceof THREE.DirectionalLight&&!f.shadowCascade)){a.shadowMap.value[c]=f.shadowMap;a.shadowMapSize.value[c]=f.shadowMapSize;a.shadowMatrix.value[c]=f.shadowMatrix;a.shadowDarkness.value[c]=f.shadowDarkness;a.shadowBias.value[c]=f.shadowBias;c++;}}}};function bB(a,b){V.uniformMatrix4fv(a.modelViewMatrix,false,b._modelViewMatrix.elements);if(a.normalMatrix)V.uniformMatrix3fv(a.normalMatrix,false,b._normalMatrix.elements);};function bC(){var a=u;if(a>=_)console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+_);u+=1;return a;};function bD(a,b){var c,d,e,f,g,h,i,j,k,l,n;for(k=0,l=b.length;k<l;k++){f=a.uniforms[b[k][1]];if(!f)continue;c=b[k][0];e=c.type;d=c.value;if(e==="i")V.uniform1i(f,d);else if(e==="f")V.uniform1f(f,d);else if(e==="v2")V.uniform2f(f,d.x,d.y);else if(e==="v3")V.uniform3f(f,d.x,d.y,d.z);else if(e==="v4")V.uniform4f(f,d.x,d.y,d.z,d.w);else if(e==="c")V.uniform3f(f,d.r,d.g,d.b);else if(e==="iv1")V.uniform1iv(f,d);else if(e==="iv")V.uniform3iv(f,d);else if(e==="fv1")V.uniform1fv(f,d);else if(e==="fv")V.uniform3fv(f,d);else if(e==="v2v"){if(c._array===undefined)c._array=new Float32Array(2*d.length);for(i=0,j=d.length;i<j;i++){n=i*2;c._array[n]=d[i].x;c._array[n+1]=d[i].y;}V.uniform2fv(f,c._array);}else if(e==="v3v"){if(c._array===undefined)c._array=new Float32Array(3*d.length);for(i=0,j=d.length;i<j;i++){n=i*3;c._array[n]=d[i].x;c._array[n+1]=d[i].y;c._array[n+2]=d[i].z;}V.uniform3fv(f,c._array);}else if(e==="v4v"){if(c._array===undefined)c._array=new Float32Array(4*d.length);for(i=0,j=d.length;i<j;i++){n=i*4;c._array[n]=d[i].x;c._array[n+1]=d[i].y;c._array[n+2]=d[i].z;c._array[n+3]=d[i].w;}V.uniform4fv(f,c._array);}else if(e==="m4"){if(c._array===undefined)c._array=new Float32Array(16);d.flattenToArray(c._array);V.uniformMatrix4fv(f,false,c._array);}else if(e==="m4v"){if(c._array===undefined)c._array=new Float32Array(16*d.length);for(i=0,j=d.length;i<j;i++)d[i].flattenToArrayOffset(c._array,i*16);V.uniformMatrix4fv(f,false,c._array);}else if(e==="t"){g=d;h=bC();V.uniform1i(f,h);if(!g)continue;if(g.image instanceof Array&&g.image.length===6)bS(g,h);else if(g instanceof THREE.WebGLRenderTargetCube)bT(g,h);else m.setTexture(g,h);}else if(e==="tv"){if(c._array===undefined)c._array=[];for(i=0,j=c.value.length;i<j;i++)c._array[i]=bC();V.uniform1iv(f,c._array);for(i=0,j=c.value.length;i<j;i++){g=c.value[i];h=c._array[i];if(!g)continue;m.setTexture(g,h);}}else console.warn('THREE.WebGLRenderer: Unknown uniform type: '+e);}};function bE(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld);a._normalMatrix.getNormalMatrix(a._modelViewMatrix);};function bF(a,b,c,d){a[b]=c.r*c.r*d;a[b+1]=c.g*c.g*d;a[b+2]=c.b*c.b*d;};function bG(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d;};function bH(a,b){var c,d,e,f,g=0,h=0,i=0,j,k,l,n,o,p,q,r=U,s=r.directional.colors,t=r.directional.positions,u=r.point.colors,v=r.point.positions,w=r.point.distances,x=r.spot.colors,y=r.spot.positions,z=r.spot.distances,A=r.spot.directions,B=r.spot.anglesCos,C=r.spot.exponents,D=r.hemi.skyColors,E=r.hemi.groundColors,F=r.hemi.positions,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,T=0;for(c=0,d=b.length;c<d;c++){e=b[c];if(e.onlyShadow)continue;j=e.color;n=e.intensity;q=e.distance;if(e instanceof THREE.AmbientLight){if(!e.visible)continue;if(m.gammaInput){g+=j.r*j.r;h+=j.g*j.g;i+=j.b*j.b;}else{g+=j.r;h+=j.g;i+=j.b;}}else if(e instanceof THREE.DirectionalLight){K+=1;if(!e.visible)continue;S.setFromMatrixPosition(e.matrixWorld);R.setFromMatrixPosition(e.target.matrixWorld);S.sub(R);S.normalize();if(S.x===0&&S.y===0&&S.z===0)continue;O=G*3;t[O]=S.x;t[O+1]=S.y;t[O+2]=S.z;if(m.gammaInput)bF(s,O,j,n*n);else bG(s,O,j,n);G+=1;}else if(e instanceof THREE.PointLight){L+=1;if(!e.visible)continue;P=H*3;if(m.gammaInput)bF(u,P,j,n*n);else bG(u,P,j,n);R.setFromMatrixPosition(e.matrixWorld);v[P]=R.x;v[P+1]=R.y;v[P+2]=R.z;w[H]=q;H+=1;}else if(e instanceof THREE.SpotLight){M+=1;if(!e.visible)continue;Q=I*3;if(m.gammaInput)bF(x,Q,j,n*n);else bG(x,Q,j,n);R.setFromMatrixPosition(e.matrixWorld);y[Q]=R.x;y[Q+1]=R.y;y[Q+2]=R.z;z[I]=q;S.copy(R);R.setFromMatrixPosition(e.target.matrixWorld);S.sub(R);S.normalize();A[Q]=S.x;A[Q+1]=S.y;A[Q+2]=S.z;B[I]=Math.cos(e.angle);C[I]=e.exponent;I+=1;}else if(e instanceof THREE.HemisphereLight){N+=1;if(!e.visible)continue;S.setFromMatrixPosition(e.matrixWorld);S.normalize();if(S.x===0&&S.y===0&&S.z===0)continue;T=J*3;F[T]=S.x;F[T+1]=S.y;F[T+2]=S.z;k=e.color;l=e.groundColor;if(m.gammaInput){o=n*n;bF(D,T,k,o);bF(E,T,l,o);}else{bG(D,T,k,n);bG(E,T,l,n);}J+=1;}}for(c=G*3,d=Math.max(s.length,K*3);c<d;c++)s[c]=0.0;for(c=H*3,d=Math.max(u.length,L*3);c<d;c++)u[c]=0.0;for(c=I*3,d=Math.max(x.length,M*3);c<d;c++)x[c]=0.0;for(c=J*3,d=Math.max(D.length,N*3);c<d;c++)D[c]=0.0;for(c=J*3,d=Math.max(E.length,N*3);c<d;c++)E[c]=0.0;r.directional.length=G;r.point.length=H;r.spot.length=I;r.hemi.length=J;r.ambient[0]=g;r.ambient[1]=h;r.ambient[2]=i;};this.setFaceCulling=function(a,b){if(a===THREE.CullFaceNone)V.disable(V.CULL_FACE);else{if(b===THREE.FrontFaceDirectionCW)V.frontFace(V.CW);else V.frontFace(V.CCW);if(a===THREE.CullFaceBack)V.cullFace(V.BACK);else if(a===THREE.CullFaceFront)V.cullFace(V.FRONT);else V.cullFace(V.FRONT_AND_BACK);V.enable(V.CULL_FACE);}};this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;var c=a.side===THREE.BackSide;if(v!==b){if(b)V.disable(V.CULL_FACE);else V.enable(V.CULL_FACE);v=b;}if(w!==c){if(c)V.frontFace(V.CW);else V.frontFace(V.CCW);w=c;}};this.setDepthTest=function(a){if(B!==a){if(a)V.enable(V.DEPTH_TEST);else V.disable(V.DEPTH_TEST);B=a;}};this.setDepthWrite=function(a){if(C!==a){V.depthMask(a);C=a;}};function bI(a){if(a!==G){V.lineWidth(a);G=a;}};function bJ(a,b,c){if(D!==a){if(a)V.enable(V.POLYGON_OFFSET_FILL);else V.disable(V.POLYGON_OFFSET_FILL);D=a;}if(a&&(E!==b||F!==c)){V.polygonOffset(b,c);E=b;F=c;}};this.setBlending=function(a,b,c,d){if(a!==x){if(a===THREE.NoBlending)V.disable(V.BLEND);else if(a===THREE.AdditiveBlending){V.enable(V.BLEND);V.blendEquation(V.FUNC_ADD);V.blendFunc(V.SRC_ALPHA,V.ONE);}else if(a===THREE.SubtractiveBlending){V.enable(V.BLEND);V.blendEquation(V.FUNC_ADD);V.blendFunc(V.ZERO,V.ONE_MINUS_SRC_COLOR);}else if(a===THREE.MultiplyBlending){V.enable(V.BLEND);V.blendEquation(V.FUNC_ADD);V.blendFunc(V.ZERO,V.SRC_COLOR);}else if(a===THREE.CustomBlending)V.enable(V.BLEND);else{V.enable(V.BLEND);V.blendEquationSeparate(V.FUNC_ADD,V.FUNC_ADD);V.blendFuncSeparate(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA,V.ONE,V.ONE_MINUS_SRC_ALPHA);}x=a;}if(a===THREE.CustomBlending){if(b!==y){V.blendEquation(bY(b));y=b;}if(c!==z||d!==A){V.blendFunc(bY(c),bY(d));z=c;A=d;}}else{y=null;z=null;A=null;}};function bK(a){var b,c,d=[];for(var e in a){b=a[e];if(b===false)continue;c="#define "+e+" "+b;d.push(c);}return d.join("\n");};function bL(a,b,c,e,f,g,h,i){var j,k,l,p,q;var r=[];if(a)r.push(a);else{r.push(b);r.push(c);}for(l in g){r.push(l);r.push(g[l]);}for(j in h){r.push(j);r.push(h[j]);}q=r.join();for(j=0,k=n.length;j<k;j++){var s=n[j];if(s.code===q){s.usedTimes++;return s.program;}}var t="SHADOWMAP_TYPE_BASIC";if(h.shadowMapType===THREE.PCFShadowMap)t="SHADOWMAP_TYPE_PCF";else if(h.shadowMapType===THREE.PCFSoftShadowMap)t="SHADOWMAP_TYPE_PCF_SOFT";var u=bK(g);p=V.createProgram();var v=["precision "+d+" float;","precision "+d+" int;",u,af?"#define VERTEX_TEXTURES":"",m.gammaInput?"#define GAMMA_INPUT":"",m.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+t:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var w=["precision "+d+" float;","precision "+d+" int;",(h.bumpMap||h.normalMap)?"#extension GL_OES_standard_derivatives : enable":"",u,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",m.gammaInput?"#define GAMMA_INPUT":"",m.gammaOutput?"#define GAMMA_OUTPUT":"",(h.useFog&&h.fog)?"#define USE_FOG":"",(h.useFog&&h.fogExp)?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+t:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var x=bP("vertex",v+c);var y=bP("fragment",w+b);V.attachShader(p,x);V.attachShader(p,y);if(i!==undefined)V.bindAttribLocation(p,0,i);V.linkProgram(p);if(V.getProgramParameter(p,V.LINK_STATUS)===false){console.error('Could not initialise shader');console.error('gl.VALIDATE_STATUS',V.getProgramParameter(p,V.VALIDATE_STATUS));console.error('gl.getError()',V.getError());}if(V.getProgramInfoLog(p)!=='')console.error('gl.getProgramInfoLog()',V.getProgramInfoLog(p));V.deleteShader(y);V.deleteShader(x);p.uniforms={};p.attributes={};var z,A,B,C;z=['viewMatrix','modelViewMatrix','projectionMatrix','normalMatrix','modelMatrix','cameraPosition','morphTargetInfluences'];if(h.useVertexTexture){z.push('boneTexture');z.push('boneTextureWidth');z.push('boneTextureHeight');}else z.push('boneGlobalMatrices');for(A in e)z.push(A);bM(p,z);z=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(C=0;C<h.maxMorphTargets;C++)z.push("morphTarget"+C);for(C=0;C<h.maxMorphNormals;C++)z.push("morphNormal"+C);for(B in f)z.push(B);bN(p,z);p.id=o++;n.push({program:p,code:q,usedTimes:1});m.info.memory.programs=n.length;return p;};function bM(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++){e=b[c];a.uniforms[e]=V.getUniformLocation(a,e);}};function bN(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++){e=b[c];a.attributes[e]=V.getAttribLocation(a,e);}};function bO(a){var b=a.split("\n");for(var c=0,d=b.length;c<d;c++)b[c]=(c+1)+": "+b[c];return b.join("\n");};function bP(a,b){var c;if(a==="fragment")c=V.createShader(V.FRAGMENT_SHADER);else if(a==="vertex")c=V.createShader(V.VERTEX_SHADER);V.shaderSource(c,b);V.compileShader(c);if(!V.getShaderParameter(c,V.COMPILE_STATUS)){console.error(V.getShaderInfoLog(c));console.error(bO(b));return null;}return c;};function bQ(a,b,c){if(c){V.texParameteri(a,V.TEXTURE_WRAP_S,bY(b.wrapS));V.texParameteri(a,V.TEXTURE_WRAP_T,bY(b.wrapT));V.texParameteri(a,V.TEXTURE_MAG_FILTER,bY(b.magFilter));V.texParameteri(a,V.TEXTURE_MIN_FILTER,bY(b.minFilter));}else{V.texParameteri(a,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE);V.texParameteri(a,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE);V.texParameteri(a,V.TEXTURE_MAG_FILTER,bX(b.magFilter));V.texParameteri(a,V.TEXTURE_MIN_FILTER,bX(b.minFilter));}if(Z&&b.type!==THREE.FloatType)if(b.anisotropy>1||b.__oldAnisotropy){V.texParameterf(a,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,ae));b.__oldAnisotropy=b.anisotropy;}};this.setTexture=function(a,b){if(a.needsUpdate){if(!a.__webglInit){a.__webglInit=true;a.addEventListener('dispose',aA);a.__webglTexture=V.createTexture();m.info.memory.textures++;}V.activeTexture(V.TEXTURE0+b);V.bindTexture(V.TEXTURE_2D,a.__webglTexture);V.pixelStorei(V.UNPACK_FLIP_Y_WEBGL,a.flipY);V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);V.pixelStorei(V.UNPACK_ALIGNMENT,a.unpackAlignment);var c=a.image,d=THREE.Math.isPowerOfTwo(c.width)&&THREE.Math.isPowerOfTwo(c.height),e=bY(a.format),f=bY(a.type);bQ(V.TEXTURE_2D,a,d);var g,h=a.mipmaps;if(a instanceof THREE.DataTexture)if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++){g=h[i];V.texImage2D(V.TEXTURE_2D,i,e,g.width,g.height,0,e,f,g.data);}a.generateMipmaps=false;}else V.texImage2D(V.TEXTURE_2D,0,e,c.width,c.height,0,e,f,c.data);else if(a instanceof THREE.CompressedTexture)for(var i=0,j=h.length;i<j;i++){g=h[i];if(a.format!==THREE.RGBAFormat)V.compressedTexImage2D(V.TEXTURE_2D,i,e,g.width,g.height,0,g.data);else V.texImage2D(V.TEXTURE_2D,i,e,g.width,g.height,0,e,f,g.data);}else if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++){g=h[i];V.texImage2D(V.TEXTURE_2D,i,e,e,f,g);}a.generateMipmaps=false;}else V.texImage2D(V.TEXTURE_2D,0,e,e,f,a.image);if(a.generateMipmaps&&d)V.generateMipmap(V.TEXTURE_2D);a.needsUpdate=false;if(a.onUpdate)a.onUpdate();}else{V.activeTexture(V.TEXTURE0+b);V.bindTexture(V.TEXTURE_2D,a.__webglTexture);}};function bR(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height);var d=Math.floor(a.width*b/c);var e=Math.floor(a.height*b/c);var f=document.createElement('canvas');f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0,a.width,a.height,0,0,d,e);return f;}function bS(a,b){if(a.image.length===6)if(a.needsUpdate){if(!a.image.__webglTextureCube){a.addEventListener('dispose',aA);a.image.__webglTextureCube=V.createTexture();m.info.memory.textures++;}V.activeTexture(V.TEXTURE0+b);V.bindTexture(V.TEXTURE_CUBE_MAP,a.image.__webglTextureCube);V.pixelStorei(V.UNPACK_FLIP_Y_WEBGL,a.flipY);var c=a instanceof THREE.CompressedTexture;var d=[];for(var e=0;e<6;e++)if(m.autoScaleCubemaps&&!c)d[e]=bR(a.image[e],ad);else d[e]=a.image[e];var f=d[0],g=THREE.Math.isPowerOfTwo(f.width)&&THREE.Math.isPowerOfTwo(f.height),h=bY(a.format),i=bY(a.type);bQ(V.TEXTURE_CUBE_MAP,a,g);for(var e=0;e<6;e++)if(!c)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h,h,i,d[e]);else{var j,k=d[e].mipmaps;for(var l=0,n=k.length;l<n;l++){j=k[l];if(a.format!==THREE.RGBAFormat)V.compressedTexImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+e,l,h,j.width,j.height,0,j.data);else V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+e,l,h,j.width,j.height,0,h,i,j.data);}}if(a.generateMipmaps&&g)V.generateMipmap(V.TEXTURE_CUBE_MAP);a.needsUpdate=false;if(a.onUpdate)a.onUpdate();}else{V.activeTexture(V.TEXTURE0+b);V.bindTexture(V.TEXTURE_CUBE_MAP,a.image.__webglTextureCube);}};function bT(a,b){V.activeTexture(V.TEXTURE0+b);V.bindTexture(V.TEXTURE_CUBE_MAP,a.__webglTexture);};function bU(a,b,c){V.bindFramebuffer(V.FRAMEBUFFER,a);V.framebufferTexture2D(V.FRAMEBUFFER,V.COLOR_ATTACHMENT0,c,b.__webglTexture,0);};function bV(a,b){V.bindRenderbuffer(V.RENDERBUFFER,a);if(b.depthBuffer&&!b.stencilBuffer){V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_COMPONENT16,b.width,b.height);V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_ATTACHMENT,V.RENDERBUFFER,a);}else if(b.depthBuffer&&b.stencilBuffer){V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_STENCIL,b.width,b.height);V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_STENCIL_ATTACHMENT,V.RENDERBUFFER,a);}else V.renderbufferStorage(V.RENDERBUFFER,V.RGBA4,b.width,b.height);};this.setRenderTarget=function(a){var b=(a instanceof THREE.WebGLRenderTargetCube);if(a&&!a.__webglFramebuffer){if(a.depthBuffer===undefined)a.depthBuffer=true;if(a.stencilBuffer===undefined)a.stencilBuffer=true;a.addEventListener('dispose',aB);a.__webglTexture=V.createTexture();m.info.memory.textures++;var c=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),d=bY(a.format),e=bY(a.type);if(b){a.__webglFramebuffer=[];a.__webglRenderbuffer=[];V.bindTexture(V.TEXTURE_CUBE_MAP,a.__webglTexture);bQ(V.TEXTURE_CUBE_MAP,a,c);for(var f=0;f<6;f++){a.__webglFramebuffer[f]=V.createFramebuffer();a.__webglRenderbuffer[f]=V.createRenderbuffer();V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);bU(a.__webglFramebuffer[f],a,V.TEXTURE_CUBE_MAP_POSITIVE_X+f);bV(a.__webglRenderbuffer[f],a);}if(c)V.generateMipmap(V.TEXTURE_CUBE_MAP);}else{a.__webglFramebuffer=V.createFramebuffer();if(a.shareDepthFrom)a.__webglRenderbuffer=a.shareDepthFrom.__webglRenderbuffer;else a.__webglRenderbuffer=V.createRenderbuffer();V.bindTexture(V.TEXTURE_2D,a.__webglTexture);bQ(V.TEXTURE_2D,a,c);V.texImage2D(V.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null);bU(a.__webglFramebuffer,a,V.TEXTURE_2D);if(a.shareDepthFrom){if(a.depthBuffer&&!a.stencilBuffer)V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_ATTACHMENT,V.RENDERBUFFER,a.__webglRenderbuffer);else if(a.depthBuffer&&a.stencilBuffer)V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_STENCIL_ATTACHMENT,V.RENDERBUFFER,a.__webglRenderbuffer);}else bV(a.__webglRenderbuffer,a);if(c)V.generateMipmap(V.TEXTURE_2D);}if(b)V.bindTexture(V.TEXTURE_CUBE_MAP,null);else V.bindTexture(V.TEXTURE_2D,null);V.bindRenderbuffer(V.RENDERBUFFER,null);V.bindFramebuffer(V.FRAMEBUFFER,null);}var g,h,i,j,k;if(a){if(b)g=a.__webglFramebuffer[a.activeCubeFace];else g=a.__webglFramebuffer;h=a.width;i=a.height;j=0;k=0;}else{g=null;h=J;i=K;j=H;k=I;}if(g!==q){V.bindFramebuffer(V.FRAMEBUFFER,g);V.viewport(j,k,h,i);q=g;}L=h;M=i;};function bW(a){if(a instanceof THREE.WebGLRenderTargetCube){V.bindTexture(V.TEXTURE_CUBE_MAP,a.__webglTexture);V.generateMipmap(V.TEXTURE_CUBE_MAP);V.bindTexture(V.TEXTURE_CUBE_MAP,null);}else{V.bindTexture(V.TEXTURE_2D,a.__webglTexture);V.generateMipmap(V.TEXTURE_2D);V.bindTexture(V.TEXTURE_2D,null);}};function bX(a){if(a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter)return V.NEAREST;return V.LINEAR;};function bY(a){if(a===THREE.RepeatWrapping)return V.REPEAT;if(a===THREE.ClampToEdgeWrapping)return V.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return V.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return V.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return V.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return V.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return V.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return V.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return V.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return V.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return V.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return V.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return V.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return V.BYTE;if(a===THREE.ShortType)return V.SHORT;if(a===THREE.UnsignedShortType)return V.UNSIGNED_SHORT;if(a===THREE.IntType)return V.INT;if(a===THREE.UnsignedIntType)return V.UNSIGNED_INT;if(a===THREE.FloatType)return V.FLOAT;if(a===THREE.AlphaFormat)return V.ALPHA;if(a===THREE.RGBFormat)return V.RGB;if(a===THREE.RGBAFormat)return V.RGBA;if(a===THREE.LuminanceFormat)return V.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return V.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return V.FUNC_ADD;if(a===THREE.SubtractEquation)return V.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return V.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return V.ZERO;if(a===THREE.OneFactor)return V.ONE;if(a===THREE.SrcColorFactor)return V.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return V.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return V.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return V.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return V.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return V.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return V.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return V.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return V.SRC_ALPHA_SATURATE;if($!==undefined){if(a===THREE.RGB_S3TC_DXT1_Format)return $.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return $.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return $.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return $.COMPRESSED_RGBA_S3TC_DXT5_EXT;}return 0;};function bZ(a){if(ag&&a&&a.useVertexTexture)return 1024;else{var b=V.getParameter(V.MAX_VERTEX_UNIFORM_VECTORS);var c=Math.floor((b-20)/4);var d=c;if(a!==undefined&&a instanceof THREE.SkinnedMesh){d=Math.min(a.bones.length,d);if(d<a.bones.length)console.warn("WebGLRenderer: too many bones - "+a.bones.length+", this GPU supports just "+d+" (try OpenGL instead of ANGLE)");}return d;}};function b$(a){var b=0;var c=0;var d=0;var e=0;for(var f=0,g=a.length;f<g;f++){var h=a[f];if(h.onlyShadow||h.visible===false)continue;if(h instanceof THREE.DirectionalLight)b++;if(h instanceof THREE.PointLight)c++;if(h instanceof THREE.SpotLight)d++;if(h instanceof THREE.HemisphereLight)e++;}return{'directional':b,'point':c,'spot':d,'hemi':e};};function b_(a){var b=0;for(var c=0,d=a.length;c<d;c++){var e=a[c];if(!e.castShadow)continue;if(e instanceof THREE.SpotLight)b++;if(e instanceof THREE.DirectionalLight&&!e.shadowCascade)b++;}return b;};function cd(){try{var a={alpha:f,premultipliedAlpha:g,antialias:h,stencil:i,preserveDrawingBuffer:j};V=c||b.getContext('webgl',a)||b.getContext('experimental-webgl',a);if(V===null)throw 'Error creating WebGL context.';}catch(d){console.error(d);}W=V.getExtension('OES_texture_float');X=V.getExtension('OES_texture_float_linear');Y=V.getExtension('OES_standard_derivatives');Z=V.getExtension('EXT_texture_filter_anisotropic')||V.getExtension('MOZ_EXT_texture_filter_anisotropic')||V.getExtension('WEBKIT_EXT_texture_filter_anisotropic');$=V.getExtension('WEBGL_compressed_texture_s3tc')||V.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||V.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');if(!W)console.log('THREE.WebGLRenderer: Float textures not supported.');if(!Y)console.log('THREE.WebGLRenderer: Standard derivatives not supported.');if(!Z)console.log('THREE.WebGLRenderer: Anisotropic texture filtering not supported.');if(!$)console.log('THREE.WebGLRenderer: S3TC compressed textures not supported.');if(V.getShaderPrecisionFormat===undefined)V.getShaderPrecisionFormat=function(){return{"rangeMin":1,"rangeMax":1,"precision":1};};};function ce(){V.clearColor(0,0,0,1);V.clearDepth(1);V.clearStencil(0);V.enable(V.DEPTH_TEST);V.depthFunc(V.LEQUAL);V.frontFace(V.CCW);V.cullFace(V.BACK);V.enable(V.CULL_FACE);V.enable(V.BLEND);V.blendEquation(V.FUNC_ADD);V.blendFunc(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA);V.viewport(H,I,J,K);V.clearColor(k.r,k.g,k.b,l);};this.shadowMapPlugin=new THREE.ShadowMapPlugin();this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin());this.addPostPlugin(new THREE.LensFlarePlugin());};THREE.WebGLRenderTarget=function(a,b,c){this.width=a;this.height=b;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=c.anisotropy!==undefined?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==undefined?c.depthBuffer:true;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null;};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;a.shareDepthFrom=this.shareDepthFrom;return a;},dispose:function(){this.dispatchEvent({type:'dispose'});}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.position=new THREE.Vector3();this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true;};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen);};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.centroidModel=new THREE.Vector3();this.normalModel=new THREE.Vector3();this.vertexNormalsModel=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=null;this.material=null;this.uvs=[[]];this.z=0;};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0;};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2();this.material=null;};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.vertexColors=[new THREE.Color(),new THREE.Color()];this.material=null;this.z=0;};THREE.GeometryUtils={merge:function(a,b,c){var d,e,f=a.vertices.length,g=a.faceVertexUvs[0].length,h=b instanceof THREE.Mesh?b.geometry:b,i=a.vertices,j=h.vertices,k=a.faces,l=h.faces,m=a.faceVertexUvs[0],n=h.faceVertexUvs[0];if(c===undefined)c=0;if(b instanceof THREE.Mesh){b.matrixAutoUpdate&&b.updateMatrix();d=b.matrix;e=new THREE.Matrix3().getNormalMatrix(d);}for(var o=0,p=j.length;o<p;o++){var q=j[o];var r=q.clone();if(d)r.applyMatrix4(d);i.push(r);}for(o=0,p=l.length;o<p;o++){var s=l[o],t,u,v,w=s.vertexNormals,x=s.vertexColors;t=new THREE.Face3(s.a+f,s.b+f,s.c+f);t.normal.copy(s.normal);if(e)t.normal.applyMatrix3(e).normalize();for(var y=0,z=w.length;y<z;y++){u=w[y].clone();if(e)u.applyMatrix3(e).normalize();t.vertexNormals.push(u);}t.color.copy(s.color);for(var y=0,z=x.length;y<z;y++){v=x[y];t.vertexColors.push(v.clone());}t.materialIndex=s.materialIndex+c;t.centroid.copy(s.centroid);if(d)t.centroid.applyMatrix4(d);k.push(t);}for(o=0,p=n.length;o<p;o++){var A=n[o],B=[];for(var y=0,z=A.length;y<z;y++)B.push(new THREE.Vector2(A[y].x,A[y].y));m.push(B);}},randomPointInTriangle:function(){var a=new THREE.Vector3();return function(b,c,d){var e=new THREE.Vector3();var f=THREE.Math.random16();var g=THREE.Math.random16();if((f+g)>1){f=1-f;g=1-g;}var h=1-f-g;e.copy(b);e.multiplyScalar(f);a.copy(c);a.multiplyScalar(g);e.add(a);a.copy(d);a.multiplyScalar(h);e.add(a);return e;};}(),randomPointInFace:function(a,b,c){var d,e,f,g;d=b.vertices[a.a];e=b.vertices[a.b];f=b.vertices[a.c];return THREE.GeometryUtils.randomPointInTriangle(d,e,f);},randomPointsInGeometry:function(a,b){var c,d,e=a.faces,f=a.vertices,g=e.length,h=0,i=[],j,k,l,m;for(d=0;d<g;d++){c=e[d];j=f[c.a];k=f[c.b];l=f[c.c];c._area=THREE.GeometryUtils.triangleArea(j,k,l);h+=c._area;i[d]=h;}function n(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);if(i[e]>a)return b(c,e-1);else if(i[e]<a)return b(e+1,d);else return e;}var c=b(0,i.length-1);return c;}var o,p,q=[];var r={};for(d=0;d<b;d++){o=THREE.Math.random16()*h;p=n(o);q[d]=THREE.GeometryUtils.randomPointInFace(e[p],a,true);if(!r[p])r[p]=1;else r[p]+=1;}return q;},triangleArea:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(c,d,e){a.subVectors(d,c);b.subVectors(e,c);a.cross(b);return 0.5*a.length();};}(),center:function(a){a.computeBoundingBox();var b=a.boundingBox;var c=new THREE.Vector3();c.addVectors(b.min,b.max);c.multiplyScalar(-0.5);a.applyMatrix(new THREE.Matrix4().makeTranslation(c.x,c.y,c.z));a.computeBoundingBox();return c;},triangulateQuads:function(a){var b,c,d,e;var f=[];var g=[];for(b=0,c=a.faceVertexUvs.length;b<c;b++)g[b]=[];for(b=0,c=a.faces.length;b<c;b++){var h=a.faces[b];f.push(h);for(d=0,e=a.faceVertexUvs.length;d<e;d++)g[d].push(a.faceVertexUvs[d][b]);}a.faces=f;a.faceVertexUvs=g;a.computeCentroids();a.computeFaceNormals();a.computeVertexNormals();if(a.hasTangents)a.computeTangents();}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(a,b,c,d){var e=new THREE.ImageLoader();e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(undefined,b);var g=e.load(a,function(){f.needsUpdate=true;if(c)c(f);});f.image=g;f.sourceFile=a;return f;},loadCompressedTexture:function(a,b,c,d){var e=new THREE.CompressedTexture();e.mapping=b;var f=new XMLHttpRequest();f.onload=function(){var a=f.response;var b=THREE.ImageUtils.parseDDS(a,true);e.format=b.format;e.mipmaps=b.mipmaps;e.image.width=b.width;e.image.height=b.height;e.generateMipmaps=false;e.needsUpdate=true;if(c)c(e);};f.onerror=d;f.open('GET',a,true);f.responseType="arraybuffer";f.send(null);return e;},loadTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.Texture();f.image=e;if(b!==undefined)f.mapping=b;f.flipY=false;for(var g=0,h=a.length;g<h;++g){var i=new Image();e[g]=i;i.onload=function(){e.loadCount+=1;if(e.loadCount===6){f.needsUpdate=true;if(c)c(f);}};i.onerror=d;i.crossOrigin=this.crossOrigin;i.src=a[g];}return f;},loadCompressedTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture();f.image=e;if(b!==undefined)f.mapping=b;f.flipY=false;f.generateMipmaps=false;var g=function(a,b){return function(){var d=a.response;var g=THREE.ImageUtils.parseDDS(d,true);b.format=g.format;b.mipmaps=g.mipmaps;b.width=g.width;b.height=g.height;e.loadCount+=1;if(e.loadCount===6){f.format=g.format;f.needsUpdate=true;if(c)c(f);}};};if(a instanceof Array)for(var h=0,i=a.length;h<i;++h){var j={};e[h]=j;var k=new XMLHttpRequest();k.onload=g(k,j);k.onerror=d;var l=a[h];k.open('GET',l,true);k.responseType="arraybuffer";k.send(null);}else{var l=a;var k=new XMLHttpRequest();k.onload=function(){var a=k.response;var b=THREE.ImageUtils.parseDDS(a,true);if(b.isCubemap){var d=b.mipmaps.length/b.mipmapCount;for(var g=0;g<d;g++){e[g]={mipmaps:[]};for(var h=0;h<b.mipmapCount;h++){e[g].mipmaps.push(b.mipmaps[g*b.mipmapCount+h]);e[g].format=b.format;e[g].width=b.width;e[g].height=b.height;}}f.format=b.format;f.needsUpdate=true;if(c)c(f);}};k.onerror=d;k.open('GET',l,true);k.responseType="arraybuffer";k.send(null);}return f;},loadDDSTexture:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture();f.image=e;if(b!==undefined)f.mapping=b;f.flipY=false;f.generateMipmaps=false;{var g=new XMLHttpRequest();g.onload=function(){var a=g.response;var b=THREE.ImageUtils.parseDDS(a,true);if(b.isCubemap){var d=b.mipmaps.length/b.mipmapCount;for(var h=0;h<d;h++){e[h]={mipmaps:[]};for(var i=0;i<b.mipmapCount;i++){e[h].mipmaps.push(b.mipmaps[h*b.mipmapCount+i]);e[h].format=b.format;e[h].width=b.width;e[h].height=b.height;}}}else{f.image.width=b.width;f.image.height=b.height;f.mipmaps=b.mipmaps;}f.format=b.format;f.needsUpdate=true;if(c)c(f);};g.onerror=d;g.open('GET',a,true);g.responseType="arraybuffer";g.send(null);}return f;},parseDDS:function(a,b){var c={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var d=0x20534444;var e=0x1,f=0x2,g=0x4,h=0x8,i=0x1000,j=0x20000,k=0x80000,l=0x800000;var m=0x8,n=0x400000,o=0x1000;var p=0x200,q=0x400,r=0x800,s=0x1000,t=0x2000,u=0x4000,v=0x8000,w=0x200000;var x=0x1,y=0x2,z=0x4,A=0x40,B=0x200,C=0x20000;function D(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24);}function E(a){return String.fromCharCode(a&0xff,(a>>8)&0xff,(a>>16)&0xff,(a>>24)&0xff);}function F(a,b,c,d){var e=c*d*4;var f=new Uint8Array(a,b,e);var g=new Uint8Array(e);var h=0;var i=0;for(var j=0;j<d;j++)for(var k=0;k<c;k++){var l=f[i];i++;var m=f[i];i++;var n=f[i];i++;var o=f[i];i++;g[h]=n;h++;g[h]=m;h++;g[h]=l;h++;g[h]=o;h++;}return g;}var G=D("DXT1");var H=D("DXT3");var I=D("DXT5");var J=31;var K=0;var L=1;var M=2;var N=3;var O=4;var P=7;var Q=20;var R=21;var S=22;var T=23;var U=24;var V=25;var W=26;var X=27;var Y=28;var Z=29;var $=30;var _=new Int32Array(a,0,J);if(_[K]!==d){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return c;}if(!_[Q]&z){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return c;}var ab;var ac=_[R];var ad=false;switch(ac){case G:ab=8;c.format=THREE.RGB_S3TC_DXT1_Format;break;case H:ab=16;c.format=THREE.RGBA_S3TC_DXT3_Format;break;case I:ab=16;c.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(_[S]==32&&_[T]&0xff0000&&_[U]&0xff00&&_[V]&0xff&&_[W]&0xff000000){ad=true;ab=64;c.format=THREE.RGBAFormat;}else{console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",E(ac));return c;}}c.mipmapCount=1;if(_[M]&j&&b!==false)c.mipmapCount=Math.max(1,_[P]);c.isCubemap=_[Y]&p?true:false;c.width=_[O];c.height=_[N];var ae=_[L]+4;var af=c.width;var ag=c.height;var ah=c.isCubemap?6:1;for(var ai=0;ai<ah;ai++){for(var aj=0;aj<c.mipmapCount;aj++){if(ad){var ak=F(a,ae,af,ag);var al=ak.length;}else{var al=Math.max(4,af)/4*Math.max(4,ag)/4*ab;var ak=new Uint8Array(a,ae,al);}var am={"data":ak,"width":af,"height":ag};c.mipmaps.push(am);ae+=al;af=Math.max(af*0.5,1);ag=Math.max(ag*0.5,1);}af=c.width;ag=c.height;}return c;},getNormalMap:function(a,b){var c=function(a,b){return [a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];};var d=function(a,b){return [a[0]-b[0],a[1]-b[1],a[2]-b[2]];};var e=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return [a[0]/b,a[1]/b,a[2]/b];};b=b|1;var f=a.width;var g=a.height;var h=document.createElement('canvas');h.width=f;h.height=g;var i=h.getContext('2d');i.drawImage(a,0,0);var j=i.getImageData(0,0,f,g).data;var k=i.createImageData(f,g);var l=k.data;for(var m=0;m<f;m++)for(var n=0;n<g;n++){var o=n-1<0?0:n-1;var p=n+1>g-1?g-1:n+1;var q=m-1<0?0:m-1;var r=m+1>f-1?f-1:m+1;var s=[];var t=[0,0,j[(n*f+m)*4]/255*b];s.push([-1,0,j[(n*f+q)*4]/255*b]);s.push([-1,-1,j[(o*f+q)*4]/255*b]);s.push([0,-1,j[(o*f+m)*4]/255*b]);s.push([1,-1,j[(o*f+r)*4]/255*b]);s.push([1,0,j[(n*f+r)*4]/255*b]);s.push([1,1,j[(p*f+r)*4]/255*b]);s.push([0,1,j[(p*f+m)*4]/255*b]);s.push([-1,1,j[(p*f+q)*4]/255*b]);var u=[];var v=s.length;for(var w=0;w<v;w++){var x=s[w];var y=s[(w+1)%v];x=d(x,t);y=d(y,t);u.push(e(c(x,y)));}var z=[0,0,0];for(var w=0;w<u.length;w++){z[0]+=u[w][0];z[1]+=u[w][1];z[2]+=u[w][2];}z[0]/=u.length;z[1]/=u.length;z[2]/=u.length;var A=(n*f+m)*4;l[A]=((z[0]+1.0)/2.0*255)|0;l[A+1]=((z[1]+1.0)/2.0*255)|0;l[A+2]=(z[2]*255)|0;l[A+3]=255;}i.putImageData(k,0,0);return h;},generateDataTexture:function(a,b,c){var d=a*b;var e=new Uint8Array(3*d);var f=Math.floor(c.r*255);var g=Math.floor(c.g*255);var h=Math.floor(c.b*255);for(var i=0;i<d;i++){e[i*3]=f;e[i*3+1]=g;e[i*3+2]=h;}var j=new THREE.DataTexture(e,a,b,THREE.RGBFormat);j.needsUpdate=true;return j;}};THREE.SceneUtils={createMultiMaterialObject:function(a,b){var c=new THREE.Object3D();for(var d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c;},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a);},attach:function(a,b,c){var d=new THREE.Matrix4();d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a);}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style];},loadFace:function(a){var b=a.familyName.toLowerCase();var c=this;c.faces[b]=c.faces[b]||{};c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{};c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;var d=c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return a;},drawText:function(a){var b=[],c=[];var d,e,f=this.getFace(),g=this.size/f.resolution,h=0,i=String(a).split(''),j=i.length;var k=[];for(d=0;d<j;d++){var l=new THREE.Path();var m=this.extractGlyphPoints(i[d],f,g,h,l);h+=m.offset;k.push(m.path);}var n=h/2;return{paths:k,offset:n};},extractGlyphPoints:function(a,b,c,d,e){var f=[];var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=b.glyphs[a]||b.glyphs['?'];if(!z)return;if(z.o){j=z._cachedOutline||(z._cachedOutline=z.o.split(' '));l=j.length;m=c;n=c;for(g=0;g<l;){k=j[g++];switch(k){case 'm':o=j[g++]*m+d;p=j[g++]*n;e.moveTo(o,p);break;case 'l':o=j[g++]*m+d;p=j[g++]*n;e.lineTo(o,p);break;case 'q':q=j[g++]*m+d;r=j[g++]*n;u=j[g++]*m+d;v=j[g++]*n;e.quadraticCurveTo(u,v,q,r);y=f[f.length-1];if(y){s=y.x;t=y.y;for(h=1,i=this.divisions;h<=i;h++){var A=h/i;var B=THREE.Shape.Utils.b2(A,s,u,q);var C=THREE.Shape.Utils.b2(A,t,v,r);}}break;case 'b':q=j[g++]*m+d;r=j[g++]*n;u=j[g++]*m+d;v=j[g++]*-n;w=j[g++]*m+d;x=j[g++]*-n;e.bezierCurveTo(q,r,u,v,w,x);y=f[f.length-1];if(y){s=y.x;t=y.y;for(h=1,i=this.divisions;h<=i;h++){var A=h/i;var B=THREE.Shape.Utils.b3(A,s,u,w,q);var C=THREE.Shape.Utils.b3(A,t,v,x,r);}}break;}}}return{offset:z.ha*c,path:e};}};THREE.FontUtils.generateShapes=function(a,b){b=b||{};var c=b.size!==undefined?b.size:100;var d=b.curveSegments!==undefined?b.curveSegments:4;var e=b.font!==undefined?b.font:"helvetiker";var f=b.weight!==undefined?b.weight:"normal";var g=b.style!==undefined?b.style:"normal";THREE.FontUtils.size=c;THREE.FontUtils.divisions=d;THREE.FontUtils.face=e;THREE.FontUtils.weight=f;THREE.FontUtils.style=g;var h=THREE.FontUtils.drawText(a);var i=h.paths;var j=[];for(var k=0,l=i.length;k<l;k++)Array.prototype.push.apply(j,i[k].toShapes());return j;};(function(a){var b=0.0000000001;var c=function(a,b){var c=a.length;if(c<3)return null;var f=[],g=[],h=[];var i,j,k;if(d(a)>0.0)for(j=0;j<c;j++)g[j]=j;else for(j=0;j<c;j++)g[j]=(c-1)-j;var l=c;var m=2*l;for(j=l-1;l>2;){if((m--)<=0){console.log("Warning, unable to triangulate polygon!");if(b)return h;return f;}i=j;if(l<=i)i=0;j=i+1;if(l<=j)j=0;k=j+1;if(l<=k)k=0;if(e(a,i,j,k,l,g)){var n,o,p,q,r;n=g[i];o=g[j];p=g[k];f.push([a[n],a[o],a[p]]);h.push([g[i],g[j],g[k]]);for(q=j,r=j+1;r<l;q++,r++)g[q]=g[r];l--;m=2*l;}}if(b)return h;return f;};var d=function(a){var b=a.length;var c=0.0;for(var d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return c*0.5;};var e=function(a,c,d,e,f,g){var h;var i,j,k,l;var m,n,o,p;i=a[g[c]].x;j=a[g[c]].y;k=a[g[d]].x;l=a[g[d]].y;m=a[g[e]].x;n=a[g[e]].y;if(b>(((k-i)*(n-j))-((l-j)*(m-i))))return false;var q,r,s,t,u,v;var w,x,y,z,A,B;var C,D,E;q=m-k;r=n-l;s=i-m;t=j-n;u=k-i;v=l-j;for(h=0;h<f;h++){o=a[g[h]].x;p=a[g[h]].y;if(((o===i)&&(p===j))||((o===k)&&(p===l))||((o===m)&&(p===n)))continue;w=o-i;x=p-j;y=o-k;z=p-l;A=o-m;B=p-n;E=q*z-r*y;C=u*x-v*w;D=s*B-t*A;if((E>=-b)&&(D>=-b)&&(C>=-b))return false;}return true;};a.Triangulate=c;a.Triangulate.area=d;return a;})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null;};THREE.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b);};THREE.Curve.prototype.getPoints=function(a){if(!a)a=5;var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c;};THREE.Curve.prototype.getSpacedPoints=function(a){if(!a)a=5;var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c;};THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1];};THREE.Curve.prototype.getLengths=function(a){if(!a)a=(this.__arcLengthDivisions)?(this.__arcLengthDivisions):200;if(this.cacheArcLengths&&(this.cacheArcLengths.length==a+1)&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=false;var b=[];var c,d=this.getPoint(0);var e,f=0;b.push(0);for(e=1;e<=a;e++){c=this.getPoint(e/a);f+=c.distanceTo(d);b.push(f);d=c;}this.cacheArcLengths=b;return b;};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths();};THREE.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths();var d=0,e=c.length;var f;if(b)f=b;else f=a*c[e-1];var g=0,h=e-1,i;while(g<=h){d=Math.floor(g+(h-g)/2);i=c[d]-f;if(i<0){g=d+1;continue;}else if(i>0){h=d-1;continue;}else{h=d;break;}}d=h;if(c[d]==f){var j=d/(e-1);return j;}var k=c[d];var l=c[d+1];var m=l-k;var n=(f-k)/m;var j=(d+n)/(e-1);return j;};THREE.Curve.prototype.getTangent=function(a){var b=0.0001;var c=a-b;var d=a+b;if(c<0)c=0;if(d>1)d=1;var e=this.getPoint(c);var f=this.getPoint(d);var g=f.clone().sub(e);return g.normalize();};THREE.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b);};THREE.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c);},tangentCubicBezier:function(a,b,c,d,e){return -3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e;},tangentSpline:function(a,b,c,d,e){var f=6*a*a-6*a;var g=3*a*a-4*a+1;var h=-6*a*a+6*a;var i=3*a*a-2*a;return f+g+h+i;},interpolate:function(a,b,c,d,e){var f=(c-a)*0.5;var g=(d-b)*0.5;var h=e*e;var i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b;}};THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a;};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false;};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a);};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0);var b=this.curves[this.curves.length-1].getPoint(1);if(!a.equals(b))this.curves.push(new THREE.LineCurve(b,a));};THREE.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength();var c=this.getCurveLengths();var d=0,e,f;while(d<c.length){if(c[d]>=b){e=c[d]-b;f=this.curves[d];var g=1-e/f.getLength();return f.getPointAt(g);break;}d++;}return null;};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1];};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;;var a=[],b=0;var c,d=this.curves.length;for(c=0;c<d;c++){b+=this.curves[c].getLength();a.push(b);}this.cacheLengths=a;return a;};THREE.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints();var b,c,d;var e,f,g;b=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,i,j,k;var l=a[0] instanceof THREE.Vector3;k=l?new THREE.Vector3():new THREE.Vector2();for(i=0,j=a.length;i<j;i++){h=a[i];if(h.x>b)b=h.x;else if(h.x<e)e=h.x;if(h.y>c)c=h.y;else if(h.y<f)f=h.y;if(l)if(h.z>d)d=h.z;else if(h.z<g)g=h.z;k.add(h);}var m={minX:e,minY:f,maxX:b,maxY:c,centroid:k.divideScalar(j)};if(l){m.maxZ=d;m.minZ=g;}return m;};THREE.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,true);return this.createGeometry(b);};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,true);return this.createGeometry(b);};THREE.CurvePath.prototype.createGeometry=function(a){var b=new THREE.Geometry();for(var c=0;c<a.length;c++)b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z||0));return b;};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a);};THREE.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a);var d,e;if(!b)b=this.bends;for(d=0,e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c;};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a);var d,e;if(!b)b=this.bends;for(d=0,e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c;};THREE.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox();var d,e,f,g,h,i;for(d=0,e=a.length;d<e;d++){f=a[d];g=f.x;h=f.y;i=g/c.maxX;i=b.getUtoTmapping(i,g);var j=b.getPoint(i);var k=b.getTangent(i);k.set(-k.y,k.x).multiplyScalar(h);f.x=j.x+k.x;f.y=j.y+k.y;}return a;};THREE.Gyroscope=function(){THREE.Object3D.call(this);};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld);}else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;a=true;}for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a);};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3();THREE.Gyroscope.prototype.translationObject=new THREE.Vector3();THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion();THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion();THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3();THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3();THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];if(a)this.fromPoints(a);};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:'moveTo',LINE_TO:'lineTo',QUADRATIC_CURVE_TO:'quadraticCurveTo',BEZIER_CURVE_TO:'bezierCurveTo',CSPLINE_THRU:'splineThru',ARC:'arc',ELLIPSE:'ellipse'};THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y);;};THREE.Path.prototype.moveTo=function(a,b){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c});};THREE.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments);var d=this.actions[this.actions.length-1].args;var e=d[d.length-2];var f=d[d.length-1];var g=new THREE.LineCurve(new THREE.Vector2(e,f),new THREE.Vector2(a,b));this.curves.push(g);this.actions.push({action:THREE.PathActions.LINE_TO,args:c});};THREE.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments);var f=this.actions[this.actions.length-1].args;var g=f[f.length-2];var h=f[f.length-1];var i=new THREE.QuadraticBezierCurve(new THREE.Vector2(g,h),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(i);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e});};THREE.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments);var h=this.actions[this.actions.length-1].args;var i=h[h.length-2];var j=h[h.length-1];var k=new THREE.CubicBezierCurve(new THREE.Vector2(i,j),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(k);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g});};THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments);var c=this.actions[this.actions.length-1].args;var d=c[c.length-2];var e=c[c.length-1];var f=[new THREE.Vector2(d,e)];Array.prototype.push.apply(f,a);var g=new THREE.SplineCurve(f);this.curves.push(g);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:b});};THREE.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args;var h=g[g.length-2];var i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f);};THREE.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f);};THREE.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;var i=h[h.length-2];var j=h[h.length-1];this.absellipse(a+i,b+j,c,d,e,f,g);};THREE.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments);var i=new THREE.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(i);var j=i.getPoint(1);h.push(j.x);h.push(j.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h});};THREE.Path.prototype.getSpacedPoints=function(a,b){if(!a)a=40;var c=[];for(var d=0;d<a;d++)c.push(this.getPoint(d/a));return c;};THREE.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints){console.log('tata');return this.getSpacedPoints(a,b);}a=a||12;var c=[];var d,e,f,g,h;var i,j,k,l,m,n,o,p,q,r,s,t,u;for(d=0,e=this.actions.length;d<e;d++){f=this.actions[d];g=f.action;h=f.args;switch(g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(h[0],h[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(h[0],h[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:i=h[2];j=h[3];m=h[0];n=h[1];if(c.length>0){q=c[c.length-1];o=q.x;p=q.y;}else{q=this.actions[d-1].args;o=q[q.length-2];p=q[q.length-1];}for(r=1;r<=a;r++){s=r/a;t=THREE.Shape.Utils.b2(s,o,m,i);u=THREE.Shape.Utils.b2(s,p,n,j);c.push(new THREE.Vector2(t,u));}break;case THREE.PathActions.BEZIER_CURVE_TO:i=h[4];j=h[5];m=h[0];n=h[1];k=h[2];l=h[3];if(c.length>0){q=c[c.length-1];o=q.x;p=q.y;}else{q=this.actions[d-1].args;o=q[q.length-2];p=q[q.length-1];}for(r=1;r<=a;r++){s=r/a;t=THREE.Shape.Utils.b3(s,o,m,k,i);u=THREE.Shape.Utils.b3(s,p,n,l,j);c.push(new THREE.Vector2(t,u));}break;case THREE.PathActions.CSPLINE_THRU:q=this.actions[d-1].args;var v=new THREE.Vector2(q[q.length-2],q[q.length-1]);var w=[v];var x=a*h[0].length;w=w.concat(h[0]);var y=new THREE.SplineCurve(w);for(r=1;r<=x;r++)c.push(y.getPointAt(r/x));break;case THREE.PathActions.ARC:var z=h[0],A=h[1],B=h[2],C=h[3],D=h[4],E=!!h[5];var F=D-C;var G;var H=a*2;for(r=1;r<=H;r++){s=r/H;if(!E)s=1-s;G=C+s*F;t=z+B*Math.cos(G);u=A+B*Math.sin(G);c.push(new THREE.Vector2(t,u));}break;case THREE.PathActions.ELLIPSE:var z=h[0],A=h[1],I=h[2],J=h[3],C=h[4],D=h[5],E=!!h[6];var F=D-C;var G;var H=a*2;for(r=1;r<=H;r++){s=r/H;if(!E)s=1-s;G=C+s*F;t=z+I*Math.cos(G);u=A+J*Math.sin(G);c.push(new THREE.Vector2(t,u));}break;}}var K=c[c.length-1];var L=0.0000000001;if(Math.abs(K.x-c[0].x)<L&&Math.abs(K.y-c[0].y)<L)c.splice(c.length-1,1);if(b)c.push(c[0]);return c;};THREE.Path.prototype.toShapes=function(a){function b(a,b){var c=0.0000000001;var d=b.length;var e=false;for(var f=d-1,g=0;g<d;f=g++){var h=b[f];var i=b[g];var j=i.x-h.x;var k=i.y-h.y;if(Math.abs(k)>c){if(k<0){h=b[g];j=-j;i=b[f];k=-k;}if((a.y<h.y)||(a.y>i.y))continue;if(a.y==h.y){if(a.x==h.x)return true;}else{var l=k*(a.x-h.x)-j*(a.y-h.y);if(l==0)return true;if(l<0)continue;e=!e;}}else{if(a.y!=h.y)continue;if(((i.x<=a.x)&&(a.x<=h.x))||((h.x<=a.x)&&(a.x<=i.x)))return true;}}return e;}var c,d,e,f,g;var h=[],i=new THREE.Path();for(c=0,d=this.actions.length;c<d;c++){e=this.actions[c];g=e.args;f=e.action;if(f==THREE.PathActions.MOVE_TO)if(i.actions.length!=0){h.push(i);i=new THREE.Path();}i[f].apply(i,g);}if(i.actions.length!=0)h.push(i);if(h.length==0)return [];var j,k,l,m=[];if(h.length==1){k=h[0];l=new THREE.Shape();l.actions=k.actions;l.curves=k.curves;m.push(l);return m;}var n=!THREE.Shape.Utils.isClockWise(h[0].getPoints());n=a?!n:n;var o=[];var p=[];var q=[];var r=0;var s;p[r]=undefined;q[r]=[];for(c=0,d=h.length;c<d;c++){k=h[c];s=k.getPoints();j=THREE.Shape.Utils.isClockWise(s);j=a?!j:j;if(j){if((!n)&&p[r])r++;p[r]={s:new THREE.Shape(),p:s};p[r].s.actions=k.actions;p[r].s.curves=k.curves;if(n)r++;q[r]=[];}else q[r].push({h:k,p:s[0]});}if(p.length>1){var t=false;var u=[];for(var v=0,w=p.length;v<w;v++)o[v]=[];for(var v=0,w=p.length;v<w;v++){var x=p[v];var y=q[v];for(var z=0;z<y.length;z++){var A=y[z];var B=true;for(var C=0;C<p.length;C++)if(b(A.p,p[C].p)){if(v!=C)u.push({froms:v,tos:C,hole:z});if(B){B=false;o[C].push(A);}else t=true;}if(B)o[v].push(A);}}if(u.length>0)if(!t)q=o;}var D,E,F;for(c=0,d=p.length;c<d;c++){l=p[c].s;m.push(l);D=q[c];for(E=0,F=D.length;E<F;E++)l.holes.push(D[E].h);}return m;};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[];};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(a){var b=new THREE.ExtrudeGeometry(this,a);return b;};THREE.Shape.prototype.makeGeometry=function(a){var b=new THREE.ShapeGeometry(this,a);return b;};THREE.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d;};THREE.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d;};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)};};THREE.Shape.prototype.extractPoints=function(a){if(this.useSpacedPoints)return this.extractAllSpacedPoints(a);return this.extractAllPoints(a);};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)};};THREE.Shape.Utils={triangulateShape:function(a,b){function c(a,b,c){if(a.x!=b.x)if(a.x<b.x)return((a.x<=c.x)&&(c.x<=b.x));else return((b.x<=c.x)&&(c.x<=a.x));else if(a.y<b.y)return((a.y<=c.y)&&(c.y<=b.y));else return((b.y<=c.y)&&(c.y<=a.y));}function d(a,b,d,e,f){var g=0.0000000001;var h=b.x-a.x,i=b.y-a.y;var j=e.x-d.x,k=e.y-d.y;var l=a.x-d.x;var m=a.y-d.y;var n=i*j-h*k;var o=i*l-h*m;if(Math.abs(n)>g){var p;if(n>0){if((o<0)||(o>n))return [];p=k*l-j*m;if((p<0)||(p>n))return [];}else{if((o>0)||(o<n))return [];p=k*l-j*m;if((p>0)||(p<n))return [];}if(p==0){if(f&&((o==0)||(o==n)))return [];return [a];}if(p==n){if(f&&((o==0)||(o==n)))return [];return [b];}if(o==0)return [d];if(o==n)return [e];var q=p/n;return [{x:a.x+q*h,y:a.y+q*i}];}else{if((o!=0)||(k*l!=j*m))return [];var r=((h==0)&&(i==0));var s=((j==0)&&(k==0));if(r&&s){if((a.x!=d.x)||(a.y!=d.y))return [];return [a];}if(r){if(!c(d,e,a))return [];return [a];}if(s){if(!c(a,b,d))return [];return [d];}var t,u,v,w;var x,y,z,A;if(h!=0){if(a.x<b.x){t=a;v=a.x;u=b;w=b.x;}else{t=b;v=b.x;u=a;w=a.x;}if(d.x<e.x){x=d;z=d.x;y=e;A=e.x;}else{x=e;z=e.x;y=d;A=d.x;}}else{if(a.y<b.y){t=a;v=a.y;u=b;w=b.y;}else{t=b;v=b.y;u=a;w=a.y;}if(d.y<e.y){x=d;z=d.y;y=e;A=e.y;}else{x=e;z=e.y;y=d;A=d.y;}}if(v<=z){if(w<z)return [];if(w==z){if(f)return [];return [x];}if(w<=A)return [x,u];return [x,y];}else{if(v>A)return [];if(v==A){if(f)return [];return [t];}if(w<=A)return [t,u];return [t,y];}}}function e(a,b,c,d){var e=0.0000000001;var f=b.x-a.x,g=b.y-a.y;var h=c.x-a.x,i=c.y-a.y;var j=d.x-a.x,k=d.y-a.y;var l=f*i-g*h;var m=f*k-g*j;if(Math.abs(l)>e){var n=j*i-k*h;if(l>0)return((m>=0)&&(n>=0));else return((m>=0)||(n>=0));}else return(m>0);}function f(a,b){var c=a.concat();var f;function g(a,b){var d=c.length-1;var g=a-1;if(g<0)g=d;var h=a+1;if(h>d)h=0;var i=e(c[a],c[g],c[h],f[b]);if(!i)return false;var j=f.length-1;var k=b-1;if(k<0)k=j;var l=b+1;if(l>j)l=0;i=e(f[b],f[k],f[l],c[a]);if(!i)return false;return true;}function h(a,b){var e,f,g;for(e=0;e<c.length;e++){f=e+1;f%=c.length;g=d(a,b,c[e],c[f],true);if(g.length>0)return true;}return false;}var i=[];function j(a,c){var e,f,g,h,j;for(e=0;e<i.length;e++){f=b[i[e]];for(g=0;g<f.length;g++){h=g+1;h%=f.length;j=d(a,c,f[g],f[h],true);if(j.length>0)return true;}}return false;}var k,l,m,n,o,p,q=[],r,s,t,u;for(var v=0,w=b.length;v<w;v++)i.push(v);var x=i.length*2;while(i.length>0){x--;if(x<0){console.log("Infinite Loop! Holes left:"+i.length+", Probably Hole outside Shape!");break;}for(l=0;l<c.length;l++){m=c[l];k=-1;for(var v=0;v<i.length;v++){o=i[v];p=m.x+":"+m.y+":"+o;if(q[p]!==undefined)continue;f=b[o];for(var y=0;y<f.length;y++){n=f[y];if(!g(l,y))continue;if(h(m,n))continue;if(j(m,n))continue;k=y;i.splice(v,1);r=c.slice(0,l+1);s=c.slice(l);t=f.slice(k);u=f.slice(0,k+1);c=r.concat(t).concat(u).concat(s);break;}if(k>=0)break;q[p]=true;}if(k>=0)break;}}return c;}var g,h,i,j,k,l,m={};var n=a.concat();for(var o=0,p=b.length;o<p;o++)Array.prototype.push.apply(n,b[o]);for(g=0,h=n.length;g<h;g++){k=n[g].x+":"+n[g].y;if(m[k]!==undefined)console.log("Duplicate point",k);m[k]=g;}var q=f(a,b);var r=THREE.FontUtils.Triangulate(q,false);for(g=0,h=r.length;g<h;g++){j=r[g];for(i=0;i<3;i++){k=j[i].x+":"+j[i].y;l=m[k];if(l!==undefined)j[i]=l;}}return r.concat();},isClockWise:function(a){return THREE.FontUtils.Triangulate.area(a)<0;},b2p0:function(a,b){var c=1-a;return c*c*b;},b2p1:function(a,b){return 2*(1-a)*a*b;},b2p2:function(a,b){return a*a*b;},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d);},b3p0:function(a,b){var c=1-a;return c*c*c*b;},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b;},b3p2:function(a,b){var c=1-a;return 3*c*a*a*b;},b3p3:function(a,b){return a*a*a*b;},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e);}};THREE.LineCurve=function(a,b){this.v1=a;this.v2=b;};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b;};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a);};THREE.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().sub(this.v1);return b.normalize();};THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b,c;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(b,c);};THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b,c;b=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);var d=new THREE.Vector2(b,c);d.normalize();return d;};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d;};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(a){var b,c;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,c);};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b,c;b=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var d=new THREE.Vector2(b,c);d.normalize();return d;};THREE.SplineCurve=function(a){this.points=(a==undefined)?[]:a;};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(a){var b=new THREE.Vector2();var c=[];var d=this.points,e,f,g;e=(d.length-1)*a;f=Math.floor(e);g=e-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>d.length-2?d.length-1:f+1;c[3]=f>d.length-3?d.length-1:f+2;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,g);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,g);return b;};THREE.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(a){var b;var c=this.aEndAngle-this.aStartAngle;if(c<0)c+=Math.PI*2;if(c>Math.PI*2)c-=Math.PI*2;if(this.aClockwise===true)b=this.aEndAngle+(1-a)*(Math.PI*2-c);else b=this.aStartAngle+a*c;var d=this.aX+this.xRadius*Math.cos(b);var e=this.aY+this.yRadius*Math.sin(b);return new THREE.Vector2(d,e);};THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f);};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b;},function(a){var b=new THREE.Vector3();b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b;});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c;},function(a){var b,c,d;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);d=THREE.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(b,c,d);});THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d;},function(a){var b,c,d;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);d=THREE.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(b,c,d);});THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a;},function(a){var b=new THREE.Vector3();var c=[];var d=this.points,e,f,g;e=(d.length-1)*a;f=Math.floor(e);g=e-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>d.length-2?d.length-1:f+1;c[3]=f>d.length-3?d.length-1:f+2;var h=d[c[0]],i=d[c[1]],j=d[c[2]],k=d[c[3]];b.x=THREE.Curve.Utils.interpolate(h.x,i.x,j.x,k.x,g);b.y=THREE.Curve.Utils.interpolate(h.y,i.y,j.y,k.y,g);b.z=THREE.Curve.Utils.interpolate(h.z,i.z,j.z,k.z,g);return b;});THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a;},function(a){var b=new THREE.Vector3();var c=[];var d=this.points,e,f,g;e=(d.length-0)*a;f=Math.floor(e);g=e-f;f+=f>0?0:(Math.floor(Math.abs(f)/d.length)+1)*d.length;c[0]=(f-1)%d.length;c[1]=f%d.length;c[2]=(f+1)%d.length;c[3]=(f+2)%d.length;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,g);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,g);b.z=THREE.Curve.Utils.interpolate(d[c[0]].z,d[c[1]].z,d[c[2]].z,d[c[3]].z,g);return b;});THREE.AnimationHandler=(function(){var a=[];var b={};var c={};c.update=function(b){for(var c=0;c<a.length;c++)a[c].update(b);};c.addToUpdate=function(b){if(a.indexOf(b)===-1)a.push(b);};c.removeFromUpdate=function(b){var c=a.indexOf(b);if(c!==-1)a.splice(c,1);};c.add=function(a){if(b[a.name]!==undefined)console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting.");b[a.name]=a;e(a);};c.get=function(a){if(typeof a==="string")if(b[a])return b[a];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+a);return null;}else{}};c.parse=function(a){var b=[];if(a instanceof THREE.SkinnedMesh)for(var c=0;c<a.bones.length;c++)b.push(a.bones[c]);else d(a,b);return b;};var d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b);};var e=function(a){if(a.initialized===true)return;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++){if(a.hierarchy[b].keys[c].time<0)a.hierarchy[b].keys[c].time=0;if(a.hierarchy[b].keys[c].rot!==undefined&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;a.hierarchy[b].keys[c].rot=new THREE.Quaternion(d[0],d[1],d[2],d[3]);}}if(a.hierarchy[b].keys.length&&a.hierarchy[b].keys[0].morphTargets!==undefined){var e={};for(var c=0;c<a.hierarchy[b].keys.length;c++)for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++){var g=a.hierarchy[b].keys[c].morphTargets[f];e[g]=-1;}a.hierarchy[b].usedMorphTargets=e;for(var c=0;c<a.hierarchy[b].keys.length;c++){var h={};for(var g in e){for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++)if(a.hierarchy[b].keys[c].morphTargets[f]===g){h[g]=a.hierarchy[b].keys[c].morphTargetsInfluences[f];break;}if(f===a.hierarchy[b].keys[c].morphTargets.length)h[g]=0;}a.hierarchy[b].keys[c].morphTargetsInfluences=h;}}for(var c=1;c<a.hierarchy[b].keys.length;c++)if(a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time){a.hierarchy[b].keys.splice(c,1);c--;}for(var c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c;}a.initialized=true;};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c;}());THREE.Animation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=THREE.AnimationHandler.LINEAR;};THREE.Animation.prototype.play=function(a){this.currentTime=a!==undefined?a:0;if(this.isPlaying===false){this.isPlaying=true;this.reset();this.update(0);}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this);};THREE.Animation.prototype.pause=function(){if(this.isPaused===true)THREE.AnimationHandler.addToUpdate(this);else THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused;};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);};THREE.Animation.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];c.matrixAutoUpdate=true;if(c.animationCache===undefined){c.animationCache={};c.animationCache.prevKey={pos:0,rot:0,scl:0};c.animationCache.nextKey={pos:0,rot:0,scl:0};c.animationCache.originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix;}var d=c.animationCache.prevKey;var e=c.animationCache.nextKey;d.pos=this.data.hierarchy[a].keys[0];d.rot=this.data.hierarchy[a].keys[0];d.scl=this.data.hierarchy[a].keys[0];e.pos=this.getNextKeyWith("pos",a,1);e.rot=this.getNextKeyWith("rot",a,1);e.scl=this.getNextKeyWith("scl",a,1);}};THREE.Animation.prototype.update=(function(){var a=[];var b=new THREE.Vector3();var c=function(a,b){var c=[],e=[],f,g,h,i,j,k,l,m,n;f=(a.length-1)*b;g=Math.floor(f);h=f-g;c[0]=g===0?g:g-1;c[1]=g;c[2]=g>a.length-2?g:g+1;c[3]=g>a.length-3?g:g+2;k=a[c[0]];l=a[c[1]];m=a[c[2]];n=a[c[3]];i=h*h;j=h*i;e[0]=d(k[0],l[0],m[0],n[0],h,i,j);e[1]=d(k[1],l[1],m[1],n[1],h,i,j);e[2]=d(k[2],l[2],m[2],n[2],h,i,j);return e;};var d=function(a,b,c,d,e,f,g){var h=(c-a)*0.5,i=(d-b)*0.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b;};return function(d){if(this.isPlaying===false)return;this.currentTime+=d*this.timeScale;var e;var f=["pos","rot","scl"];var g=this.data.length;if(this.loop===true&&this.currentTime>g){this.currentTime%=g;this.reset();}else if(this.loop===false&&this.currentTime>g){this.stop();return;}this.currentTime=Math.min(this.currentTime,g);for(var h=0,i=this.hierarchy.length;h<i;h++){var j=this.hierarchy[h];var k=j.animationCache;for(var l=0;l<3;l++){var m=f[l];var n=k.prevKey[m];var o=k.nextKey[m];if(o.time<=this.currentTime){n=this.data.hierarchy[h].keys[0];o=this.getNextKeyWith(m,h,1);while(o.time<this.currentTime&&o.index>n.index){n=o;o=this.getNextKeyWith(m,h,o.index+1);}k.prevKey[m]=n;k.nextKey[m]=o;}j.matrixAutoUpdate=true;j.matrixWorldNeedsUpdate=true;var p=(this.currentTime-n.time)/(o.time-n.time);var q=n[m];var r=o[m];if(p<0)p=0;if(p>1)p=1;if(m==="pos"){e=j.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){e.x=q[0]+(r[0]-q[0])*p;e.y=q[1]+(r[1]-q[1])*p;e.z=q[2]+(r[2]-q[2])*p;}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){a[0]=this.getPrevKeyWith("pos",h,n.index-1).pos;a[1]=q;a[2]=r;a[3]=this.getNextKeyWith("pos",h,o.index+1).pos;p=p*0.33+0.33;var s=c(a,p);e.x=s[0];e.y=s[1];e.z=s[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var t=c(a,p*1.01);b.set(t[0],t[1],t[2]);b.sub(e);b.y=0;b.normalize();var u=Math.atan2(b.x,b.z);j.rotation.set(0,u,0);}}}else if(m==="rot")THREE.Quaternion.slerp(q,r,j.quaternion,p);else if(m==="scl"){e=j.scale;e.x=q[0]+(r[0]-q[0])*p;e.y=q[1]+(r[1]-q[1])*p;e.z=q[2]+(r[2]-q[2])*p;}}}};})();THREE.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c=c%d.length;for(;c<d.length;c++)if(d[c][a]!==undefined)return d[c];return this.data.hierarchy[b].keys[0];};THREE.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c>0?c:0;else c=c>=0?c:c+d.length;for(;c>=0;c--)if(d[c][a]!==undefined)return d[c];return this.data.hierarchy[b].keys[d.length-1];};THREE.KeyFrameAnimation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=0.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var c=0,d=this.hierarchy.length;c<d;c++){var e=this.data.hierarchy[c].keys,f=this.data.hierarchy[c].sids,g=this.hierarchy[c];if(e.length&&f){for(var h=0;h<f.length;h++){var i=f[h],j=this.getNextKeyWith(i,c,0);if(j)j.apply(i);}g.matrixAutoUpdate=false;this.data.hierarchy[c].node.updateMatrix();g.matrixWorldNeedsUpdate=true;}}};THREE.KeyFrameAnimation.prototype.play=function(a){this.currentTime=a!==undefined?a:0;if(this.isPlaying===false){this.isPlaying=true;var b,c=this.hierarchy.length,d,e;for(b=0;b<c;b++){d=this.hierarchy[b];e=this.data.hierarchy[b];if(e.animationCache===undefined){e.animationCache={};e.animationCache.prevKey=null;e.animationCache.nextKey=null;e.animationCache.originalMatrix=d instanceof THREE.Bone?d.skinMatrix:d.matrix;}var f=this.data.hierarchy[b].keys;if(f.length){e.animationCache.prevKey=f[0];e.animationCache.nextKey=f[1];this.startTime=Math.min(f[0].time,this.startTime);this.endTime=Math.max(f[f.length-1].time,this.endTime);}}this.update(0);}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this);};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused)THREE.AnimationHandler.addToUpdate(this);else THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused;};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a];var c=this.data.hierarchy[a];if(c.animationCache!==undefined){var d=c.animationCache.originalMatrix;if(b instanceof THREE.Bone){d.copy(b.skinMatrix);b.skinMatrix=d;}else{d.copy(b.matrix);b.matrix=d;}delete c.animationCache;}}};THREE.KeyFrameAnimation.prototype.update=function(a){if(this.isPlaying===false)return;this.currentTime+=a*this.timeScale;var b=this.data.length;if(this.loop===true&&this.currentTime>b)this.currentTime%=b;this.currentTime=Math.min(this.currentTime,b);for(var c=0,d=this.hierarchy.length;c<d;c++){var e=this.hierarchy[c];var f=this.data.hierarchy[c];var g=f.keys,h=f.animationCache;if(g.length){var i=h.prevKey;var j=h.nextKey;if(j.time<=this.currentTime){while(j.time<this.currentTime&&j.index>i.index){i=j;j=g[i.index+1];}h.prevKey=i;h.nextKey=j;}if(j.time>=this.currentTime)i.interpolate(j,this.currentTime);else i.interpolate(j,j.time);this.data.hierarchy[c].node.updateMatrix();e.matrixWorldNeedsUpdate=true;}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c=c%d.length;for(;c<d.length;c++)if(d[c].hasTarget(a))return d[c];return d[0];};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c=c>=0?c:c+d.length;for(;c>=0;c--)if(d[c].hasTarget(a))return d[c];return d[d.length-1];};THREE.MorphAnimation=function(a){this.mesh=a;this.frames=a.morphTargetInfluences.length;this.currentTime=0;this.duration=1000;this.loop=true;this.isPlaying=false;};THREE.MorphAnimation.prototype={play:function(){this.isPlaying=true;},pause:function(){this.isPlaying=false;},update:(function(){var a=0;var b=0;return function(c){if(this.isPlaying===false)return;this.currentTime+=c;if(this.loop===true&&this.currentTime>this.duration)this.currentTime%=this.duration;this.currentTime=Math.min(this.currentTime,this.duration);var d=this.duration/this.frames;var e=Math.floor(this.currentTime/d);if(e!=b){this.mesh.morphTargetInfluences[a]=0;this.mesh.morphTargetInfluences[b]=1;this.mesh.morphTargetInfluences[e]=0;a=b;b=e;}this.mesh.morphTargetInfluences[e]=(this.currentTime%d)/d;this.mesh.morphTargetInfluences[a]=1-this.mesh.morphTargetInfluences[e];};})()};THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);var d=90,e=1;var f=new THREE.PerspectiveCamera(d,e,a,b);f.up.set(0,-1,0);f.lookAt(new THREE.Vector3(1,0,0));this.add(f);var g=new THREE.PerspectiveCamera(d,e,a,b);g.up.set(0,-1,0);g.lookAt(new THREE.Vector3(-1,0,0));this.add(g);var h=new THREE.PerspectiveCamera(d,e,a,b);h.up.set(0,0,1);h.lookAt(new THREE.Vector3(0,1,0));this.add(h);var i=new THREE.PerspectiveCamera(d,e,a,b);i.up.set(0,0,-1);i.lookAt(new THREE.Vector3(0,-1,0));this.add(i);var j=new THREE.PerspectiveCamera(d,e,a,b);j.up.set(0,-1,0);j.lookAt(new THREE.Vector3(0,0,1));this.add(j);var k=new THREE.PerspectiveCamera(d,e,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget;var d=c.generateMipmaps;c.generateMipmaps=false;c.activeCubeFace=0;a.render(b,f,c);c.activeCubeFace=1;a.render(b,g,c);c.activeCubeFace=2;a.render(b,h,c);c.activeCubeFace=3;a.render(b,i,c);c.activeCubeFace=4;a.render(b,j,c);c.generateMipmaps=d;c.activeCubeFace=5;a.render(b,k,c);};};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(a,b,c,d,e,f,g){THREE.Camera.call(this);this.fov=c;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;this.cameraO=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,g);this.cameraP=new THREE.PerspectiveCamera(c,a/b,d,e);this.zoom=1;this.toPerspective();var h=a/b;};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false;};THREE.CombinedCamera.prototype.toOrthographic=function(){var a=this.fov;var b=this.cameraP.aspect;var c=this.cameraP.near;var d=this.cameraP.far;var e=(c+d)/2;var f=Math.tan(a/2)*e;var g=2*f;var h=g*b;var i=h/2;f/=this.zoom;i/=this.zoom;this.cameraO.left=-i;this.cameraO.right=i;this.cameraO.top=f;this.cameraO.bottom=-f;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true;};THREE.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;};THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a;if(this.inPerspectiveMode)this.toPerspective();else this.toOrthographic();};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode)this.toPerspective();else{this.toPerspective();this.toOrthographic();}};THREE.CombinedCamera.prototype.setLens=function(a,b){if(b===undefined)b=24;var c=2*THREE.Math.radToDeg(Math.atan(b/(a*2)));this.setFov(c);return c;};THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;if(this.inPerspectiveMode)this.toPerspective();else this.toOrthographic();};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);var g=this;this.width=a;this.height=b;this.depth=c;this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this.width/2;var i=this.height/2;var j=this.depth/2;k('z','y',-1,-1,this.depth,this.height,h,0);k('z','y',1,-1,this.depth,this.height,-h,1);k('x','z',1,1,this.width,this.depth,i,2);k('x','z',1,-1,this.width,this.depth,-i,3);k('x','y',1,-1,this.width,this.height,j,4);k('x','y',-1,-1,this.width,this.height,-j,5);function k(a,b,c,d,e,f,h,i){var j,k,l,m=g.widthSegments,n=g.heightSegments,o=e/2,p=f/2,q=g.vertices.length;if((a==='x'&&b==='y')||(a==='y'&&b==='x'))j='z';else if((a==='x'&&b==='z')||(a==='z'&&b==='x')){j='y';n=g.depthSegments;}else if((a==='z'&&b==='y')||(a==='y'&&b==='z')){j='x';m=g.depthSegments;}var r=m+1,s=n+1,t=e/m,u=f/n,v=new THREE.Vector3();v[j]=h>0?1:-1;for(l=0;l<s;l++)for(k=0;k<r;k++){var w=new THREE.Vector3();w[a]=(k*t-o)*c;w[b]=(l*u-p)*d;w[j]=h;g.vertices.push(w);}for(l=0;l<n;l++)for(k=0;k<m;k++){var x=k+r*l;var y=k+r*(l+1);var z=(k+1)+r*(l+1);var A=(k+1)+r*l;var B=new THREE.Vector2(k/m,1-l/n);var C=new THREE.Vector2(k/m,1-(l+1)/n);var D=new THREE.Vector2((k+1)/m,1-(l+1)/n);var E=new THREE.Vector2((k+1)/m,1-l/n);var F=new THREE.Face3(x+q,y+q,A+q);F.normal.copy(v);F.vertexNormals.push(v.clone(),v.clone(),v.clone());F.materialIndex=i;g.faces.push(F);g.faceVertexUvs[0].push([B,C,E]);F=new THREE.Face3(y+q,z+q,A+q);F.normal.copy(v);F.vertexNormals.push(v.clone(),v.clone(),v.clone());F.materialIndex=i;g.faces.push(F);g.faceVertexUvs[0].push([C.clone(),D,E.clone()]);}}this.computeCentroids();this.mergeVertices();};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.radius=a=a||50;this.segments=b=b!==undefined?Math.max(3,b):8;this.thetaStart=c=c!==undefined?c:0;this.thetaLength=d=d!==undefined?d:Math.PI*2;var e,f=[],g=new THREE.Vector3(),h=new THREE.Vector2(0.5,0.5);this.vertices.push(g);f.push(h);for(e=0;e<=b;e++){var i=new THREE.Vector3();var j=c+e/b*d;i.x=a*Math.cos(j);i.y=a*Math.sin(j);this.vertices.push(i);f.push(new THREE.Vector2((i.x/a+1)/2,(i.y/a+1)/2));}var k=new THREE.Vector3(0,0,1);for(e=1;e<=b;e++){var l=e;var m=e+1;var n=0;this.faces.push(new THREE.Face3(l,m,n,[k.clone(),k.clone(),k.clone()]));this.faceVertexUvs[0].push([f[e].clone(),f[e+1].clone(),h.clone()]);}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),a);};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=THREE.BoxGeometry;THREE.CylinderGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.radiusTop=a=a!==undefined?a:20;this.radiusBottom=b=b!==undefined?b:20;this.height=c=c!==undefined?c:100;this.radialSegments=d=d||8;this.heightSegments=e=e||1;this.openEnded=f=f!==undefined?f:false;var g=c/2;var h,i,j=[],k=[];for(i=0;i<=e;i++){var l=[];var m=[];var n=i/e;var o=n*(b-a)+a;for(h=0;h<=d;h++){var p=h/d;var q=new THREE.Vector3();q.x=o*Math.sin(p*Math.PI*2);q.y=-n*c+g;q.z=o*Math.cos(p*Math.PI*2);this.vertices.push(q);l.push(this.vertices.length-1);m.push(new THREE.Vector2(p,1-n));}j.push(l);k.push(m);}var r=(b-a)/c;var s,t;for(h=0;h<d;h++){if(a!==0){s=this.vertices[j[0][h]].clone();t=this.vertices[j[0][h+1]].clone();}else{s=this.vertices[j[1][h]].clone();t=this.vertices[j[1][h+1]].clone();}s.setY(Math.sqrt(s.x*s.x+s.z*s.z)*r).normalize();t.setY(Math.sqrt(t.x*t.x+t.z*t.z)*r).normalize();for(i=0;i<e;i++){var u=j[i][h];var v=j[i+1][h];var w=j[i+1][h+1];var x=j[i][h+1];var y=s.clone();var z=s.clone();var A=t.clone();var B=t.clone();var C=k[i][h].clone();var D=k[i+1][h].clone();var E=k[i+1][h+1].clone();var F=k[i][h+1].clone();this.faces.push(new THREE.Face3(u,v,x,[y,z,B]));this.faceVertexUvs[0].push([C,D,F]);this.faces.push(new THREE.Face3(v,w,x,[z.clone(),A,B.clone()]));this.faceVertexUvs[0].push([D.clone(),E,F.clone()]);}}if(f===false&&a>0){this.vertices.push(new THREE.Vector3(0,g,0));for(h=0;h<d;h++){var u=j[0][h];var v=j[0][h+1];var w=this.vertices.length-1;var y=new THREE.Vector3(0,1,0);var z=new THREE.Vector3(0,1,0);var A=new THREE.Vector3(0,1,0);var C=k[0][h].clone();var D=k[0][h+1].clone();var E=new THREE.Vector2(D.x,0);this.faces.push(new THREE.Face3(u,v,w,[y,z,A]));this.faceVertexUvs[0].push([C,D,E]);}}if(f===false&&b>0){this.vertices.push(new THREE.Vector3(0,-g,0));for(h=0;h<d;h++){var u=j[i][h+1];var v=j[i][h];var w=this.vertices.length-1;var y=new THREE.Vector3(0,-1,0);var z=new THREE.Vector3(0,-1,0);var A=new THREE.Vector3(0,-1,0);var C=k[i][h+1].clone();var D=k[i][h].clone();var E=new THREE.Vector2(D.x,1);this.faces.push(new THREE.Face3(u,v,w,[y,z,A]));this.faceVertexUvs[0].push([C,D,E]);}}this.computeCentroids();this.computeFaceNormals();};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(a,b){if(typeof a==="undefined"){a=[];return;}THREE.Geometry.call(this);a=a instanceof Array?a:[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals();};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){var c=a.length;for(var d=0;d<c;d++){var e=a[d];this.addShape(e,b);}};THREE.ExtrudeGeometry.prototype.addShape=function(a,b){var c=b.amount!==undefined?b.amount:100;var d=b.bevelThickness!==undefined?b.bevelThickness:6;var e=b.bevelSize!==undefined?b.bevelSize:d-2;var f=b.bevelSegments!==undefined?b.bevelSegments:3;var g=b.bevelEnabled!==undefined?b.bevelEnabled:true;var h=b.curveSegments!==undefined?b.curveSegments:12;var i=b.steps!==undefined?b.steps:1;var j=b.extrudePath;var k,l=false;var m=b.material;var n=b.extrudeMaterial;var o=b.UVGenerator!==undefined?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var p=this.shapebb;var q,r,s,t;if(j){k=j.getSpacedPoints(i);l=true;g=false;q=b.frames!==undefined?b.frames:new THREE.TubeGeometry.FrenetFrames(j,i,false);r=new THREE.Vector3();s=new THREE.Vector3();t=new THREE.Vector3();}if(!g){f=0;d=0;e=0;}var u,v,w;var x=this;var y=[];var z=this.vertices.length;var A=a.extractPoints(h);var B=A.shape;var C=A.holes;var D=!THREE.Shape.Utils.isClockWise(B);if(D){B=B.reverse();for(v=0,w=C.length;v<w;v++){u=C[v];if(THREE.Shape.Utils.isClockWise(u))C[v]=u.reverse();}D=false;}var E=THREE.Shape.Utils.triangulateShape(B,C);var F=B;for(v=0,w=C.length;v<w;v++){u=C[v];B=B.concat(u);}function G(a,b,c){if(!b)console.log("die");return b.clone().multiplyScalar(c).add(a);}var H,I,J,K,L,M=B.length,N,O=E.length,P,Q=F.length;var R=180/Math.PI;function S(a,b,c){var d=0.0000000001;var e=THREE.Math.sign;var f,g,h=1;var i=a.x-b.x,j=a.y-b.y;var k=c.x-a.x,l=c.y-a.y;var m=(i*i+j*j);var n=(i*l-j*k);if(Math.abs(n)>d){var o=Math.sqrt(m);var p=Math.sqrt(k*k+l*l);var q=(b.x-j/o);var r=(b.y+i/o);var s=(c.x-l/p);var t=(c.y+k/p);var u=((s-q)*l-(t-r)*k)/(i*l-j*k);f=(q+i*u-a.x);g=(r+j*u-a.y);var v=(f*f+g*g);if(v<=2)return new THREE.Vector2(f,g);else h=Math.sqrt(v/2);}else{var w=false;if(i>d){if(k>d)w=true;}else if(i<-d){if(k<-d)w=true;}else if(e(j)==e(l))w=true;if(w){f=-j;g=i;h=Math.sqrt(m);}else{f=i;g=j;h=Math.sqrt(m/2);}}return new THREE.Vector2(f/h,g/h);}var T=[];for(var U=0,V=F.length,W=V-1,X=U+1;U<V;U++,W++,X++){if(W===V)W=0;if(X===V)X=0;var Y=F[U];var Z=F[W];var $=F[X];T[U]=S(F[U],F[W],F[X]);}var _=[],ab,ac=T.concat();for(v=0,w=C.length;v<w;v++){u=C[v];ab=[];for(U=0,V=u.length,W=V-1,X=U+1;U<V;U++,W++,X++){if(W===V)W=0;if(X===V)X=0;ab[U]=S(u[U],u[W],u[X]);}_.push(ab);ac=ac.concat(ab);}for(H=0;H<f;H++){J=H/f;K=d*(1-J);I=e*(Math.sin(J*Math.PI/2));for(U=0,V=F.length;U<V;U++){L=G(F[U],T[U],I);ah(L.x,L.y,-K);}for(v=0,w=C.length;v<w;v++){u=C[v];ab=_[v];for(U=0,V=u.length;U<V;U++){L=G(u[U],ab[U],I);ah(L.x,L.y,-K);}}}I=e;for(U=0;U<M;U++){L=g?G(B[U],ac[U],I):B[U];if(!l)ah(L.x,L.y,0);else{s.copy(q.normals[0]).multiplyScalar(L.x);r.copy(q.binormals[0]).multiplyScalar(L.y);t.copy(k[0]).add(s).add(r);ah(t.x,t.y,t.z);}}var ad;for(ad=1;ad<=i;ad++)for(U=0;U<M;U++){L=g?G(B[U],ac[U],I):B[U];if(!l)ah(L.x,L.y,c/i*ad);else{s.copy(q.normals[ad]).multiplyScalar(L.x);r.copy(q.binormals[ad]).multiplyScalar(L.y);t.copy(k[ad]).add(s).add(r);ah(t.x,t.y,t.z);}}for(H=f-1;H>=0;H--){J=H/f;K=d*(1-J);I=e*Math.sin(J*Math.PI/2);for(U=0,V=F.length;U<V;U++){L=G(F[U],T[U],I);ah(L.x,L.y,c+K);}for(v=0,w=C.length;v<w;v++){u=C[v];ab=_[v];for(U=0,V=u.length;U<V;U++){L=G(u[U],ab[U],I);if(!l)ah(L.x,L.y,c+K);else ah(L.x,L.y+k[i-1].y,k[i-1].x+K);}}}ae();af();function ae(){if(g){var a=0;var b=M*a;for(U=0;U<O;U++){N=E[U];ai(N[2]+b,N[1]+b,N[0]+b,true);}a=i+f*2;b=M*a;for(U=0;U<O;U++){N=E[U];ai(N[0]+b,N[1]+b,N[2]+b,false);}}else{for(U=0;U<O;U++){N=E[U];ai(N[2],N[1],N[0],true);}for(U=0;U<O;U++){N=E[U];ai(N[0]+M*i,N[1]+M*i,N[2]+M*i,false);}}}function af(){var a=0;ag(F,a);a+=F.length;for(v=0,w=C.length;v<w;v++){u=C[v];ag(u,a);a+=u.length;}}function ag(a,b){var c,d;U=a.length;while(--U>=0){c=U;d=U-1;if(d<0)d=a.length-1;var e=0,g=i+f*2;for(e=0;e<g;e++){var h=M*e;var j=M*(e+1);var k=b+c+h,l=b+d+h,m=b+d+j,n=b+c+j;aj(k,l,m,n,a,e,g,c,d);}}}function ah(a,b,c){x.vertices.push(new THREE.Vector3(a,b,c));}function ai(c,d,e,f){c+=z;d+=z;e+=z;x.faces.push(new THREE.Face3(c,d,e,null,null,m));var g=f?o.generateBottomUV(x,a,b,c,d,e):o.generateTopUV(x,a,b,c,d,e);x.faceVertexUvs[0].push(g);}function aj(c,d,e,f,g,h,i,j,k){c+=z;d+=z;e+=z;f+=z;x.faces.push(new THREE.Face3(c,d,f,null,null,n));x.faces.push(new THREE.Face3(d,e,f,null,null,n));var l=o.generateSideWallUV(x,a,g,b,c,d,e,f,h,i,j,k);x.faceVertexUvs[0].push([l[0],l[1],l[3]]);x.faceVertexUvs[0].push([l[1],l[2],l[3]]);}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){var g=a.vertices[d].x,h=a.vertices[d].y,i=a.vertices[e].x,j=a.vertices[e].y,k=a.vertices[f].x,l=a.vertices[f].y;return [new THREE.Vector2(g,h),new THREE.Vector2(i,j),new THREE.Vector2(k,l)];},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f);},generateSideWallUV:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a.vertices[e].x,n=a.vertices[e].y,o=a.vertices[e].z,p=a.vertices[f].x,q=a.vertices[f].y,r=a.vertices[f].z,s=a.vertices[g].x,t=a.vertices[g].y,u=a.vertices[g].z,v=a.vertices[h].x,w=a.vertices[h].y,x=a.vertices[h].z;if(Math.abs(n-q)<0.01)return [new THREE.Vector2(m,1-o),new THREE.Vector2(p,1-r),new THREE.Vector2(s,1-u),new THREE.Vector2(v,1-x)];else return [new THREE.Vector2(n,1-o),new THREE.Vector2(q,1-r),new THREE.Vector2(t,1-u),new THREE.Vector2(w,1-x)];}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2();THREE.ExtrudeGeometry.__v2=new THREE.Vector2();THREE.ExtrudeGeometry.__v3=new THREE.Vector2();THREE.ExtrudeGeometry.__v4=new THREE.Vector2();THREE.ExtrudeGeometry.__v5=new THREE.Vector2();THREE.ExtrudeGeometry.__v6=new THREE.Vector2();THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);if(a instanceof Array===false)a=[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals();};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this;};THREE.ShapeGeometry.prototype.addShape=function(a,b){if(b===undefined)b={};var c=b.curveSegments!==undefined?b.curveSegments:12;var d=b.material;var e=b.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator;var f=this.shapebb;var g,h,i,j;var k=this.vertices.length;var l=a.extractPoints(c);var m=l.shape;var n=l.holes;var o=!THREE.Shape.Utils.isClockWise(m);if(o){m=m.reverse();for(g=0,h=n.length;g<h;g++){i=n[g];if(THREE.Shape.Utils.isClockWise(i))n[g]=i.reverse();}o=false;}var p=THREE.Shape.Utils.triangulateShape(m,n);var q=m;for(g=0,h=n.length;g<h;g++){i=n[g];m=m.concat(i);}var r,s=m.length;var t,u=p.length;var v,w=q.length;for(g=0;g<s;g++){r=m[g];this.vertices.push(new THREE.Vector3(r.x,r.y,0));}for(g=0;g<u;g++){t=p[g];var x=t[0]+k;var y=t[1]+k;var z=t[2]+k;this.faces.push(new THREE.Face3(x,y,z,null,null,d));this.faceVertexUvs[0].push(e.generateBottomUV(this,a,b,x,y,z));}};THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);b=b||12;c=c||0;d=d||2*Math.PI;var e=1.0/(a.length-1);var f=1.0/b;for(var g=0,h=b;g<=h;g++){var i=c+g*f*d;var j=Math.cos(i),k=Math.sin(i);for(var l=0,m=a.length;l<m;l++){var n=a[l];var o=new THREE.Vector3();o.x=j*n.x-k*n.y;o.y=k*n.x+j*n.y;o.z=n.z;this.vertices.push(o);}}var p=a.length;for(var g=0,h=b;g<h;g++)for(var l=0,m=a.length-1;l<m;l++){var q=l+p*g;var r=q;var s=q+p;var j=q+1+p;var t=q+1;var u=g*f;var v=l*e;var w=u+f;var x=v+e;this.faces.push(new THREE.Face3(r,s,t));this.faceVertexUvs[0].push([new THREE.Vector2(u,v),new THREE.Vector2(w,v),new THREE.Vector2(u,x)]);this.faces.push(new THREE.Face3(s,j,t));this.faceVertexUvs[0].push([new THREE.Vector2(w,v),new THREE.Vector2(w,x),new THREE.Vector2(u,x)]);}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.width=a;this.height=b;this.widthSegments=c||1;this.heightSegments=d||1;var e,f;var g=a/2;var h=b/2;var i=this.widthSegments;var j=this.heightSegments;var k=i+1;var l=j+1;var m=this.width/i;var n=this.height/j;var o=new THREE.Vector3(0,0,1);for(f=0;f<l;f++)for(e=0;e<k;e++){var p=e*m-g;var q=f*n-h;this.vertices.push(new THREE.Vector3(p,-q,0));}for(f=0;f<j;f++)for(e=0;e<i;e++){var r=e+k*f;var s=e+k*(f+1);var t=(e+1)+k*(f+1);var u=(e+1)+k*f;var v=new THREE.Vector2(e/i,1-f/j);var w=new THREE.Vector2(e/i,1-(f+1)/j);var x=new THREE.Vector2((e+1)/i,1-(f+1)/j);var y=new THREE.Vector2((e+1)/i,1-f/j);var z=new THREE.Face3(r,s,u);z.normal.copy(o);z.vertexNormals.push(o.clone(),o.clone(),o.clone());this.faces.push(z);this.faceVertexUvs[0].push([v,w,y]);z=new THREE.Face3(s,t,u);z.normal.copy(o);z.vertexNormals.push(o.clone(),o.clone(),o.clone());this.faces.push(z);this.faceVertexUvs[0].push([w.clone(),x,y.clone()]);}this.computeCentroids();};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);a=a||0;b=b||50;e=e!==undefined?e:0;f=f!==undefined?f:Math.PI*2;c=c!==undefined?Math.max(3,c):8;d=d!==undefined?Math.max(3,d):8;var g,h,i=[],j=a,k=((b-a)/d);for(g=0;g<=d;g++){for(h=0;h<=c;h++){var l=new THREE.Vector3();var m=e+h/c*f;l.x=j*Math.cos(m);l.y=j*Math.sin(m);this.vertices.push(l);i.push(new THREE.Vector2((l.x/b+1)/2,(l.y/b+1)/2));}j+=k;}var n=new THREE.Vector3(0,0,1);for(g=0;g<d;g++){var o=g*c;for(h=0;h<=c;h++){var m=h+o;var p=m+g;var q=m+c+g;var r=m+c+1+g;this.faces.push(new THREE.Face3(p,q,r,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([i[p].clone(),i[q].clone(),i[r].clone()]);p=m+g;q=m+c+1+g;r=m+1+g;this.faces.push(new THREE.Face3(p,q,r,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([i[p].clone(),i[q].clone(),i[r].clone()]);}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),j);};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.radius=a=a||50;this.widthSegments=b=Math.max(3,Math.floor(b)||8);this.heightSegments=c=Math.max(2,Math.floor(c)||6);this.phiStart=d=d!==undefined?d:0;this.phiLength=e=e!==undefined?e:Math.PI*2;this.thetaStart=f=f!==undefined?f:0;this.thetaLength=g=g!==undefined?g:Math.PI;var h,i,j=[],k=[];for(i=0;i<=c;i++){var l=[];var m=[];for(h=0;h<=b;h++){var n=h/b;var o=i/c;var p=new THREE.Vector3();p.x=-a*Math.cos(d+n*e)*Math.sin(f+o*g);p.y=a*Math.cos(f+o*g);p.z=a*Math.sin(d+n*e)*Math.sin(f+o*g);this.vertices.push(p);l.push(this.vertices.length-1);m.push(new THREE.Vector2(n,1-o));}j.push(l);k.push(m);}for(i=0;i<this.heightSegments;i++)for(h=0;h<this.widthSegments;h++){var q=j[i][h+1];var r=j[i][h];var s=j[i+1][h];var t=j[i+1][h+1];var u=this.vertices[q].clone().normalize();var v=this.vertices[r].clone().normalize();var w=this.vertices[s].clone().normalize();var x=this.vertices[t].clone().normalize();var y=k[i][h+1].clone();var z=k[i][h].clone();var A=k[i+1][h].clone();var B=k[i+1][h+1].clone();if(Math.abs(this.vertices[q].y)===this.radius){y.x=(y.x+z.x)/2;this.faces.push(new THREE.Face3(q,s,t,[u,w,x]));this.faceVertexUvs[0].push([y,A,B]);}else if(Math.abs(this.vertices[s].y)===this.radius){A.x=(A.x+B.x)/2;this.faces.push(new THREE.Face3(q,r,s,[u,v,w]));this.faceVertexUvs[0].push([y,z,A]);}else{this.faces.push(new THREE.Face3(q,r,t,[u,v,x]));this.faceVertexUvs[0].push([y,z,B]);this.faces.push(new THREE.Face3(r,s,t,[v.clone(),w,x.clone()]));this.faceVertexUvs[0].push([z.clone(),A,B.clone()]);}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),a);};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(a,b){b=b||{};var c=THREE.FontUtils.generateShapes(a,b);b.amount=b.height!==undefined?b.height:50;if(b.bevelThickness===undefined)b.bevelThickness=10;if(b.bevelSize===undefined)b.bevelSize=8;if(b.bevelEnabled===undefined)b.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,c,b);};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);var f=this;this.radius=a||100;this.tube=b||40;this.radialSegments=c||8;this.tubularSegments=d||6;this.arc=e||Math.PI*2;var g=new THREE.Vector3(),h=[],i=[];for(var j=0;j<=this.radialSegments;j++)for(var k=0;k<=this.tubularSegments;k++){var l=k/this.tubularSegments*this.arc;var m=j/this.radialSegments*Math.PI*2;g.x=this.radius*Math.cos(l);g.y=this.radius*Math.sin(l);var n=new THREE.Vector3();n.x=(this.radius+this.tube*Math.cos(m))*Math.cos(l);n.y=(this.radius+this.tube*Math.cos(m))*Math.sin(l);n.z=this.tube*Math.sin(m);this.vertices.push(n);h.push(new THREE.Vector2(k/this.tubularSegments,j/this.radialSegments));i.push(n.clone().sub(g).normalize());}for(var j=1;j<=this.radialSegments;j++)for(var k=1;k<=this.tubularSegments;k++){var o=(this.tubularSegments+1)*j+k-1;var p=(this.tubularSegments+1)*(j-1)+k-1;var q=(this.tubularSegments+1)*(j-1)+k;var r=(this.tubularSegments+1)*j+k;var s=new THREE.Face3(o,p,r,[i[o].clone(),i[p].clone(),i[r].clone()]);this.faces.push(s);this.faceVertexUvs[0].push([h[o].clone(),h[p].clone(),h[r].clone()]);s=new THREE.Face3(p,q,r,[i[p].clone(),i[q].clone(),i[r].clone()]);this.faces.push(s);this.faceVertexUvs[0].push([h[p].clone(),h[q].clone(),h[r].clone()]);}this.computeCentroids();this.computeFaceNormals();};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);var h=this;this.radius=a||100;this.tube=b||40;this.radialSegments=c||64;this.tubularSegments=d||8;this.p=e||2;this.q=f||3;this.heightScale=g||1;this.grid=new Array(this.radialSegments);var i=new THREE.Vector3();var j=new THREE.Vector3();var k=new THREE.Vector3();for(var l=0;l<this.radialSegments;++l){this.grid[l]=new Array(this.tubularSegments);var m=l/this.radialSegments*2*this.p*Math.PI;var n=E(m,this.q,this.p,this.radius,this.heightScale);var o=E(m+0.01,this.q,this.p,this.radius,this.heightScale);i.subVectors(o,n);j.addVectors(o,n);k.crossVectors(i,j);j.crossVectors(k,i);k.normalize();j.normalize();for(var p=0;p<this.tubularSegments;++p){var q=p/this.tubularSegments*2*Math.PI;var r=-this.tube*Math.cos(q);var s=this.tube*Math.sin(q);var t=new THREE.Vector3();t.x=n.x+r*j.x+s*k.x;t.y=n.y+r*j.y+s*k.y;t.z=n.z+r*j.z+s*k.z;this.grid[l][p]=h.vertices.push(t)-1;}}for(var l=0;l<this.radialSegments;++l)for(var p=0;p<this.tubularSegments;++p){var u=(l+1)%this.radialSegments;var v=(p+1)%this.tubularSegments;var w=this.grid[l][p];var x=this.grid[u][p];var y=this.grid[u][v];var z=this.grid[l][v];var A=new THREE.Vector2(l/this.radialSegments,p/this.tubularSegments);var B=new THREE.Vector2((l+1)/this.radialSegments,p/this.tubularSegments);var C=new THREE.Vector2((l+1)/this.radialSegments,(p+1)/this.tubularSegments);var D=new THREE.Vector2(l/this.radialSegments,(p+1)/this.tubularSegments);this.faces.push(new THREE.Face3(w,x,z));this.faceVertexUvs[0].push([A,B,D]);this.faces.push(new THREE.Face3(x,y,z));this.faceVertexUvs[0].push([B.clone(),C,D.clone()]);}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function E(a,b,c,d,e){var f=Math.cos(a);var g=Math.sin(a);var h=b/c*a;var i=Math.cos(h);var j=d*(2+i)*0.5*f;var k=d*(2+i)*g*0.5;var l=e*d*Math.sin(h)*0.5;return new THREE.Vector3(j,k,l);}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.path=a;this.segments=b||64;this.radius=c||1;this.radialSegments=d||8;this.closed=e||false;this.grid=[];var f=this,g,h,i,j=this.segments+1,k,l,m,n,o,p,q,r,s,t,u,v=new THREE.Vector3(),w,x,y,z,A,B,C,D,E,F,G,H;var I=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),J=I.tangents,K=I.normals,L=I.binormals;this.tangents=J;this.normals=K;this.binormals=L;function M(a,b,c){return f.vertices.push(new THREE.Vector3(a,b,c))-1;}for(w=0;w<j;w++){this.grid[w]=[];q=w/(j-1);u=a.getPointAt(q);g=J[w];h=K[w];i=L[w];for(x=0;x<this.radialSegments;x++){r=x/this.radialSegments*2*Math.PI;s=-this.radius*Math.cos(r);t=this.radius*Math.sin(r);v.copy(u);v.x+=s*h.x+t*i.x;v.y+=s*h.y+t*i.y;v.z+=s*h.z+t*i.z;this.grid[w][x]=M(v.x,v.y,v.z);}}for(w=0;w<this.segments;w++)for(x=0;x<this.radialSegments;x++){y=(this.closed)?(w+1)%this.segments:w+1;z=(x+1)%this.radialSegments;A=this.grid[w][x];B=this.grid[y][x];C=this.grid[y][z];D=this.grid[w][z];E=new THREE.Vector2(w/this.segments,x/this.radialSegments);F=new THREE.Vector2((w+1)/this.segments,x/this.radialSegments);G=new THREE.Vector2((w+1)/this.segments,(x+1)/this.radialSegments);H=new THREE.Vector2(w/this.segments,(x+1)/this.radialSegments);this.faces.push(new THREE.Face3(A,B,D));this.faceVertexUvs[0].push([E,F,H]);this.faces.push(new THREE.Face3(B,C,D));this.faceVertexUvs[0].push([F.clone(),G,H.clone()]);}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(a,b,c){var d=new THREE.Vector3(),e=new THREE.Vector3(),f=new THREE.Vector3(),g=[],h=[],i=[],j=new THREE.Vector3(),k=new THREE.Matrix4(),l=b+1,m,n=0.0001,o,p,q,r,s,t,u;this.tangents=g;this.normals=h;this.binormals=i;for(s=0;s<l;s++){t=s/(l-1);g[s]=a.getTangentAt(t);g[s].normalize();}x();function v(a){h[0]=new THREE.Vector3();i[0]=new THREE.Vector3();if(a===undefined)a=new THREE.Vector3(0,0,1);h[0].crossVectors(a,g[0]).normalize();i[0].crossVectors(g[0],h[0]).normalize();}function w(){var b=a.getTangentAt(n);h[0]=new THREE.Vector3().subVectors(b,g[0]).normalize();i[0]=new THREE.Vector3().crossVectors(g[0],h[0]);h[0].crossVectors(i[0],g[0]).normalize();i[0].crossVectors(g[0],h[0]).normalize();}function x(){h[0]=new THREE.Vector3();i[0]=new THREE.Vector3();o=Number.MAX_VALUE;p=Math.abs(g[0].x);q=Math.abs(g[0].y);r=Math.abs(g[0].z);if(p<=o){o=p;e.set(1,0,0);}if(q<=o){o=q;e.set(0,1,0);}if(r<=o)e.set(0,0,1);j.crossVectors(g[0],e).normalize();h[0].crossVectors(g[0],j);i[0].crossVectors(g[0],h[0]);}for(s=1;s<l;s++){h[s]=h[s-1].clone();i[s]=i[s-1].clone();j.crossVectors(g[s-1],g[s]);if(j.length()>n){j.normalize();m=Math.acos(THREE.Math.clamp(g[s-1].dot(g[s]),-1,1));h[s].applyMatrix4(k.makeRotationAxis(j,m));}i[s].crossVectors(g[s],h[s]);}if(c){m=Math.acos(THREE.Math.clamp(h[0].dot(h[l-1]),-1,1));m/=(l-1);if(g[0].dot(j.crossVectors(h[0],h[l-1]))>0)m=-m;for(s=1;s<l;s++){h[s].applyMatrix4(k.makeRotationAxis(g[s],m*s));i[s].crossVectors(g[s],h[s]);}}};THREE.PolyhedronGeometry=function(a,b,c,d){THREE.Geometry.call(this);c=c||1;d=d||0;var e=this;for(var f=0,g=a.length;f<g;f++)t(new THREE.Vector3(a[f][0],a[f][1],a[f][2]));var h=[],i=this.vertices;var j=[];for(var f=0,g=b.length;f<g;f++){var k=i[b[f][0]];var l=i[b[f][1]];var m=i[b[f][2]];j[f]=new THREE.Face3(k.index,l.index,m.index,[k.clone(),l.clone(),m.clone()]);}for(var f=0,g=j.length;f<g;f++)v(j[f],d);for(var f=0,g=this.faceVertexUvs[0].length;f<g;f++){var n=this.faceVertexUvs[0][f];var o=n[0].x;var p=n[1].x;var q=n[2].x;var r=Math.max(o,Math.max(p,q));var s=Math.min(o,Math.min(p,q));if(r>0.9&&s<0.1){if(o<0.2)n[0].x+=1;if(p<0.2)n[1].x+=1;if(q<0.2)n[2].x+=1;}}for(var f=0,g=this.vertices.length;f<g;f++)this.vertices[f].multiplyScalar(c);this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),c);function t(a){var b=a.normalize().clone();b.index=e.vertices.push(b)-1;var c=w(a)/2/Math.PI+0.5;var d=x(a)/Math.PI+0.5;b.uv=new THREE.Vector2(c,1-d);return b;}function u(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);d.centroid.add(a).add(b).add(c).divideScalar(3);e.faces.push(d);var f=w(d.centroid);e.faceVertexUvs[0].push([y(a.uv,a,f),y(b.uv,b,f),y(c.uv,c,f)]);}function v(a,b){var c=Math.pow(2,b);var d=Math.pow(4,b);var f=t(e.vertices[a.a]);var g=t(e.vertices[a.b]);var h=t(e.vertices[a.c]);var i=[];for(var j=0;j<=c;j++){i[j]=[];var k=t(f.clone().lerp(h,j/c));var l=t(g.clone().lerp(h,j/c));var m=c-j;for(var n=0;n<=m;n++)if(n==0&&j==c)i[j][n]=k;else i[j][n]=t(k.clone().lerp(l,n/m));}for(var j=0;j<c;j++)for(var n=0;n<2*(c-j)-1;n++){var o=Math.floor(n/2);if(n%2==0)u(i[j][o+1],i[j+1][o],i[j][o]);else u(i[j][o+1],i[j+1][o+1],i[j+1][o]);}}function w(a){return Math.atan2(a.z,-a.x);}function x(a){return Math.atan2(-a.y,Math.sqrt((a.x*a.x)+(a.z*a.z)));}function y(a,b,c){if((c<0)&&(a.x===1))a=new THREE.Vector2(a.x-1,a.y);if((b.x===0)&&(b.z===0))a=new THREE.Vector2(c/2/Math.PI+0.5,a.y);return a.clone();}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(a,b){this.radius=a;this.detail=b;var c=(1+Math.sqrt(5))/2;var d=[[-1,c,0],[1,c,0],[-1,-c,0],[1,-c,0],[0,-1,c],[0,1,c],[0,-1,-c],[0,1,-c],[c,0,-1],[c,0,1],[-c,0,-1],[-c,0,1]];var e=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,d,e,a,b);};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(a,b){var c=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var d=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,c,d,a,b);};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(a,b){var c=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var d=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,c,d,a,b);};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);var d=this.vertices;var e=this.faces;var f=this.faceVertexUvs[0];var g,h,i,j;var k,l;var m=c+1;var n=b+1;for(g=0;g<=c;g++){l=g/c;for(i=0;i<=b;i++){k=i/b;j=a(k,l);d.push(j);}}var o,p,q,r;var s,t,u,v;for(g=0;g<c;g++)for(i=0;i<b;i++){o=g*n+i;p=g*n+i+1;q=(g+1)*n+i+1;r=(g+1)*n+i;s=new THREE.Vector2(i/b,g/c);t=new THREE.Vector2((i+1)/b,g/c);u=new THREE.Vector2((i+1)/b,(g+1)/c);v=new THREE.Vector2(i/b,(g+1)/c);e.push(new THREE.Face3(o,p,r));f.push([s,t,v]);e.push(new THREE.Face3(p,q,r));f.push([t.clone(),u,v.clone()]);}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(a){a=a||1;var b=new THREE.Geometry();b.vertices.push(new THREE.Vector3(),new THREE.Vector3(a,0,0),new THREE.Vector3(),new THREE.Vector3(0,a,0),new THREE.Vector3(),new THREE.Vector3(0,0,a));b.colors.push(new THREE.Color(0xff0000),new THREE.Color(0xffaa00),new THREE.Color(0x00ff00),new THREE.Color(0xaaff00),new THREE.Color(0x0000ff),new THREE.Color(0x00aaff));var c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,b,c,THREE.LinePieces);};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(a,b,c,d,e,f){THREE.Object3D.call(this);if(d===undefined)d=0xffff00;if(c===undefined)c=1;if(e===undefined)e=0.2*c;if(f===undefined)f=0.2*e;this.position=b;var g=new THREE.Geometry();g.vertices.push(new THREE.Vector3(0,0,0));g.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(g,new THREE.LineBasicMaterial({color:d}));this.line.matrixAutoUpdate=false;this.add(this.line);var h=new THREE.CylinderGeometry(0,0.5,1,5,1);h.applyMatrix(new THREE.Matrix4().makeTranslation(0,-0.5,0));this.cone=new THREE.Mesh(h,new THREE.MeshBasicMaterial({color:d}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(a);this.setLength(c,e,f);};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3();var b;return function(c){if(c.y>0.99999)this.quaternion.set(0,0,0,1);else if(c.y<-0.99999)this.quaternion.set(1,0,0,0);else{a.set(c.z,0,-c.x).normalize();b=Math.acos(c.y);this.quaternion.setFromAxisAngle(a,b);}};}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){if(b===undefined)b=0.2*a;if(c===undefined)c=0.2*b;this.line.scale.set(1,a,1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix();};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a);};THREE.BoxHelper=function(a){var b=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=b;var c=new THREE.Geometry();c.vertices.push(b[0],b[1],b[1],b[2],b[2],b[3],b[3],b[0],b[4],b[5],b[5],b[6],b[6],b[7],b[7],b[4],b[0],b[4],b[1],b[5],b[2],b[6],b[3],b[7]);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:0xffff00}),THREE.LinePieces);if(a!==undefined)this.update(a);};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.update=function(a){var b=a.geometry;if(b.boundingBox===null)b.computeBoundingBox();var c=b.boundingBox.min;var d=b.boundingBox.max;var e=this.vertices;e[0].set(d.x,d.y,d.z);e[1].set(c.x,d.y,d.z);e[2].set(c.x,c.y,d.z);e[3].set(d.x,c.y,d.z);e[4].set(d.x,d.y,c.z);e[5].set(c.x,d.y,c.z);e[6].set(c.x,c.y,c.z);e[7].set(d.x,c.y,c.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=true;this.matrixAutoUpdate=false;this.matrixWorld=a.matrixWorld;};THREE.BoundingBoxHelper=function(a,b){var c=(b!==undefined)?b:0x888888;this.object=a;this.box=new THREE.Box3();THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:true}));};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position);};THREE.CameraHelper=function(a){var b=new THREE.Geometry();var c=new THREE.LineBasicMaterial({color:0xffffff,vertexColors:THREE.FaceColors});var d={};var e=0xffaa00;var f=0xff0000;var g=0x00aaff;var h=0xffffff;var i=0x333333;j("n1","n2",e);j("n2","n4",e);j("n4","n3",e);j("n3","n1",e);j("f1","f2",e);j("f2","f4",e);j("f4","f3",e);j("f3","f1",e);j("n1","f1",e);j("n2","f2",e);j("n3","f3",e);j("n4","f4",e);j("p","n1",f);j("p","n2",f);j("p","n3",f);j("p","n4",f);j("u1","u2",g);j("u2","u3",g);j("u3","u1",g);j("c","t",h);j("p","c",i);j("cn1","cn2",i);j("cn3","cn4",i);j("cf1","cf2",i);j("cf3","cf4",i);function j(a,b,c){k(a,c);k(b,c);}function k(a,c){b.vertices.push(new THREE.Vector3());b.colors.push(new THREE.Color(c));if(d[a]===undefined)d[a]=[];d[a].push(b.vertices.length-1);}THREE.Line.call(this,b,c,THREE.LinePieces);this.camera=a;this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=d;this.update();};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Camera();var c=new THREE.Projector();return function(){var d=this;var e=1,f=1;b.projectionMatrix.copy(this.camera.projectionMatrix);g("c",0,0,-1);g("t",0,0,1);g("n1",-e,-f,-1);g("n2",e,-f,-1);g("n3",-e,f,-1);g("n4",e,f,-1);g("f1",-e,-f,1);g("f2",e,-f,1);g("f3",-e,f,1);g("f4",e,f,1);g("u1",e*0.7,f*1.1,-1);g("u2",-e*0.7,f*1.1,-1);g("u3",0,f*2,-1);g("cf1",-e,0,1);g("cf2",e,0,1);g("cf3",0,-f,1);g("cf4",0,f,1);g("cn1",-e,0,-1);g("cn2",e,0,-1);g("cn3",0,-f,-1);g("cn4",0,f,-1);function g(e,f,g,h){a.set(f,g,h);c.unprojectVector(a,b);var i=d.pointMap[e];if(i!==undefined)for(var j=0,k=i.length;j<k;j++)d.geometry.vertices[i[j]].copy(a);}this.geometry.verticesNeedUpdate=true;};}();THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;b=b||1;var c=new THREE.PlaneGeometry(b,b);var d=new THREE.MeshBasicMaterial({wireframe:true,fog:false});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Mesh(c,d);this.add(this.lightPlane);c=new THREE.Geometry();c.vertices.push(new THREE.Vector3());c.vertices.push(new THREE.Vector3());d=new THREE.LineBasicMaterial({fog:false});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update();};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose();};THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Vector3();var c=new THREE.Vector3();return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color);};}();THREE.EdgesHelper=function(a,b){var c=(b!==undefined)?b:0xffffff;var d=[0,0],e={};var f=function(a,b){return a-b;};var g=['a','b','c'];var h=new THREE.BufferGeometry();var i=a.geometry.clone();i.mergeVertices();i.computeFaceNormals();var j=i.vertices;var k=i.faces;var l=0;for(var m=0,n=k.length;m<n;m++){var o=k[m];for(var p=0;p<3;p++){d[0]=o[g[p]];d[1]=o[g[(p+1)%3]];d.sort(f);var q=d.toString();if(e[q]===undefined){e[q]={vert1:d[0],vert2:d[1],face1:m,face2:undefined};l++;}else e[q].face2=m;}}h.addAttribute('position',Float32Array,2*l,3);var r=h.attributes.position.array;var s=0;for(var q in e){var t=e[q];if(t.face2===undefined||k[t.face1].normal.dot(k[t.face2].normal)<0.9999){var u=j[t.vert1];r[s++]=u.x;r[s++]=u.y;r[s++]=u.z;u=j[t.vert2];r[s++]=u.x;r[s++]=u.y;r[s++]=u.z;}}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=false;this.matrixWorld=a.matrixWorld;};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=(b!==undefined)?b:1;var e=(c!==undefined)?c:0xffff00;var f=(d!==undefined)?d:1;var g=new THREE.Geometry();var h=this.object.geometry.faces;for(var i=0,j=h.length;i<j;i++){g.vertices.push(new THREE.Vector3());g.vertices.push(new THREE.Vector3());}THREE.Line.call(this,g,new THREE.LineBasicMaterial({color:e,linewidth:f}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3();this.update();};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(a){this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var c=this.geometry.vertices;var d=this.object.geometry.faces;var e=this.object.matrixWorld;for(var f=0,g=d.length;f<g;f++){var h=d[f];b.copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var i=2*f;c[i].copy(h.centroid).applyMatrix4(e);c[i+1].addVectors(c[i],b);}this.geometry.verticesNeedUpdate=true;return this;};}());THREE.GridHelper=function(a,b){var c=new THREE.Geometry();var d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(0x444444);this.color2=new THREE.Color(0x888888);for(var e=-a;e<=a;e+=b){c.vertices.push(new THREE.Vector3(-a,0,e),new THREE.Vector3(a,0,e),new THREE.Vector3(e,0,-a),new THREE.Vector3(e,0,a));var f=e===0?this.color1:this.color2;c.colors.push(f,f,f,f);}THREE.Line.call(this,c,d,THREE.LinePieces);};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.setColors=function(a,b){this.color1.set(a);this.color2.set(b);this.geometry.colorsNeedUpdate=true;};THREE.HemisphereLightHelper=function(a,b,c,d){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color(),new THREE.Color()];var e=new THREE.SphereGeometry(b,4,2);e.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI/2));for(var f=0,g=8;f<g;f++)e.faces[f].color=this.colors[f<4?0:1];var h=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(e,h);this.add(this.lightSphere);this.update();};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose();};THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3();return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true;};}();THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(b,4,2);var d=new THREE.MeshBasicMaterial({wireframe:true,fog:false});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=false;};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);};THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;var b=new THREE.CylinderGeometry(0,1,1,8,1,true);b.applyMatrix(new THREE.Matrix4().makeTranslation(0,-0.5,0));b.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI/2));var c=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(b,c);this.add(this.cone);this.update();};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose();};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(){var c=this.light.distance?this.light.distance:10000;var d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);};}();THREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=(b!==undefined)?b:1;var e=(c!==undefined)?c:0xff0000;var f=(d!==undefined)?d:1;var g=new THREE.Geometry();var h=a.geometry.vertices;var i=a.geometry.faces;for(var j=0,k=i.length;j<k;j++){var l=i[j];for(var m=0,n=l.vertexNormals.length;m<n;m++){g.vertices.push(new THREE.Vector3());g.vertices.push(new THREE.Vector3());}}THREE.Line.call(this,g,new THREE.LineBasicMaterial({color:e,linewidth:f}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3();this.update();};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(a){var c=['a','b','c','d'];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var d=this.geometry.vertices;var e=this.object.geometry.vertices;var f=this.object.geometry.faces;var g=this.object.matrixWorld;var h=0;for(var i=0,j=f.length;i<j;i++){var k=f[i];for(var l=0,m=k.vertexNormals.length;l<m;l++){var n=k[c[l]];var o=e[n];var p=k.vertexNormals[l];d[h].copy(o).applyMatrix4(g);b.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);b.add(d[h]);h=h+1;d[h].copy(b);h=h+1;}}this.geometry.verticesNeedUpdate=true;return this;};}());THREE.VertexTangentsHelper=function(a,b,c,d){this.object=a;this.size=(b!==undefined)?b:1;var e=(c!==undefined)?c:0x0000ff;var f=(d!==undefined)?d:1;var g=new THREE.Geometry();var h=a.geometry.vertices;var i=a.geometry.faces;for(var j=0,k=i.length;j<k;j++){var l=i[j];for(var m=0,n=l.vertexTangents.length;m<n;m++){g.vertices.push(new THREE.Vector3());g.vertices.push(new THREE.Vector3());}}THREE.Line.call(this,g,new THREE.LineBasicMaterial({color:e,linewidth:f}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update();};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(a){var c=['a','b','c','d'];this.object.updateMatrixWorld(true);var d=this.geometry.vertices;var e=this.object.geometry.vertices;var f=this.object.geometry.faces;var g=this.object.matrixWorld;var h=0;for(var i=0,j=f.length;i<j;i++){var k=f[i];for(var l=0,m=k.vertexTangents.length;l<m;l++){var n=k[c[l]];var o=e[n];var p=k.vertexTangents[l];d[h].copy(o).applyMatrix4(g);b.copy(p).transformDirection(g).multiplyScalar(this.size);b.add(d[h]);h=h+1;d[h].copy(b);h=h+1;}}this.geometry.verticesNeedUpdate=true;return this;};}());THREE.WireframeHelper=function(a,b){var c=(b!==undefined)?b:0xffffff;var d=[0,0],e={};var f=function(a,b){return a-b;};var g=['a','b','c'];var h=new THREE.BufferGeometry();if(a.geometry instanceof THREE.Geometry){var i=a.geometry.vertices;var j=a.geometry.faces;var k=0;var l=new Uint32Array(6*j.length);for(var m=0,n=j.length;m<n;m++){var o=j[m];for(var p=0;p<3;p++){d[0]=o[g[p]];d[1]=o[g[(p+1)%3]];d.sort(f);var q=d.toString();if(e[q]===undefined){l[2*k]=d[0];l[2*k+1]=d[1];e[q]=true;k++;}}}h.addAttribute('position',Float32Array,2*k,3);var r=h.attributes.position.array;for(var m=0,n=k;m<n;m++)for(var p=0;p<2;p++){var s=i[l[2*m+p]];var t=6*m+3*p;r[t+0]=s.x;r[t+1]=s.y;r[t+2]=s.z;}}else if(a.geometry instanceof THREE.BufferGeometry&&a.geometry.attributes.index!==undefined){var i=a.geometry.attributes.position.array;var u=a.geometry.attributes.index.array;var v=a.geometry.offsets;var k=0;var l=new Uint32Array(2*u.length);for(var w=0,x=v.length;w<x;++w){var y=v[w].start;var z=v[w].count;var t=v[w].index;for(var m=y,A=y+z;m<A;m+=3)for(var p=0;p<3;p++){d[0]=t+u[m+p];d[1]=t+u[m+(p+1)%3];d.sort(f);var q=d.toString();if(e[q]===undefined){l[2*k]=d[0];l[2*k+1]=d[1];e[q]=true;k++;}}}h.addAttribute('position',Float32Array,2*k,3);var r=h.attributes.position.array;for(var m=0,n=k;m<n;m++)for(var p=0;p<2;p++){var t=6*m+3*p;var B=3*l[2*m+p];r[t+0]=i[B];r[t+1]=i[B+1];r[t+2]=i[B+2];}}else if(a.geometry instanceof THREE.BufferGeometry){var i=a.geometry.attributes.position.array;var k=i.length/3;var C=k/3;h.addAttribute('position',Float32Array,2*k,3);var r=h.attributes.position.array;for(var m=0,n=C;m<n;m++)for(var p=0;p<3;p++){var t=18*m+6*p;var D=9*m+3*p;r[t+0]=i[D];r[t+1]=i[D+1];r[t+2]=i[D+2];var B=9*m+3*((p+1)%3);r[t+3]=i[B];r[t+4]=i[B+1];r[t+5]=i[B+2];}}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=false;this.matrixWorld=a.matrixWorld;};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){};};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3();this.customUpdateCallback=undefined;if(a!==undefined)this.add(a,b,c,d,e);};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(a,b,c,d,e,f){if(b===undefined)b=-1;if(c===undefined)c=0;if(f===undefined)f=1;if(e===undefined)e=new THREE.Color(0xffffff);if(d===undefined)d=THREE.NormalBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d});};THREE.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length;var c;var d=-this.positionScreen.x*2;var e=-this.positionScreen.y*2;for(a=0;a<b;a++){c=this.lensFlares[a];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+e*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25;}};THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;var d="__default";var e=0;var f=c-1;var g=c/1;this.createAnimation(d,e,f,g);this.setAnimationWeight(d,1);};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[a]=e;this.animationsList.push(e);};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){var b=/([a-z]+)(\d+)/;var c,d={};var e=this.geometry;for(var f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f];var i=h.name.match(b);if(i&&i.length>1){var j=i[1];var k=i[2];if(!d[j])d[j]={start:Infinity,end:-Infinity};var l=d[j];if(f<l.start)l.start=f;if(f>l.end)l.end=f;if(!c)c=j;}}for(var j in d){var l=d[j];this.createAnimation(j,l.start,l.end,a);}this.firstAnimation=c;};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];if(b){b.direction=1;b.directionBackwards=false;}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];if(b){b.direction=-1;b.directionBackwards=true;}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];if(c){c.fps=b;c.duration=(c.end-c.start)/c.fps;}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];if(c){c.duration=b;c.fps=(c.end-c.start)/c.duration;}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];if(c)c.weight=b;};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];if(c)c.time=b;};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;var c=this.animationsMap[a];if(c)b=c.time;return b;};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;var c=this.animationsMap[a];if(c)b=c.duration;return b;};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];if(b){b.time=0;b.active=true;}else console.warn("animation["+a+"] undefined");};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];if(b)b.active=false;};THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(!d.active)continue;var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||d.time<0){d.direction*=-1;if(d.time>d.duration){d.time=d.duration;d.directionBackwards=true;}if(d.time<0){d.time=0;d.directionBackwards=false;}}}else{d.time=d.time%d.duration;if(d.time<0)d.time+=d.duration;}var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1);var g=d.weight;if(f!==d.currentFrame){this.morphTargetInfluences[d.lastFrame]=0;this.morphTargetInfluences[d.currentFrame]=1*g;this.morphTargetInfluences[f]=0;d.lastFrame=d.currentFrame;d.currentFrame=f;}var h=(d.time%e)/e;if(d.directionBackwards)h=1-h;this.morphTargetInfluences[d.currentFrame]=h*g;this.morphTargetInfluences[d.lastFrame]=(1-h)*g;}};THREE.LensFlarePlugin=function(){var a,b,c,d={};this.init=function(f){a=f.context;b=f;c=f.getPrecision();d.vertices=new Float32Array(8+8);d.faces=new Uint16Array(6);var g=0;d.vertices[g++]=-1;d.vertices[g++]=-1;d.vertices[g++]=0;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;g=0;d.faces[g++]=0;d.faces[g++]=1;d.faces[g++]=2;d.faces[g++]=0;d.faces[g++]=2;d.faces[g++]=3;d.vertexBuffer=a.createBuffer();d.elementBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,d.vertices,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,d.faces,a.STATIC_DRAW);d.tempTexture=a.createTexture();d.occlusionTexture=a.createTexture();a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGB,16,16,0,a.RGB,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,d.occlusionTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,16,16,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);if(a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){d.hasVertexTexture=false;d.program=e(THREE.ShaderFlares.lensFlare,c);}else{d.hasVertexTexture=true;d.program=e(THREE.ShaderFlares.lensFlareVertexTexture,c);}d.attributes={};d.uniforms={};d.attributes.vertex=a.getAttribLocation(d.program,"position");d.attributes.uv=a.getAttribLocation(d.program,"uv");d.uniforms.renderType=a.getUniformLocation(d.program,"renderType");d.uniforms.map=a.getUniformLocation(d.program,"map");d.uniforms.occlusionMap=a.getUniformLocation(d.program,"occlusionMap");d.uniforms.opacity=a.getUniformLocation(d.program,"opacity");d.uniforms.color=a.getUniformLocation(d.program,"color");d.uniforms.scale=a.getUniformLocation(d.program,"scale");d.uniforms.rotation=a.getUniformLocation(d.program,"rotation");d.uniforms.screenPosition=a.getUniformLocation(d.program,"screenPosition");};this.render=function(c,e,f,g){var h=c.__webglFlares,i=h.length;if(!i)return;var j=new THREE.Vector3();var k=g/f,l=f*0.5,m=g*0.5;var n=16/g,o=new THREE.Vector2(n*k,n);var p=new THREE.Vector3(1,1,0),q=new THREE.Vector2(1,1);var r=d.uniforms,s=d.attributes;a.useProgram(d.program);a.enableVertexAttribArray(d.attributes.vertex);a.enableVertexAttribArray(d.attributes.uv);a.uniform1i(r.occlusionMap,0);a.uniform1i(r.map,1);a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.vertexAttribPointer(s.vertex,2,a.FLOAT,false,2*8,0);a.vertexAttribPointer(s.uv,2,a.FLOAT,false,2*8,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.disable(a.CULL_FACE);a.depthMask(false);var t,u,v,w,x;for(t=0;t<i;t++){n=16/g;o.set(n*k,n);w=h[t];j.set(w.matrixWorld.elements[12],w.matrixWorld.elements[13],w.matrixWorld.elements[14]);j.applyMatrix4(e.matrixWorldInverse);j.applyProjection(e.projectionMatrix);p.copy(j);q.x=p.x*l+l;q.y=p.y*m+m;if(d.hasVertexTexture||(q.x>0&&q.x<f&&q.y>0&&q.y<g)){a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGB,q.x-8,q.y-8,16,16,0);a.uniform1i(r.renderType,0);a.uniform2f(r.scale,o.x,o.y);a.uniform3f(r.screenPosition,p.x,p.y,p.z);a.disable(a.BLEND);a.enable(a.DEPTH_TEST);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.occlusionTexture);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,q.x-8,q.y-8,16,16,0);a.uniform1i(r.renderType,1);a.disable(a.DEPTH_TEST);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);w.positionScreen.copy(p);if(w.customUpdateCallback)w.customUpdateCallback(w);else w.updateLensFlares();a.uniform1i(r.renderType,2);a.enable(a.BLEND);for(u=0,v=w.lensFlares.length;u<v;u++){x=w.lensFlares[u];if(x.opacity>0.001&&x.scale>0.001){p.x=x.x;p.y=x.y;p.z=x.z;n=x.size*x.scale/g;o.x=n*k;o.y=n;a.uniform3f(r.screenPosition,p.x,p.y,p.z);a.uniform2f(r.scale,o.x,o.y);a.uniform1f(r.rotation,x.rotation);a.uniform1f(r.opacity,x.opacity);a.uniform3f(r.color,x.color.r,x.color.g,x.color.b);b.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst);b.setTexture(x.texture,1);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);}}}}a.enable(a.CULL_FACE);a.enable(a.DEPTH_TEST);a.depthMask(true);};function e(b,c){var d=a.createProgram();var e=a.createShader(a.FRAGMENT_SHADER);var f=a.createShader(a.VERTEX_SHADER);var g="precision "+c+" float;\n";a.shaderSource(e,g+b.fragmentShader);a.shaderSource(f,g+b.vertexShader);a.compileShader(e);a.compileShader(f);a.attachShader(d,e);a.attachShader(d,f);a.linkProgram(d);return d;};};THREE.ShadowMapPlugin=function(){var a,b,c,d,e,f,g=new THREE.Frustum(),h=new THREE.Matrix4(),i=new THREE.Vector3(),j=new THREE.Vector3(),k=new THREE.Vector3();this.init=function(g){a=g.context;b=g;var h=THREE.ShaderLib.depthRGBA;var i=THREE.UniformsUtils.clone(h.uniforms);c=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i});d=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true});e=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,skinning:true});f=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true,skinning:true});c._shadowPass=true;d._shadowPass=true;e._shadowPass=true;f._shadowPass=true;};this.render=function(a,c){if(!(b.shadowMapEnabled&&b.shadowMapAutoUpdate))return;this.update(a,c);};this.update=function(i,j){var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[],F=0,G=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(b.shadowMapCullFace===THREE.CullFaceFront)a.cullFace(a.FRONT);else a.cullFace(a.BACK);b.setDepthTest(true);for(p=0,q=i.__lights.length;p<q;p++){C=i.__lights[p];if(!C.castShadow)continue;if((C instanceof THREE.DirectionalLight)&&C.shadowCascade)for(t=0;t<C.shadowCascadeCount;t++){var H;if(!C.shadowCascadeArray[t]){H=l(C,t);H.originalCamera=j;var I=new THREE.Gyroscope();I.position=C.shadowCascadeOffset;I.add(H);I.add(H.target);j.add(I);C.shadowCascadeArray[t]=H;console.log("Created virtualLight",H);}else H=C.shadowCascadeArray[t];m(C,t);E[F]=H;F++;}else{E[F]=C;F++;}}for(p=0,q=E.length;p<q;p++){C=E[p];if(!C.shadowMap){var J=THREE.LinearFilter;if(b.shadowMapType===THREE.PCFSoftShadowMap)J=THREE.NearestFilter;var K={minFilter:J,magFilter:J,format:THREE.RGBAFormat};C.shadowMap=new THREE.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,K);C.shadowMapSize=new THREE.Vector2(C.shadowMapWidth,C.shadowMapHeight);C.shadowMatrix=new THREE.Matrix4();}if(!C.shadowCamera){if(C instanceof THREE.SpotLight)C.shadowCamera=new THREE.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else if(C instanceof THREE.DirectionalLight)C.shadowCamera=new THREE.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue;}i.add(C.shadowCamera);if(i.autoUpdate===true)i.updateMatrixWorld();}if(C.shadowCameraVisible&&!C.cameraHelper){C.cameraHelper=new THREE.CameraHelper(C.shadowCamera);C.shadowCamera.add(C.cameraHelper);}if(C.isVirtual&&H.originalCamera==j)n(j,C);u=C.shadowMap;v=C.shadowMatrix;w=C.shadowCamera;w.position.setFromMatrixPosition(C.matrixWorld);k.setFromMatrixPosition(C.target.matrixWorld);w.lookAt(k);w.updateMatrixWorld();w.matrixWorldInverse.getInverse(w.matrixWorld);if(C.cameraHelper)C.cameraHelper.visible=C.shadowCameraVisible;if(C.shadowCameraVisible)C.cameraHelper.update();v.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);v.multiply(w.projectionMatrix);v.multiply(w.matrixWorldInverse);h.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(u);b.clear();D=i.__webglObjects;for(r=0,s=D.length;r<s;r++){A=D[r];B=A.object;A.render=false;if(B.visible&&B.castShadow)if(!(B instanceof THREE.Mesh||B instanceof THREE.ParticleSystem)||!(B.frustumCulled)||g.intersectsObject(B)){B._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,B.matrixWorld);A.render=true;}}var L,M,N;for(r=0,s=D.length;r<s;r++){A=D[r];if(A.render){B=A.object;y=A.buffer;L=o(B);M=B.geometry.morphTargets!==undefined&&B.geometry.morphTargets.length>0&&L.morphTargets;N=B instanceof THREE.SkinnedMesh&&L.skinning;if(B.customDepthMaterial)z=B.customDepthMaterial;else if(N)z=M?f:e;else if(M)z=d;else z=c;if(y instanceof THREE.BufferGeometry)b.renderBufferDirect(w,i.__lights,G,z,y,B);else b.renderBuffer(w,i.__lights,G,z,y,B);}}D=i.__webglObjectsImmediate;for(r=0,s=D.length;r<s;r++){A=D[r];B=A.object;if(B.visible&&B.castShadow){B._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,B.matrixWorld);b.renderImmediateObject(w,i.__lights,G,c,B);}}}var O=b.getClearColor(),P=b.getClearAlpha();a.clearColor(O.r,O.g,O.b,P);a.enable(a.BLEND);if(b.shadowMapCullFace===THREE.CullFaceFront)a.cullFace(a.BACK);};function l(a,b){var c=new THREE.DirectionalLight();c.isVirtual=true;c.onlyShadow=true;c.castShadow=true;c.shadowCameraNear=a.shadowCameraNear;c.shadowCameraFar=a.shadowCameraFar;c.shadowCameraLeft=a.shadowCameraLeft;c.shadowCameraRight=a.shadowCameraRight;c.shadowCameraBottom=a.shadowCameraBottom;c.shadowCameraTop=a.shadowCameraTop;c.shadowCameraVisible=a.shadowCameraVisible;c.shadowDarkness=a.shadowDarkness;c.shadowBias=a.shadowCascadeBias[b];c.shadowMapWidth=a.shadowCascadeWidth[b];c.shadowMapHeight=a.shadowCascadeHeight[b];c.pointsWorld=[];c.pointsFrustum=[];var d=c.pointsWorld,e=c.pointsFrustum;for(var f=0;f<8;f++){d[f]=new THREE.Vector3();e[f]=new THREE.Vector3();}var g=a.shadowCascadeNearZ[b];var h=a.shadowCascadeFarZ[b];e[0].set(-1,-1,g);e[1].set(1,-1,g);e[2].set(-1,1,g);e[3].set(1,1,g);e[4].set(-1,-1,h);e[5].set(1,-1,h);e[6].set(-1,1,h);e[7].set(1,1,h);return c;}function m(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position);c.target.position.copy(a.target.position);c.lookAt(c.target);c.shadowCameraVisible=a.shadowCameraVisible;c.shadowDarkness=a.shadowDarkness;c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b];var e=a.shadowCascadeFarZ[b];var f=c.pointsFrustum;f[0].z=d;f[1].z=d;f[2].z=d;f[3].z=d;f[4].z=e;f[5].z=e;f[6].z=e;f[7].z=e;}function n(a,b){var c=b.shadowCamera,d=b.pointsFrustum,e=b.pointsWorld;i.set(Infinity,Infinity,Infinity);j.set(-Infinity,-Infinity,-Infinity);for(var f=0;f<8;f++){var g=e[f];g.copy(d[f]);THREE.ShadowMapPlugin.__projector.unprojectVector(g,a);g.applyMatrix4(c.matrixWorldInverse);if(g.x<i.x)i.x=g.x;if(g.x>j.x)j.x=g.x;if(g.y<i.y)i.y=g.y;if(g.y>j.y)j.y=g.y;if(g.z<i.z)i.z=g.z;if(g.z>j.z)j.z=g.z;}c.left=i.x;c.right=j.x;c.top=j.y;c.bottom=i.y;c.updateProjectionMatrix();}function o(a){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[0]:a.material;};};THREE.ShadowMapPlugin.__projector=new THREE.Projector();THREE.SpritePlugin=function(){var a,b,c;var d,e,f,g;var h,i,j;this.init=function(l){a=l.context;b=l;d=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]);e=new Uint16Array([0,1,2,0,2,3]);f=a.createBuffer();g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g);a.bufferData(a.ELEMENT_ARRAY_BUFFER,e,a.STATIC_DRAW);h=k();i={position:a.getAttribLocation(h,'position'),uv:a.getAttribLocation(h,'uv')};j={uvOffset:a.getUniformLocation(h,'uvOffset'),uvScale:a.getUniformLocation(h,'uvScale'),rotation:a.getUniformLocation(h,'rotation'),scale:a.getUniformLocation(h,'scale'),color:a.getUniformLocation(h,'color'),map:a.getUniformLocation(h,'map'),opacity:a.getUniformLocation(h,'opacity'),modelViewMatrix:a.getUniformLocation(h,'modelViewMatrix'),projectionMatrix:a.getUniformLocation(h,'projectionMatrix'),fogType:a.getUniformLocation(h,'fogType'),fogDensity:a.getUniformLocation(h,'fogDensity'),fogNear:a.getUniformLocation(h,'fogNear'),fogFar:a.getUniformLocation(h,'fogFar'),fogColor:a.getUniformLocation(h,'fogColor'),alphaTest:a.getUniformLocation(h,'alphaTest')};var m=document.createElement('canvas');m.width=8;m.height=8;var n=m.getContext('2d');n.fillStyle='#ffffff';n.fillRect(0,0,m.width,m.height);c=new THREE.Texture(m);c.needsUpdate=true;};this.render=function(d,e,k,m){var n=d.__webglSprites,o=n.length;if(!o)return;a.useProgram(h);a.enableVertexAttribArray(i.position);a.enableVertexAttribArray(i.uv);a.disable(a.CULL_FACE);a.enable(a.BLEND);a.bindBuffer(a.ARRAY_BUFFER,f);a.vertexAttribPointer(i.position,2,a.FLOAT,false,2*8,0);a.vertexAttribPointer(i.uv,2,a.FLOAT,false,2*8,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g);a.uniformMatrix4fv(j.projectionMatrix,false,e.projectionMatrix.elements);a.activeTexture(a.TEXTURE0);a.uniform1i(j.map,0);var p=0;var q=0;var r=d.fog;if(r){a.uniform3f(j.fogColor,r.color.r,r.color.g,r.color.b);if(r instanceof THREE.Fog){a.uniform1f(j.fogNear,r.near);a.uniform1f(j.fogFar,r.far);a.uniform1i(j.fogType,1);p=1;q=1;}else if(r instanceof THREE.FogExp2){a.uniform1f(j.fogDensity,r.density);a.uniform1i(j.fogType,2);p=2;q=2;}}else{a.uniform1i(j.fogType,0);p=0;q=0;}var s,t,u,v,w=[];for(s=0;s<o;s++){t=n[s];u=t.material;if(t.visible===false)continue;t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld);t.z=-t._modelViewMatrix.elements[14];}n.sort(l);for(s=0;s<o;s++){t=n[s];if(t.visible===false)continue;u=t.material;a.uniform1f(j.alphaTest,u.alphaTest);a.uniformMatrix4fv(j.modelViewMatrix,false,t._modelViewMatrix.elements);w[0]=t.scale.x;w[1]=t.scale.y;if(d.fog&&u.fog)v=q;else v=0;if(p!==v){a.uniform1i(j.fogType,v);p=v;}if(u.map!==null){a.uniform2f(j.uvOffset,u.map.offset.x,u.map.offset.y);a.uniform2f(j.uvScale,u.map.repeat.x,u.map.repeat.y);}else{a.uniform2f(j.uvOffset,0,0);a.uniform2f(j.uvScale,1,1);}a.uniform1f(j.opacity,u.opacity);a.uniform3f(j.color,u.color.r,u.color.g,u.color.b);a.uniform1f(j.rotation,u.rotation);a.uniform2fv(j.scale,w);b.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);b.setDepthTest(u.depthTest);b.setDepthWrite(u.depthWrite);if(u.map&&u.map.image&&u.map.image.width)b.setTexture(u.map,0);else b.setTexture(c,0);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);}a.enable(a.CULL_FACE);};function k(){var c=a.createProgram();var d=a.createShader(a.VERTEX_SHADER);var e=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(d,['precision '+b.getPrecision()+' float;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform float rotation;','uniform vec2 scale;','uniform vec2 uvOffset;','uniform vec2 uvScale;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','void main() {','vUV = uvOffset + uv * uvScale;','vec2 alignedPosition = position * scale;','vec2 rotatedPosition;','rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;','rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;','vec4 finalPosition;','finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );','finalPosition.xy += rotatedPosition;','finalPosition = projectionMatrix * finalPosition;','gl_Position = finalPosition;','}'].join('\n'));a.shaderSource(e,['precision '+b.getPrecision()+' float;','uniform vec3 color;','uniform sampler2D map;','uniform float opacity;','uniform int fogType;','uniform vec3 fogColor;','uniform float fogDensity;','uniform float fogNear;','uniform float fogFar;','uniform float alphaTest;','varying vec2 vUV;','void main() {','vec4 texture = texture2D( map, vUV );','if ( texture.a < alphaTest ) discard;','gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );','if ( fogType > 0 ) {','float depth = gl_FragCoord.z / gl_FragCoord.w;','float fogFactor = 0.0;','if ( fogType == 1 ) {','fogFactor = smoothstep( fogNear, fogFar, depth );','} else {','const float LOG2 = 1.442695;','float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );','fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );','}','gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );','}','}'].join('\n'));a.compileShader(d);a.compileShader(e);a.attachShader(c,d);a.attachShader(c,e);a.linkProgram(c);return c;};function l(a,b){if(a.z!==b.z)return b.z-a.z;else return b.id-a.id;};};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var a,b,c,d,e,f,g=new THREE.Frustum(),h=new THREE.Matrix4();this.init=function(g){a=g.context;b=g;var h=THREE.ShaderLib.depthRGBA;var i=THREE.UniformsUtils.clone(h.uniforms);c=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i});d=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true});e=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,skinning:true});f=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true,skinning:true});c._shadowPass=true;d._shadowPass=true;e._shadowPass=true;f._shadowPass=true;};this.render=function(a,b){if(!this.enabled)return;this.update(a,b);};this.update=function(j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);b.setDepthTest(true);if(j.autoUpdate===true)j.updateMatrixWorld();k.matrixWorldInverse.getInverse(k.matrixWorld);h.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(this.renderTarget);b.clear();w=j.__webglObjects;for(n=0,o=w.length;n<o;n++){t=w[n];u=t.object;t.render=false;if(u.visible)if(!(u instanceof THREE.Mesh||u instanceof THREE.ParticleSystem)||!(u.frustumCulled)||g.intersectsObject(u)){u._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,u.matrixWorld);t.render=true;}}var y,z,A;for(n=0,o=w.length;n<o;n++){t=w[n];if(t.render){u=t.object;r=t.buffer;if(u instanceof THREE.ParticleSystem&&!u.customDepthMaterial)continue;y=i(u);if(y)b.setMaterialFaces(u.material);z=u.geometry.morphTargets.length>0&&y.morphTargets;A=u instanceof THREE.SkinnedMesh&&y.skinning;if(u.customDepthMaterial)s=u.customDepthMaterial;else if(A)s=z?f:e;else if(z)s=d;else s=c;if(r instanceof THREE.BufferGeometry)b.renderBufferDirect(k,j.__lights,x,s,r,u);else b.renderBuffer(k,j.__lights,x,s,r,u);}}w=j.__webglObjectsImmediate;for(n=0,o=w.length;n<o;n++){t=w[n];u=t.object;if(u.visible){u._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,u.matrixWorld);b.renderImmediateObject(k,j.__lights,x,c,u);}}var B=b.getClearColor(),C=b.getClearAlpha();a.clearColor(B.r,B.g,B.b,C);a.enable(a.BLEND);};function i(a){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[0]:a.material;};};THREE.ShaderFlares={'lensFlareVertexTexture':{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},'lensFlare':{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};